{{/* Standalone version selector you can place in Markdown: {{< version-menu >}} */}}
{{ if gt (len .Site.Params.versions) 0 }}
  {{- $menuLabel := default "Version" .Site.Params.version_menu -}}
  {{- $pagelinks := .Site.Params.version_menu_pagelinks -}}
  {{- $rel := .Page.RelPermalink -}}

  <div class="dropdown my-3">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="versionMenuBtn"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {{ $menuLabel }}
    </button>
    <div class="dropdown-menu" aria-labelledby="versionMenuBtn">
      {{ range .Site.Params.versions }}
        {{- $target := .url -}}
        {{- if $pagelinks }}
          {{/* Strip any single trailing slash from the base URL (portable on old Hugo): */}}
          {{- $base := replaceRE "/$" "" .url -}}

          {{/* If your RelPermalink already contains a staging prefix that ALSO exists in .url,
               you can remove it from $rel to avoid duplication. Uncomment & adjust: */}}
          {{- $rel2 := $rel -}}
          {{/* $rel2 = replace $rel "/docs-staging/branch/sen-reorg" "" */}}

          {{- $target = printf "%s%s" $base $rel2 -}}
        {{- end }}
        <a class="dropdown-item" href="{{ $target }}">{{ .version }}</a>
      {{ end }}
    </div>
  </div>
{{ end }}

