<!-- Scratchpad gets populated through call to .Inner -->
{{- .Inner -}}

{{- /* Treat text=true (string or bool) as "render inner as Markdown/HTML" */ -}}
{{- $textMode := or (eq ($.Get "text") true) (eq ($.Get "text") "true") -}}

<ul class="nav nav-tabs" id="tabs-{{- $.Ordinal -}}" role="tablist">
  {{- range $index, $element := $.Scratch.Get "tabs" -}}
    <li class="nav-item">
      {{- $tabid := printf "tabs-%v-%v-tab" $.Ordinal $index | anchorize -}}
      {{- $entryid := printf "tabs-%v-%v" $.Ordinal $index | anchorize -}}
      {{- $tabname := replaceRE "(\\s)" "-" $element.header | replaceRE "(\\+)" "-" -}}
      <a class="nav-link{{ if eq $index "0" }} active{{ end }} tab-{{ $tabname }}"
         id="{{ $tabid }}" data-toggle="tab" href="#{{ $entryid }}" role="tab"
         onclick="handleClick('{{ $tabname }}');"
         aria-controls="{{ $entryid }}" aria-selected="{{- cond (eq $index "0") "true" "false" -}}">
        {{ index . "header" }}
      </a>
    </li>
  {{- end -}}
</ul>

<div class="tab-content" id="tabs-{{- $.Ordinal -}}-content">
  {{- range $index, $element := $.Scratch.Get "tabs" -}}
    {{- $lang := default $.Site.Language.Lang ($.Get "lang") -}}
    {{- with $.Get "langEqualsHeader" -}}
      {{- if $.Get "langEqualsHeader" -}}
        {{- $lang = $element.header -}}
      {{- end -}}
    {{- end -}}
    {{- $hloptions := default "" ($.Get "highlight") -}}
    {{- with $element.language -}} {{ $lang = $element.language }} {{- end -}}
    {{- with $element.highlight -}} {{ $hloptions = $element.highlight }} {{- end -}}
    {{- $tabid := printf "tabs-%v-%v-tab" $.Ordinal $index | anchorize -}}
    {{- $entryid := printf "tabs-%v-%v" $.Ordinal $index | anchorize -}}

    <div class="tab-pane fade{{ if eq $index "0" }} show active{{ end }}"
         id="{{ $entryid }}" role="tabpanel" aria-labelledby="{{ $tabid }}">
      {{- if $textMode -}}
        {{- /* Render inner content as Markdown/HTML so tables, lists, etc. work */ -}}
        {{- with index . "content" -}}
          {{- $.Page.RenderString . -}}
        {{- end -}}
      {{- else -}}
        {{- /* Default: code tab using highlight */ -}}
        {{- highlight (index . "content") $lang $hloptions -}}
      {{- end -}}
    </div>
  {{- end -}}
</div>

