<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.79.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>How to Integrate Zymbit with AWS Credentials Provider |</title><meta name=description content><meta property="og:title" content="How to Integrate Zymbit with AWS Credentials Provider"><meta property="og:description" content="The AWS Credentials provider can give a remote device AWS credentials if it has a valid certificate. The device certificate is stored inside AWS IoT&rsquo;s service and can be revoked, deactivated or deleted at any time. AWS IoT can also record and index individual IoT Things within a fleet. Each IoT thing will have its own unique certificate verified by AWS, and can be given unique attributes to identify each device along with policies which control the approved actions of each device."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.zymbit.com/tutorials/aws-iot/integrate/"><meta property="og:image" content="https://docs.zymbit.com/doks.png"><meta property="article:modified_time" content="2021-09-02T18:32:38-04:00"><meta property="og:site_name" content="Zymbit Documentation"><meta itemprop=name content="How to Integrate Zymbit with AWS Credentials Provider"><meta itemprop=description content="The AWS Credentials provider can give a remote device AWS credentials if it has a valid certificate. The device certificate is stored inside AWS IoT&rsquo;s service and can be revoked, deactivated or deleted at any time. AWS IoT can also record and index individual IoT Things within a fleet. Each IoT thing will have its own unique certificate verified by AWS, and can be given unique attributes to identify each device along with policies which control the approved actions of each device."><meta itemprop=dateModified content="2021-09-02T18:32:38-04:00"><meta itemprop=wordCount content="1279"><meta itemprop=image content="https://docs.zymbit.com/doks.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://docs.zymbit.com/doks.png"><meta name=twitter:title content="How to Integrate Zymbit with AWS Credentials Provider"><meta name=twitter:description content="The AWS Credentials provider can give a remote device AWS credentials if it has a valid certificate. The device certificate is stored inside AWS IoT&rsquo;s service and can be revoked, deactivated or deleted at any time. AWS IoT can also record and index individual IoT Things within a fleet. Each IoT thing will have its own unique certificate verified by AWS, and can be given unique attributes to identify each device along with policies which control the approved actions of each device."><link rel=preload href=/scss/main.min.ce0d576b050c303c3365576158e2ded601d798b4493d903e7d9d7c9748c0a182.css as=style><link href=/scss/main.min.ce0d576b050c303c3365576158e2ded601d798b4493d903e7d9d7c9748c0a182.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><img class=navbar-logo src=https://docs.zymbit.com/Zymbit-Logo.gif></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-4 col-xl-3 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Welcome to Zymbit Documentation</span></a><ul class="pr-md-3 ul-1"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstart-li><span class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section"><span>QUICKSTART</span></span><ul class="pr-md-3 ul-2"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstartgetting-started-li><a href=/quickstart/getting-started/ title="Getting Started with Zymbit Products" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-quickstartgetting-started><i class="fas fa-caret-right"></i><span>Getting Started</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartgetting-startedzymkey4-li><a href=/quickstart/getting-started/zymkey4/ title="Getting Started with Zymkey4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartgetting-startedzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartgetting-startedhsm4-li><a href=/quickstart/getting-started/hsm4/ title="Getting Started with HSM4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartgetting-startedhsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartgetting-startedhsm6-li><a href=/quickstart/getting-started/hsm6/ title="Getting Started with HSM6" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartgetting-startedhsm6><span>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstartapi-li><a href=/quickstart/api/ title="API Documentation" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-quickstartapi><i class="fas fa-caret-right"></i><span>API</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartapic_api-li><a href=/quickstart/api/c_api/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartapic_api><span>C API Documentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartapicpp_api-li><a href=/quickstart/api/cpp_api/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartapicpp_api><span>C++ API Documentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartapipython_api-li><a href=/quickstart/api/python_api/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartapipython_api><span>Python API Documentation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstartfaq-li><a href=/quickstart/faq/ title="FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-quickstartfaq><i class="fas fa-caret-right"></i><span>FAQ</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqzymkey4-li><a href=/quickstart/faq/zymkey4/ title="Zymkey4 FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqhsm4-li><a href=/quickstart/faq/hsm4/ title="HSM4 FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqhsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqhsm6-li><a href=/quickstart/faq/hsm6/ title="HSM6 FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqhsm6><span>HSM6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqgeneral-li><a href=/quickstart/faq/general/ title="FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqgeneral><span>GENERAL</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><span class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section"><span>REFERENCE</span></span><ul class="pr-md-3 ul-2"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecad-li><a href=/reference/cad/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referencecad><i class="fas fa-caret-right"></i><span>CAD</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referencecadzymkey4-li><a href=/reference/cad/zymkey4/ title="Zymkey4 CAD Files" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referencecadzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referencecadhsm4-li><a href=/reference/cad/hsm4/ title="HSM4 CAD Files" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referencecadhsm6-li><a href=/reference/cad/hsm6/ title="HSM6 CAD Files" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm6><span>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceconformity-li><a href=/reference/conformity/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referenceconformity><i class="fas fa-caret-right"></i><span>Conformity Documents</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityzymkey4-li><a href=/reference/conformity/zymkey4/ title="Zymkey4 Conformity Documents" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityhsm4-li><a href=/reference/conformity/hsm4/ title="HSM4 Conformity Documents" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityhsm6-li><a href=/reference/conformity/hsm6/ title="HSM6 Conformity Documents" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm6><span>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceknown-issues-li><a href=/reference/known-issues/ title="Dev Team: Known Issues" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referenceknown-issues><i class="fas fa-caret-right"></i><span>Known Issues</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceknown-issuescpu-scaling-li><a href=/reference/known-issues/cpu-scaling/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceknown-issuescpu-scaling><span>CPU Scaling Governor</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepower-quality-li><a href=/reference/power-quality/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referencepower-quality><i class="fas fa-genderless"></i><span>Power Quality Considerations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceproduct-briefs-li><a href=/reference/product-briefs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referenceproduct-briefs><i class="fas fa-caret-right"></i><span>Product Briefs</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefszymkey4-li><a href=https://www.zymbit.com/datasheets/zymkey-4i target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefszymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefshsm4-li><a href=https://www.zymbit.com/datasheets/hsm4 target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefshsm6-li><a href=https://www.zymbit.com/datasheets/hsm6 target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm6><span>HSM6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefsmfg-app-li><a href=https://www.zymbit.com/datasheets/manufacturing-appliance-1 target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefsmfg-app><span>Manufacturing Appliance</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereal-time-clock-li><a href=/reference/real-time-clock/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referencereal-time-clock><i class="fas fa-genderless"></i><span>Real Time Clock Operation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><span class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section"><span>TUTORIALS</span></span><ul class="pr-md-3 ul-2"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsalternative-gpio-li><a href=/tutorials/alternative-gpio/ title="Using an Alternative GPIO Pin" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsalternative-gpio><i class="fas fa-genderless"></i><span>Alternative GPIO Pin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-wallet-li><a href=/tutorials/digital-wallet/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdigital-wallet><i class="fas fa-genderless"></i><span>Digital Wallet</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsencrypt-rfs-li><a href=/tutorials/encrypt-rfs/ title="Encrypting your Root File System with dm-crypt and LUKS" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsencrypt-rfs><i class="fas fa-caret-right"></i><span>Encrypt Root File System</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsencrypt-rfszymkey4-li><a href=/tutorials/encrypt-rfs/zymkey4/ title="Encrypting Root File System with Zymkey4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfszymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsencrypt-rfshsm4-li><a href=/tutorials/encrypt-rfs/hsm4/ title="Encrypting Root File System with HSM4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfshsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsencrypt-rfshsm6-li><a href=/tutorials/encrypt-rfs/hsm6/ title="Encrypting Root File System with HSM6" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfshsm6><span>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssensor-data-li><a href=/tutorials/sensor-data/ title="Encrypting & Decrypting Sensor Data on Disk" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialssensor-data><i class="fas fa-genderless"></i><span>Encrypt Sensor Data</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsaws-iot-li><a href=/tutorials/aws-iot/ title="AWS IoT Integrations & Client Certificates" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsaws-iot><i class="fas fa-caret-right"></i><span>Integrate Zymbit with AWS</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-tutorialsaws-iotintegrate-li><a href=/tutorials/aws-iot/integrate/ title="How to Integrate Zymbit with AWS Credentials Provider" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotintegrate><span class=td-sidebar-nav-active-item>Integrate with AWS Credentials Provider</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotjitr-li><a href=/tutorials/aws-iot/jitr/ title="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotjitr><span>Just In Time Registration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iottls-li><a href=/tutorials/aws-iot/tls/ title="AWS IoT - TLS Client Certificate Authentication" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iottls><span>Transport Level Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotverify-sigs-li><a href=/tutorials/aws-iot/verify-sigs/ title="How to Verify Signatures against Public Key on AWS and Other Devices" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotverify-sigs><span>Verify Signatures</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsperimeter-detect-li><a href=/tutorials/perimeter-detect/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsperimeter-detect><i class="fas fa-caret-right"></i><span>Perimeter Detect</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detectzymkey4-li><a href=/tutorials/perimeter-detect/zymkey4/ title="Perimeter Detect: ZYMKEY4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detecthsm4-li><a href=/tutorials/perimeter-detect/hsm4/ title="Perimeter Detect: HSM4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detecthsm6-li><a href=/tutorials/perimeter-detect/hsm6/ title="Perimeter Detect: HSM6" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm6><span>HSM6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detectexamples-li><a href=/tutorials/perimeter-detect/examples/ title="Perimeter Detect Circuit Examples" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectexamples><span>CIRCUIT EXAMPLES</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsprotokit-li><a href=/tutorials/protokit/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsprotokit><i class="fas fa-genderless"></i><span>ProtoKit5</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-forum-li><a href=https://community.zymbit.com/ target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-forum><span>FORUM</span></a></li></ul></li></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><nav id=TableOfContents><ul><li><a href=#device-setup>Device Setup</a><ul><li><a href=#setup-the-provisioning-device>Setup the Provisioning Device</a></li><li><a href=#setup-the-certificate-authority>Setup the Certificate Authority</a></li><li><a href=#setup-aws-credentials-provider>Setup AWS Credentials Provider</a></li><li><a href=#setup-the-iot-device-getting-credentials>Setup the IoT device getting credentials</a></li><li><a href=#provisioning-an-iot-device>Provisioning an IoT Device</a></li></ul></li></ul></nav></div><main class="col-12 col-md-8 col-xl-7 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/>TUTORIALS</a></li><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/aws-iot/>Integrate Zymbit with AWS</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.zymbit.com/tutorials/aws-iot/integrate/>Integrate with AWS Credentials Provider</a></li></ol></nav><div class=td-content><h1>How to Integrate Zymbit with AWS Credentials Provider</h1><p>The AWS Credentials provider can give a remote device AWS credentials if it has a valid certificate. The device certificate is stored inside AWS IoT&rsquo;s service and can be revoked, deactivated or deleted at any time. AWS IoT can also record and index individual IoT Things within a fleet. Each IoT thing will have its own unique certificate verified by AWS, and can be given unique attributes to identify each device along with policies which control the approved actions of each device.</p><p>Using AWS IoT also allows device data to be used by other AWS cloud services. Once the device is given credentials, other AWS services can be configured to receive data from the device.</p><p>The IoT device&rsquo;s AWS credentials are only valid for a period of time. If the credentials expire, when the AWS CLI tries to connect to AWS servers, it will run an installed script to get new credentials.</p><p><img src=../aws1.png alt=aws-image1></p><hr><h2 id=device-setup>Device Setup</h2><hr><p>There are four devices in the provisioning process:</p><ol><li>The Provisioning Device with AWS CLI installed (usually your PC)</li><li>The Certificate Authority</li><li>The AWS Credentials Provider</li><li>The IoT Device(s) getting their credentials (with Zymbit security module(s) installed)</li></ol><p>If wanted, the CA and provisioning device can be on the same device.</p><hr><h3 id=setup-the-provisioning-device>Setup the Provisioning Device</h3><p>The provisioning device can be any device with AWS CLI installed, but we recommend it not be an IoT device you deploy because the provisioning device will have more AWS permissions.</p><ol><li>Install AWS CLI.<ul><li>Instructions here: https://aws.amazon.com/cli/</li></ul></li><li>Specify user for AWS CLI<ul><li>Go to AWS IAM console, click users, add user, input a user name, and check programatic access.</li><li>Click Next:Permissions, &ldquo;Attach existing policies directly&rdquo;, click AdministratorAccess</li><li>Click Next:Tags, Next:Review, Create user. Stay on this page.</li><li>On the provisioning device, run <code>aws configure</code> and fill in the appropriate values from the AWS page.<ul><li>For Default output format put json.</li></ul></li></ul></li><li>Run <code>git clone https://github.com/zymbit-applications/aws-credentials-provider.git</code></li><li>Run <code>sudo mkdir /opt/zymbit</code></li></ol><hr><h3 id=setup-the-certificate-authority>Setup the Certificate Authority</h3><p>The Certificate Authority can be a private CA you own or you can use AWS&rsquo;s CA service.
If you want to create a CA on your own device, follow these instructions.</p><details><summary>Create a private CA</summary><br><p>On the device you want to hold your private CA and sign certificate requests, do the following.</p><ul><li>Run <code>git clone https://github.com/zymbit-applications/aws-credentials-provider.git</code></li><li>Run <code>cd aws-credentials-provider</code></li><li>Run the mk_ca script: <code>bash mk_ca.sh</code></li></ul><p>There are now three files in the directory (~/aws-credentials-provider/CA_files).</p><ul><li>zk_ca.key<ul><li>The private key for the CA, used for signing CSR&rsquo;s</li></ul></li><li>zk_ca.pem<ul><li>The certificate for the CA in PEM format</li></ul></li><li>zk_ca.crt<ul><li>The certificate for the CA</li></ul></li></ul></details><p>If you have your own private CA, then you need to register it with AWS.</p><details><summary>Register certificate authority with AWS</summary><br><p>Steps 1 and 6 are done on the provisioning device.
Steps 2-5 must be done on the private CA.</p><ol><li>Copy the registration code for generating CA cert.</li></ol><pre><code>aws iot get-registration-code
</code></pre><ol start=2><li>Create a private key for AWS CA to verify against.</li></ol><pre><code>openssl genrsa -out verificationCert.key 2048
</code></pre><ol start=3><li>Create a CSR for your CA to sign</li></ol><pre><code>openssl req -new -key verificationCert.key -out verificationCert.csr
</code></pre><ol start=4><li>Put registration code in the Common Name field</li></ol><pre><code>Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []: 9c9df696a8a09688d040b4b719129e4d6dbd6a898eeb0c654af0a5753b41
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre><ol start=5><li>Create a private key verification certificate for your CA. If you didn&rsquo;t follow our CA creation section, then the -CA and -CAkey file paths are likely different.</li></ol><pre><code>openssl x509 -req -in verificationCert.csr -CA CA_files/zk_ca.pem \
-CAkey CA_files/zk_ca.key -CAcreateserial -out verificationCert.crt \
-days 500 -sha256
</code></pre><ol start=6><li>Register CA certificate, set it as active and allow device certificates to
auto register.</li></ol><pre><code>aws iot register-ca-certificate --ca-certificate file://CA_files/zk_ca.crt \
                                --verification-certificate file://verificationCert.crt \
                                --set-as-active \
                                --allow-auto-registration
</code></pre></details><hr><h3 id=setup-aws-credentials-provider>Setup AWS Credentials Provider</h3><p>All of these steps happen on the <strong>provisioning</strong> device</p><ol><li>Create an IAM role for credentials provider<ul><li><code>aws iam create-role --role-name credential_helper --assume-role-policy-document file://aws-credentials-provider/role-trust-policy.json</code></li></ul></li><li>Create a role alias linked to role<ul><li><code>aws iot create-role-alias --role-alias deviceRoleAlias --role-arn &lt;roleARN></code></li><li>The roleARN is in the output of step 1, but you can run <code>aws iam get-role --role-name credential_helper</code> to find it again.</li><li>If this fails, the user you currently are may not have GetRole and PassRole permissions. The tab below gives instructions to add these permissions.</li></ul></li></ol><details><summary>Add Permissions</summary><br><ul><li>Go to AWS IAM console</li><li>Select Users</li><li>Select the user you currently are on your provisioning device</li><li>Click the permissions tab</li><li>Click Add permissions</li><li>Click &ldquo;Attach existing policies directly&rdquo;</li><li>Click Create Policy</li><li>Click the JSON tab</li><li>Copy the user-pass-permissions.json file into the editor<ul><li>Replace ACCOUNT_ID with your provisioning device user<ul><li>You can find this by running <code>aws sts get-caller-identity</code> on your provisioning device.</li></ul></li><li>Replace ROLE_NAME with name given in the step above (e.g. <code>credential_helper</code>)</li></ul></li><li>Click Next:Tags</li><li>Click Next:Review</li><li>Name the policy</li><li>Click create.</li></ul></details><ol start=3><li>Create an IoT policy which allows role alias to be assumed with a certificate<ul><li>In ~/aws-credentials-provider/iot-role-policy.json substitute:<ul><li>REGION with the desired region</li><li>ACCOUNT_ID with the &ldquo;Account&rdquo; number found by running <code>aws sts get-caller-identity</code></li><li>ALIAS with the name of the role alias created in step 2</li></ul></li><li>Then run <code>aws iot create-policy --policy-name credentialHelper --policy-document file://aws-credentials-provider/iot-role-policy.json</code></li></ul></li></ol><hr><h3 id=setup-the-iot-device-getting-credentials>Setup the IoT device getting credentials</h3><ol><li>Run <code>git clone https://github.com/zymbit-applications/aws-credentials-provider.git</code></li><li>Run <code>sudo mkdir /opt/zymbit</code></li><li>Run <code>sudo cp ~/aws-credentials-provider/credentials.sh /opt/zymbit/ && chmod +x /opt/zymbit/credentials.sh</code></li><li>Edit <code>~/aws-credentials-provider/config</code> to specify the appropriate region.</li><li>Run <code>mkdir ~/.aws && cp ~/aws-credentials-provider/config ~/.aws/config</code></li></ol><hr><h3 id=provisioning-an-iot-device>Provisioning an IoT Device</h3><ol><li>On the <strong>IoT</strong> device<ul><li>Run <code>openssl req -key nonzymkey.key -new -out zymkey.csr -engine zymkey_ssl -keyform e</code></li><li>Fill in the request with the specified values<ul><li>The IoT Policy name, we used credentialHelper.</li><li>The desired AWS Region.</li><li>Credential Provider URL.<ul><li>To find this, on the <strong>provisioning</strong> device run<ul><li><code>aws iot describe-endpoint --endpoint-type iot:CredentialProvider</code></li><li>Copy the cxxxxxxxxxxxxx part.</li></ul></li></ul></li><li>Role Alias name, we used deviceRoleAlias.</li><li>The Thing name, whatever you want to name this IoT device.</li></ul></li></ul></li></ol><pre><code>Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]: &lt;IOT-POLICY&gt;
Locality Name (eg, city) []: &lt;REGION&gt;
Organization Name (eg, company) [Internet Widgits Pty Ltd]: &lt;CREDENTIAL-URL&gt;
Organizational Unit Name (eg, section) []: &lt;ROLE-ALIAS&gt;
Common Name (e.g. server FQDN or YOUR name) []: &lt;THING-NAME&gt;
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre><ol start=2><li>Copy zymkey.csr from the <strong>IoT</strong> device to <strong>CA</strong> device.<ul><li>If using our CA tutorial, put csr in the aws-credentials-provider directory (~/aws-credentials-provider)</li></ul></li><li>On the <strong>CA</strong> device, sign the CSR.<ul><li>If using our CA tutorial, in ~/aws-credentials-provider, run <code>bash sign_csr.sh zymkey.csr device.crt</code>. The first argument is the path to your CSR and the second argument the name you wish to give the signed device Certificate file.</li></ul></li><li>Copy the device cert (device.crt) and root ca key from the <strong>CA</strong> device to the <strong>provisioning</strong> device.<ul><li>If following our CA tutorial, the root ca key is CA_files/zk_ca.pem.</li></ul></li><li>On the <strong>provisioning device</strong>, run:<ul><li><code>sudo cp device.crt /opt/zymbit/ && sudo cp root.ca.pem /opt/zymbit/</code></li><li><code>bash provision-device.sh</code><ul><li>The script will ask you a few questions, make sure everything is correct.</li><li>The script behind the scenes will:<ul><li>Register device cert in AWS with root CA cert</li><li>Create a IoT Thing in AWS</li><li>Attach thing to device cert</li><li>Attach IoT policy to device cert</li></ul></li></ul></li></ul></li><li>Once the script is done, transfer device.crt and root.ca.pem from the <strong>provisioning</strong> device to the <strong>IoT</strong> device.</li><li>On the <strong>IoT</strong> device, run:<ul><li><code>sudo mv device.crt /opt/zymbit/ && sudo mv root.ca.pem /opt/zymbit/</code></li><li><code>/opt/zymbit/credentials.sh</code> to test the TLS connection.</li><li>If the resulting output contains values for AccessKey, SecretAccessKey, etc, then your device has AWS credentials!</li><li>To use Zymbit credentials with AWS CLI, set the profile flag to zymkey like so; <code>aws --profile zymkey iot describe-endpoint</code></li></ul></li></ol><div class="text-muted mt-5 pt-3 border-top"></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.2ba2da7d2fe4be755f96e1f7760bcc4a769c4b9369d2356a8872050735635419.js integrity="sha256-K6LafS/kvnVfluH3dgvMSnacS5Np0jVqiHIFBzVjVBk=" crossorigin=anonymous></script></body></html>