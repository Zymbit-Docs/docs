<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.122.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>AWS IoT - Just in Time Registration of Client Certificates using Lambda functions | </title><meta name=description content="How to automatically generate a client certificate, register your own CA, and authenticate a device to establish a TLS connection to AWS IoT

Overview …"><meta property="og:title" content="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions"><meta property="og:description" content="How to automatically generate a client certificate, register your own CA, and authenticate a device to establish a TLS connection to AWS IoT Overview AWS IoT requires an IoT device to register and activate a certificate with AWS before communicating. For large scale deployments, AWS provides an automated process called Just-In-Time-Registration. This allows a user to register a Certificate Authority with AWS so that upon a device&rsquo;s first TLS connection to AWS servers, if the device certificate was signed by this Certificate Authority, the certificate will be quickly activated by a lambda-function and be ready to use."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.zymbit.com/tutorials/aws-iot/jitr/"><meta property="og:image" content="https://docs.zymbit.com/doks.png"><meta property="article:section" content="tutorials"><meta property="article:modified_time" content="2021-11-07T14:19:14-08:00"><meta property="og:site_name" content="Zymbit Documentation"><meta itemprop=name content="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions"><meta itemprop=description content="How to automatically generate a client certificate, register your own CA, and authenticate a device to establish a TLS connection to AWS IoT Overview AWS IoT requires an IoT device to register and activate a certificate with AWS before communicating. For large scale deployments, AWS provides an automated process called Just-In-Time-Registration. This allows a user to register a Certificate Authority with AWS so that upon a device&rsquo;s first TLS connection to AWS servers, if the device certificate was signed by this Certificate Authority, the certificate will be quickly activated by a lambda-function and be ready to use."><meta itemprop=dateModified content="2021-11-07T14:19:14-08:00"><meta itemprop=wordCount content="2391"><meta itemprop=image content="https://docs.zymbit.com/doks.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://docs.zymbit.com/doks.png"><meta name=twitter:title content="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions"><meta name=twitter:description content="How to automatically generate a client certificate, register your own CA, and authenticate a device to establish a TLS connection to AWS IoT Overview AWS IoT requires an IoT device to register and activate a certificate with AWS before communicating. For large scale deployments, AWS provides an automated process called Just-In-Time-Registration. This allows a user to register a Certificate Authority with AWS so that upon a device&rsquo;s first TLS connection to AWS servers, if the device certificate was signed by this Certificate Authority, the certificate will be quickly activated by a lambda-function and be ready to use."><link rel=preload href=/scss/main.min.67b6b00bca6864cf5153909b7a58e2b18e24ec0397ca97400cf95bacffb3572c.css as=style><link href=/scss/main.min.67b6b00bca6864cf5153909b7a58e2b18e24ec0397ca97400cf95bacffb3572c.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><img class=navbar-logo src=https://docs.zymbit.com/Zymbit-Logo.gif></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://community.zymbit.com/ target=_blank><i class="fab fa-discourse"></i><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://zymbit.com target=_blank><i class="fa fa-home"></i><span>zymbit.com</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.02be9fc65589b650f7b57ea9a5ada879.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.02be9fc65589b650f7b57ea9a5ada879.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0 fa-ul"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span class=fa-li><i class=nav-open-tree></i></span><span>Zymbit Documentation</span></a><ul class="pr-md-3 ul-1"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><input type=checkbox id=m-getting-started-check checked>
<label for=m-getting-started-check><a href=/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span class=td-sidebar-link__section>Getting Started</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedscm-li><input type=checkbox id=m-getting-startedscm-check>
<label for=m-getting-startedscm-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedscm><span class=td-sidebar-link__section>Secure Compute Module - SCM</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscmquickstart-li><input type=checkbox id=m-getting-startedscmquickstart-check>
<label for=m-getting-startedscmquickstart-check><a href=/getting-started/scm/quickstart/ title="Quickstart - Secure Compute Module (SCM)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscmquickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscmproduction-mode-li><input type=checkbox id=m-getting-startedscmproduction-mode-check>
<label for=m-getting-startedscmproduction-mode-check><a href=/getting-started/scm/production-mode/ title="Enabling Production Mode - SCM" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscmproduction-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedscm-dev-kit3-li><input type=checkbox id=m-getting-startedscm-dev-kit3-check>
<label for=m-getting-startedscm-dev-kit3-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedscm-dev-kit3><span class=td-sidebar-link__section>Secure Compute Module - Dev Kit 3</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscm-dev-kit3quickstart-li><input type=checkbox id=m-getting-startedscm-dev-kit3quickstart-check>
<label for=m-getting-startedscm-dev-kit3quickstart-check><a href=/getting-started/scm-dev-kit3/quickstart/ title="Quickstart - SCM Developer Kit 3" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscm-dev-kit3quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscm-dev-kit3production-mode-li><input type=checkbox id=m-getting-startedscm-dev-kit3production-mode-check>
<label for=m-getting-startedscm-dev-kit3production-mode-check><a href=/getting-started/scm-dev-kit3/production-mode/ title="Enabling Production Mode - SCM" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscm-dev-kit3production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedscm-dev-kit2-li><input type=checkbox id=m-getting-startedscm-dev-kit2-check>
<label for=m-getting-startedscm-dev-kit2-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedscm-dev-kit2><span class=td-sidebar-link__section>Secure Compute Module - Dev Kit 2</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscm-dev-kit2quickstart-li><input type=checkbox id=m-getting-startedscm-dev-kit2quickstart-check>
<label for=m-getting-startedscm-dev-kit2quickstart-check><a href=/getting-started/scm-dev-kit2/quickstart/ title="Quickstart - SCM Developer Kit 2" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscm-dev-kit2quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscm-dev-kit2production-mode-li><input type=checkbox id=m-getting-startedscm-dev-kit2production-mode-check>
<label for=m-getting-startedscm-dev-kit2production-mode-check><a href=/getting-started/scm-dev-kit2/production-mode/ title="Enabling Production Mode - SCM" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscm-dev-kit2production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedsen-li><input type=checkbox id=m-getting-startedsen-check>
<label for=m-getting-startedsen-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedsen><span class=td-sidebar-link__section>Secure Edge Node</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedsenquickstart-li><input type=checkbox id=m-getting-startedsenquickstart-check>
<label for=m-getting-startedsenquickstart-check><a href=/getting-started/sen/quickstart/ title="Quickstart - Secure Edge Node" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedsenquickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedsenproduction-mode-li><input type=checkbox id=m-getting-startedsenproduction-mode-check>
<label for=m-getting-startedsenproduction-mode-check><a href=/getting-started/sen/production-mode/ title="Enabling Production Mode - Secure Edge Node" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedsenproduction-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedzymkey4-li><input type=checkbox id=m-getting-startedzymkey4-check>
<label for=m-getting-startedzymkey4-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedzymkey4><span class=td-sidebar-link__section>ZYMKEY4</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedzymkey4quickstart-li><input type=checkbox id=m-getting-startedzymkey4quickstart-check>
<label for=m-getting-startedzymkey4quickstart-check><a href=/getting-started/zymkey4/quickstart/ title="Quickstart - ZYMKEY4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedzymkey4quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedzymkey4production-mode-li><input type=checkbox id=m-getting-startedzymkey4production-mode-check>
<label for=m-getting-startedzymkey4production-mode-check><a href=/getting-started/zymkey4/production-mode/ title="Enabling Production Mode - ZYMKEY4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedzymkey4production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedhsm4-li><input type=checkbox id=m-getting-startedhsm4-check>
<label for=m-getting-startedhsm4-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedhsm4><span class=td-sidebar-link__section>HSM4</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm4quickstart-li><input type=checkbox id=m-getting-startedhsm4quickstart-check>
<label for=m-getting-startedhsm4quickstart-check><a href=/getting-started/hsm4/quickstart/ title="Quickstart - HSM4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm4quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm4production-mode-li><input type=checkbox id=m-getting-startedhsm4production-mode-check>
<label for=m-getting-startedhsm4production-mode-check><a href=/getting-started/hsm4/production-mode/ title="Enabling Production Mode - HSM4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm4production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedhsm6-li><input type=checkbox id=m-getting-startedhsm6-check>
<label for=m-getting-startedhsm6-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedhsm6><span class=td-sidebar-link__section>HSM6</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm6quickstart-li><input type=checkbox id=m-getting-startedhsm6quickstart-check>
<label for=m-getting-startedhsm6quickstart-check><a href=/getting-started/hsm6/quickstart/ title="Quickstart - HSM6" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm6quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm6production-mode-li><input type=checkbox id=m-getting-startedhsm6production-mode-check>
<label for=m-getting-startedhsm6production-mode-check><a href=/getting-started/hsm6/production-mode/ title="Enabling Production Mode - HSM6" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm6production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-bootware-preview-li><input type=checkbox id=m-bootware-preview-check checked>
<label for=m-bootware-preview-check><a href=/bootware-preview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-bootware-preview><span class=td-sidebar-link__section>Bootware Preview</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bootware-previewerror-codes-li><input type=checkbox id=m-bootware-previewerror-codes-check>
<label for=m-bootware-previewerror-codes-check><a href=/bootware-preview/error-codes/ title="Bootware Error Codes" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-bootware-previewerror-codes><span class=td-sidebar-link__page>Logging and Bootware Error Codes</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bootware-previewadditional-info-li><input type=checkbox id=m-bootware-previewadditional-info-check>
<label for=m-bootware-previewadditional-info-check><a href=/bootware-preview/additional-info/ title="Bootware Additional Info" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-bootware-previewadditional-info><span class=td-sidebar-link__page>Additional Bootware File Info</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-api-li><input type=checkbox id=m-api-check checked>
<label for=m-api-check><a href=/api/ title="API Documentation" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-api><span class=td-sidebar-link__section>API</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apiapi_docs_intro-li><input type=checkbox id=m-apiapi_docs_intro-check>
<label for=m-apiapi_docs_intro-check><a href=/api/api_docs_intro/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apiapi_docs_intro><span class=td-sidebar-link__page>Intro to Zymkey Application Utilities</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apic_api-li><input type=checkbox id=m-apic_api-check>
<label for=m-apic_api-check><a href=/api/c_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apic_api><span class=td-sidebar-link__page>C API Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apicpp_api-li><input type=checkbox id=m-apicpp_api-check>
<label for=m-apicpp_api-check><a href=/api/cpp_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apicpp_api><span class=td-sidebar-link__page>C++ API Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apipython_api-li><input type=checkbox id=m-apipython_api-check>
<label for=m-apipython_api-check><a href=/api/python_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apipython_api><span class=td-sidebar-link__page>Python API Documentation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zymbit-wallet-sdk-li><input type=checkbox id=m-zymbit-wallet-sdk-check checked>
<label for=m-zymbit-wallet-sdk-check><a href=/zymbit-wallet-sdk/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zymbit-wallet-sdk><span class=td-sidebar-link__section>Zymbit Wallet SDK</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zymbit-wallet-sdkzymbit-wallet-sdk-py-li><input type=checkbox id=m-zymbit-wallet-sdkzymbit-wallet-sdk-py-check>
<label for=m-zymbit-wallet-sdkzymbit-wallet-sdk-py-check><a href=/zymbit-wallet-sdk/zymbit-wallet-sdk-py/ title="Zymbit Wallet Python SDK Documentation" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zymbit-wallet-sdkzymbit-wallet-sdk-py><span class=td-sidebar-link__page>Zymbit Wallet Python SDK</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-troubleshooting-li><input type=checkbox id=m-troubleshooting-check checked>
<label for=m-troubleshooting-check><a href=/troubleshooting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-troubleshooting><span class=td-sidebar-link__section>FAQ and Troubleshooting</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinggeneral-li><input type=checkbox id=m-troubleshootinggeneral-check>
<label for=m-troubleshootinggeneral-check><a href=/troubleshooting/general/ title="General FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinggeneral><span class=td-sidebar-link__page>General</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingscm-li><input type=checkbox id=m-troubleshootingscm-check>
<label for=m-troubleshootingscm-check><a href=/troubleshooting/scm/ title="SCM FAQ and Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingscm><span class=td-sidebar-link__page>SCM</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingscm-mobo-li><input type=checkbox id=m-troubleshootingscm-mobo-check>
<label for=m-troubleshootingscm-mobo-check><a href=/troubleshooting/scm-mobo/ title="SCM Motherboard D35 FAQ and Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingscm-mobo><span class=td-sidebar-link__page>SCM Motherboard D35</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingzymkey4-li><input type=checkbox id=m-troubleshootingzymkey4-check>
<label for=m-troubleshootingzymkey4-check><a href=/troubleshooting/zymkey4/ title="ZYMKEY4 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinghsm4-li><input type=checkbox id=m-troubleshootinghsm4-check>
<label for=m-troubleshootinghsm4-check><a href=/troubleshooting/hsm4/ title="HSM4 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinghsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinghsm6-li><input type=checkbox id=m-troubleshootinghsm6-check>
<label for=m-troubleshootinghsm6-check><a href=/troubleshooting/hsm6/ title="HSM6 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinghsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><input type=checkbox id=m-reference-check checked>
<label for=m-reference-check><a href=/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span class=td-sidebar-link__section>Reference</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceproduct-briefs-li><input type=checkbox id=m-referenceproduct-briefs-check>
<label for=m-referenceproduct-briefs-check><a href=/reference/product-briefs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceproduct-briefs><span class=td-sidebar-link__section>Product Briefs</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefszymkey4-li><input type=checkbox id=m-referenceproduct-briefszymkey4-check>
<label for=m-referenceproduct-briefszymkey4-check><a href=https://www.zymbit.com/datasheets/zymkey-4i title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefszymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefshsm4-li><input type=checkbox id=m-referenceproduct-briefshsm4-check>
<label for=m-referenceproduct-briefshsm4-check><a href=https://www.zymbit.com/datasheets/hsm4 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefshsm6-li><input type=checkbox id=m-referenceproduct-briefshsm6-check>
<label for=m-referenceproduct-briefshsm6-check><a href=https://www.zymbit.com/datasheets/hsm6 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefsmfg-app-li><input type=checkbox id=m-referenceproduct-briefsmfg-app-check>
<label for=m-referenceproduct-briefsmfg-app-check><a href=https://www.zymbit.com/datasheets/manufacturing-appliance-1 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefsmfg-app><span class=td-sidebar-link__page>Manufacturing Appliance</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefsscm-li><input type=checkbox id=m-referenceproduct-briefsscm-check>
<label for=m-referenceproduct-briefsscm-check><a href=https://www.zymbit.com/scm/ title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefsscm><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceengineering-notes-li><input type=checkbox id=m-referenceengineering-notes-check>
<label for=m-referenceengineering-notes-check><a href=/reference/engineering-notes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceengineering-notes><span class=td-sidebar-link__section>Engineering Notes</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceengineering-notesen-20230721-scm-mobo-li><input type=checkbox id=m-referenceengineering-notesen-20230721-scm-mobo-check>
<label for=m-referenceengineering-notesen-20230721-scm-mobo-check><a href=./Zymbit-Engineering-Note-20230721-SCM-Motherboard-USB.pdf title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceengineering-notesen-20230721-scm-mobo><span class=td-sidebar-link__page>Engineering Note 20230721 SCM Motherboard - USB Power</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceengineering-notesen-20221011-hsm-perim-li><input type=checkbox id=m-referenceengineering-notesen-20221011-hsm-perim-check>
<label for=m-referenceengineering-notesen-20221011-hsm-perim-check><a href=./Zymbit-Engineering-Note-20221011-HSM-Using-Perim-Detect.pdf title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceengineering-notesen-20221011-hsm-perim><span class=td-sidebar-link__page>Engineering Note 20221011 HSM4/HSM6 - Using Perimeter Detect</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecad-li><input type=checkbox id=m-referencecad-check>
<label for=m-referencecad-check><a href=/reference/cad/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referencecad><span class=td-sidebar-link__section>CAD Files</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadzymkey4-li><input type=checkbox id=m-referencecadzymkey4-check>
<label for=m-referencecadzymkey4-check><a href=/reference/cad/zymkey4/ title=Zymkey4 class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadhsm4-li><input type=checkbox id=m-referencecadhsm4-check>
<label for=m-referencecadhsm4-check><a href=/reference/cad/hsm4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadhsm6-li><input type=checkbox id=m-referencecadhsm6-check>
<label for=m-referencecadhsm6-check><a href=/reference/cad/hsm6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadscm-li><input type=checkbox id=m-referencecadscm-check>
<label for=m-referencecadscm-check><a href=/reference/cad/scm/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadscm><span class=td-sidebar-link__page>Secure Compute Module (SCM)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecaddeveloperkit2-li><input type=checkbox id=m-referencecaddeveloperkit2-check>
<label for=m-referencecaddeveloperkit2-check><a href=/reference/cad/developerkit2/ title="SCM Developer Kit 2 Assembly" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecaddeveloperkit2><span class=td-sidebar-link__page>Developer Kit (D35 I/O Board)</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceconformity-li><input type=checkbox id=m-referenceconformity-check>
<label for=m-referenceconformity-check><a href=/reference/conformity/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceconformity><span class=td-sidebar-link__section>Conformity Documents</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityscm-li><input type=checkbox id=m-referenceconformityscm-check>
<label for=m-referenceconformityscm-check><a href=/reference/conformity/scm/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityscm><span class=td-sidebar-link__page>Secure Compute Family Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityzymkey4-li><input type=checkbox id=m-referenceconformityzymkey4-check>
<label for=m-referenceconformityzymkey4-check><a href=/reference/conformity/zymkey4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityzymkey4><span class=td-sidebar-link__page>Zymkey4 Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityhsm4-li><input type=checkbox id=m-referenceconformityhsm4-check>
<label for=m-referenceconformityhsm4-check><a href=/reference/conformity/hsm4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm4><span class=td-sidebar-link__page>HSM4 Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityhsm6-li><input type=checkbox id=m-referenceconformityhsm6-check>
<label for=m-referenceconformityhsm6-check><a href=/reference/conformity/hsm6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm6><span class=td-sidebar-link__page>HSM6 Conformity Documents</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepower-quality-li><input type=checkbox id=m-referencepower-quality-check>
<label for=m-referencepower-quality-check><a href=/reference/power-quality/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencepower-quality><span class=td-sidebar-link__page>Power Quality Considerations</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencebinding-li><input type=checkbox id=m-referencebinding-check>
<label for=m-referencebinding-check><a href=/reference/binding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencebinding><span class=td-sidebar-link__page>Binding, Device ID, and Authentication</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereserved-pins-li><input type=checkbox id=m-referencereserved-pins-check>
<label for=m-referencereserved-pins-check><a href=/reference/reserved-pins/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencereserved-pins><span class=td-sidebar-link__page>SCM Reserved Pins</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpu-scaling-li><input type=checkbox id=m-referencecpu-scaling-check>
<label for=m-referencecpu-scaling-check><a href=/reference/cpu-scaling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpu-scaling><span class=td-sidebar-link__page>CPU Scaling Governor</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereal-time-clock-li><input type=checkbox id=m-referencereal-time-clock-check>
<label for=m-referencereal-time-clock-check><a href=/reference/real-time-clock/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencereal-time-clock><span class=td-sidebar-link__page>Real Time Clock Operation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><input type=checkbox id=m-tutorials-check checked>
<label for=m-tutorials-check><a href=/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorials><span class=td-sidebar-link__section>Tutorials</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssupervised-boot-li><input type=checkbox id=m-tutorialssupervised-boot-check>
<label for=m-tutorialssupervised-boot-check><a href=/tutorials/supervised-boot/ title="Working with SCM Supervised Boot" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssupervised-boot><span class=td-sidebar-link__page>Supervised Boot (SCM)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsalternative-gpio-li><input type=checkbox id=m-tutorialsalternative-gpio-check>
<label for=m-tutorialsalternative-gpio-check><a href=/tutorials/alternative-gpio/ title="Using an Alternative GPIO Pin" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsalternative-gpio><span class=td-sidebar-link__page>Alternative GPIO Pin</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsdigital-wallet-li><input type=checkbox id=m-tutorialsdigital-wallet-check>
<label for=m-tutorialsdigital-wallet-check><a href=/tutorials/digital-wallet/ title="Zymbit Embedded Hardware Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdigital-wallet><span class=td-sidebar-link__section>Embedded Hardware Wallet</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletwallet-example-li><input type=checkbox id=m-tutorialsdigital-walletwallet-example-check>
<label for=m-tutorialsdigital-walletwallet-example-check><a href=/tutorials/digital-wallet/wallet-example/ title="Working with the Zymbit Hardware Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletwallet-example><span class=td-sidebar-link__page>Zymbit Hardware Wallet</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletzymbit-wallet-python-sdk-li><input type=checkbox id=m-tutorialsdigital-walletzymbit-wallet-python-sdk-check>
<label for=m-tutorialsdigital-walletzymbit-wallet-python-sdk-check><a href=/tutorials/digital-wallet/zymbit-wallet-python-sdk/ title="Working with Zymbit's Wallet Python SDK" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletzymbit-wallet-python-sdk><span class=td-sidebar-link__page>Zymbit Wallet Python SDK Tutorial</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletslip39-example-li><input type=checkbox id=m-tutorialsdigital-walletslip39-example-check>
<label for=m-tutorialsdigital-walletslip39-example-check><a href=/tutorials/digital-wallet/slip39-example/ title="SLIP39 and Shamir's Wallet Recovery Example" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletslip39-example><span class=td-sidebar-link__page>SLIP39 and Shamir's</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletoversight-example-li><input type=checkbox id=m-tutorialsdigital-walletoversight-example-check>
<label for=m-tutorialsdigital-walletoversight-example-check><a href=/tutorials/digital-wallet/oversight-example/ title="Creating an Oversight (Read Only) Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletoversight-example><span class=td-sidebar-link__page>Oversight Wallet</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsencrypt-rfs-li><input type=checkbox id=m-tutorialsencrypt-rfs-check>
<label for=m-tutorialsencrypt-rfs-check><a href=/tutorials/encrypt-rfs/ title="Encrypting Root File System with Zymbit Security Modules" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfs><span class=td-sidebar-link__page>Encrypt Root File System</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssensor-data-li><input type=checkbox id=m-tutorialssensor-data-check>
<label for=m-tutorialssensor-data-check><a href=/tutorials/sensor-data/ title="Encrypting & Decrypting Sensor Data on Disk" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssensor-data><span class=td-sidebar-link__page>Encrypt Sensor Data</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsaws-iot-li><input type=checkbox id=m-tutorialsaws-iot-check checked>
<label for=m-tutorialsaws-iot-check><a href=/tutorials/aws-iot/ title="AWS IoT Integrations & Client Certificates" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsaws-iot><span class=td-sidebar-link__section>Integrate Zymbit with AWS</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotverify-sigs-li><input type=checkbox id=m-tutorialsaws-iotverify-sigs-check>
<label for=m-tutorialsaws-iotverify-sigs-check><a href=/tutorials/aws-iot/verify-sigs/ title="How to Verify Signatures against Public Key on AWS and Other Devices" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotverify-sigs><span class=td-sidebar-link__page>Verify Signatures</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iottls-li><input type=checkbox id=m-tutorialsaws-iottls-check>
<label for=m-tutorialsaws-iottls-check><a href=/tutorials/aws-iot/tls/ title="AWS IoT - TLS Client Certificate Authentication" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iottls><span class=td-sidebar-link__page>Transport Level Security</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotgreengrass-li><input type=checkbox id=m-tutorialsaws-iotgreengrass-check>
<label for=m-tutorialsaws-iotgreengrass-check><a href=/tutorials/aws-iot/greengrass/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotgreengrass><span class=td-sidebar-link__page>Getting Started with AWS IoT Greengrass</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotintegrate-li><input type=checkbox id=m-tutorialsaws-iotintegrate-check>
<label for=m-tutorialsaws-iotintegrate-check><a href=/tutorials/aws-iot/integrate/ title="How to Integrate Zymbit with AWS Credentials Provider" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotintegrate><span class=td-sidebar-link__page>Integrate with AWS Credentials Provider</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotjitr-li><input type=checkbox id=m-tutorialsaws-iotjitr-check>
<label for=m-tutorialsaws-iotjitr-check><a href=/tutorials/aws-iot/jitr/ title="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotjitr><span class="td-sidebar-nav-active-item td-sidebar-link__page">Just In Time Registration</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsperimeter-detect-li><input type=checkbox id=m-tutorialsperimeter-detect-check>
<label for=m-tutorialsperimeter-detect-check><a href=/tutorials/perimeter-detect/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsperimeter-detect><span class=td-sidebar-link__section>Perimeter Detect</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectzymkey4-li><input type=checkbox id=m-tutorialsperimeter-detectzymkey4-check>
<label for=m-tutorialsperimeter-detectzymkey4-check><a href=/tutorials/perimeter-detect/zymkey4/ title="Perimeter Detect: ZYMKEY4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detecthsm4-li><input type=checkbox id=m-tutorialsperimeter-detecthsm4-check>
<label for=m-tutorialsperimeter-detecthsm4-check><a href=/tutorials/perimeter-detect/hsm4/ title="Perimeter Detect: HSM4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detecthsm6-li><input type=checkbox id=m-tutorialsperimeter-detecthsm6-check>
<label for=m-tutorialsperimeter-detecthsm6-check><a href=/tutorials/perimeter-detect/hsm6/ title="Perimeter Detect: HSM6" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectscm-li><input type=checkbox id=m-tutorialsperimeter-detectscm-check>
<label for=m-tutorialsperimeter-detectscm-check><a href=/tutorials/perimeter-detect/scm/ title="Perimeter Detect: SCM" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectscm><span class=td-sidebar-link__page>SCM</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectsen-li><input type=checkbox id=m-tutorialsperimeter-detectsen-check>
<label for=m-tutorialsperimeter-detectsen-check><a href=/tutorials/perimeter-detect/sen/ title="Perimeter Detect: Secure Edge Node" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectsen><span class=td-sidebar-link__page>Secure Edge Node</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectexamples-li><input type=checkbox id=m-tutorialsperimeter-detectexamples-check>
<label for=m-tutorialsperimeter-detectexamples-check><a href=/tutorials/perimeter-detect/examples/ title="Perimeter Detect Circuit Examples" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectexamples><span class=td-sidebar-link__page>CIRCUIT EXAMPLES</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsprotokit-li><input type=checkbox id=m-tutorialsprotokit-check>
<label for=m-tutorialsprotokit-check><a href=/tutorials/protokit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsprotokit><span class=td-sidebar-link__page>ProtoKit5</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><ul><li></li></ul></li></ul></li><li><a href=#overview>Overview</a></li><li><a href=#prerequisites>Prerequisites:</a></li><li><a href=#programmatic-setup>Programmatic Setup</a></li><li><a href=#register-certificate-authority-with-aws>Register Certificate Authority with AWS</a><ul><li><a href=#create-ca>Create CA</a></li><li><a href=#register-ca-with-aws>Register CA with AWS</a></li></ul></li><li><a href=#generate-zymkey-certificate>Generate Zymkey Certificate</a></li><li><a href=#creating-the-lambda-function>Creating the Lambda function</a><ul><li><ul><li><a href=#creating-iam-role-for-the-lambda-function>Creating IAM Role for the Lambda function</a></li></ul></li></ul></li><li><a href=#creating-the-aws-iot-rule>Creating the AWS IoT Rule</a></li><li><a href=#testing-jitr-with-tls-connection>Testing JITR with TLS Connection</a></li></ul></nav></div></aside><main class="col-12 col-md-8 col-xl-7 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/>Tutorials</a></li><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/aws-iot/>Integrate Zymbit with AWS</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.zymbit.com/tutorials/aws-iot/jitr/>Just In Time Registration</a></li></ol></nav><div class=td-content><h1>AWS IoT - Just in Time Registration of Client Certificates using Lambda functions</h1><header class=article-meta></header><h5 id=how-to-automatically-generate-a-client-certificate-register-your-own-ca-and-authenticate-a-device-to-establish-a-tls-connection-to-aws-iot>How to automatically generate a client certificate, register your own CA, and authenticate a device to establish a TLS connection to AWS IoT</h5><hr><h2 id=overview>Overview</h2><p>AWS IoT requires an IoT device to register and activate a certificate with AWS before communicating. For large scale deployments, AWS provides an automated process called <strong>Just-In-Time-Registration</strong>. This allows a user to register a Certificate Authority with AWS so that upon a device&rsquo;s first TLS connection to AWS servers, if the device certificate was signed by this Certificate Authority, the certificate will be quickly activated by a lambda-function and be ready to use.</p><p><img src=aws-iot-jitr.png alt=AWS-IoT-JITR-graphic-2></p><hr><h2 id=prerequisites>Prerequisites:</h2><ul><li>Follow the <a href=https://docs.zymbit.com/getting-started/>Getting Started guide</a> first.</li></ul><hr><h2 id=programmatic-setup>Programmatic Setup</h2><p>If you would like to use scripts to register your CA and Lambda function, there are a couple more things to set up. We recommend following the manual approach if your only doing this once or twice.</p><details><summary>Details</summary><br><p>Follow these instructions to set up the <a href=http://boto3.readthedocs.io/en/latest/guide/quickstart.html>boto3 module</a> for Python:</p><p>The boto3 module authenticates with AWS based on a IAM Access ID and Secret Key. The boto3 tutorial will ask you to setup an IAM user, here are some instructions on how to do so:</p><ol><li>From the <strong>AWS console</strong>, choose the <strong>IAM service</strong>.</li><li>Go to <strong>Users</strong> and select <strong>Add User</strong></li><li>Choose a <strong>username</strong> and check the <strong>Programmatic access box</strong></li><li>For simplicity, choose <strong>Attach existing policies directly</strong> and select <strong>AdministratorAccess</strong></li><li>If you wish to better manage your IAM credentials, feel free to customize your Access Policy.</li><li>Click <strong>Review</strong> and then <strong>Create User</strong></li><li><strong>Save the Access ID and Secret Key</strong> and <strong>follow the boto3 guide</strong>.</li></ol></details><hr><h2 id=register-certificate-authority-with-aws>Register Certificate Authority with AWS</h2><p>The following section will show how to generate your own CA using OpenSSL and register it with your AWS account.</p><details><summary>Details</summary><br><h3 id=create-ca>Create CA</h3><p><strong>Copy the lines below into a script called mk_ca.sh.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>set</span> -e
</span></span><span class=line><span class=cl>mkdir CA_files
</span></span><span class=line><span class=cl><span class=nb>cd</span> CA_files
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>openssl ecparam -genkey -name prime256v1 -out zk_ca.key
</span></span><span class=line><span class=cl><span class=nv>OPENSSL_CONF</span><span class=o>=</span>/etc/ssl/openssl.cnf openssl req <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -x509 -new -SHA256 -nodes -key zk_ca.key <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -days <span class=m>3650</span> -out zk_ca.crt <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -subj <span class=s2>&#34;/C=US/ST=California/L=Santa Barbara/O=Zymkey/CN=zymkey-verify.zymbit.com.dev&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cp zk_ca.crt zk_ca.pem
</span></span></code></pre></div><p><strong>You can then run the script in the command line by being in the same directory with the following command:</strong></p><pre><code>bash mk_ca.sh
</code></pre><p><strong>The script will create a directory called CA_files and a couple of files:</strong>
zk_ca.key: Private key for the created CA, will be supplied to OpenSSL for signing CSRs.
zk_ca.pem: PEM formatted certificate for the CA
zk_ca.crt: Same file as zk_ca.pem</p><hr><h3 id=register-ca-with-aws>Register CA with AWS</h3><p><strong>Manually</strong>:</p><ol><li><p>From the <strong>AWS IoT console</strong> select <strong>Secure</strong> then <strong>CA</strong> and then click <strong>Register</strong></p></li><li><p>Click <strong>register CA</strong></p></li><li><p>Follow the directions on the following screen to create a verification certificate.</p></li><li><p>When signing the verification certificate with your CA in <strong>Step 4</strong> run the following command:</p><pre><code> openssl x509 -req -in verificationCert.csr -CA CA_files/zk_ca.pem -CAkey CA_files/zk_ca.key -CAcreateserial -out verificationCert.crt -days 500 -sha256
</code></pre><p>Note that if you a different CA and not the demo one we generated, to change the <strong>-CA</strong> and <strong>-CAkey</strong> paths appropriately.</p></li><li><p>Click <strong>Select CA certificate</strong> and point to the correct <strong>.pem file</strong>. If you use the OpenSSL generated SSL point to <strong>CA_files/zk_ca.pem</strong></p></li><li><p>Click <strong>Select verification certificate</strong> and point to <strong>verificationCert.crt</strong> which was created in Step 4.</p></li><li><p>Select <strong>Active CA certificate</strong> and <strong>Enable auto-registration of device certificates</strong></p></li></ol><hr><p><strong>Programatically:</strong>
The following python script will <strong>automatically create a verification cert with a registration code</strong> and <strong>automatically active your Certificate Authority</strong>. While it may look a bit intimidating, all you have to worry about is the <strong>very last line</strong>, where you can <strong>change to point to your CA files</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>OpenSSL</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_AWS_verification_csr</span><span class=p>(</span><span class=n>registrationCode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>key</span> <span class=o>=</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>PKey</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>key</span><span class=o>.</span><span class=n>generate_key</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>TYPE_RSA</span><span class=p>,</span> <span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>req</span> <span class=o>=</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>X509Req</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>req</span><span class=o>.</span><span class=n>get_subject</span><span class=p>()</span><span class=o>.</span><span class=n>CN</span> <span class=o>=</span> <span class=n>registrationCode</span>
</span></span><span class=line><span class=cl>	<span class=n>req</span><span class=o>.</span><span class=n>set_pubkey</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>req</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=s2>&#34;sha256&#34;</span><span class=p>)</span>	
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>dump_certificate_request</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=n>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sign_CSR_with_CA</span><span class=p>(</span><span class=n>verification_csr</span><span class=p>,</span> <span class=n>CA_cert_path</span><span class=p>,</span> <span class=n>CA_key_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>ca_cert</span> <span class=o>=</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>load_certificate</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=nb>open</span><span class=p>(</span><span class=n>CA_cert_path</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=n>ca_key</span> <span class=o>=</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>load_privatekey</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=nb>open</span><span class=p>(</span><span class=n>CA_key_path</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=n>req</span> <span class=o>=</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>load_certificate_request</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=n>verification_csr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span> <span class=o>=</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>X509</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>set_subject</span><span class=p>(</span><span class=n>req</span><span class=o>.</span><span class=n>get_subject</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>set_serial_number</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>gmtime_adj_notBefore</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>gmtime_adj_notAfter</span><span class=p>(</span><span class=mi>24</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>set_issuer</span><span class=p>(</span><span class=n>ca_cert</span><span class=o>.</span><span class=n>get_subject</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>set_pubkey</span><span class=p>(</span><span class=n>req</span><span class=o>.</span><span class=n>get_pubkey</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=n>cert</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>ca_key</span><span class=p>,</span> <span class=s2>&#34;sha256&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>dump_certificate</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=n>cert</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>register_CA_AWS</span><span class=p>(</span><span class=n>CA_cert_path</span><span class=p>,</span> <span class=n>CA_key_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;iot&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_registration_code</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>registration_key</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;registrationCode&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>verification_pem</span> <span class=o>=</span> <span class=n>gen_AWS_verification_csr</span><span class=p>(</span><span class=n>registrationCode</span><span class=o>=</span><span class=n>registration_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>verification_cert</span> <span class=o>=</span> <span class=n>sign_CSR_with_CA</span><span class=p>(</span><span class=n>verification_csr</span><span class=o>=</span><span class=n>verification_pem</span><span class=p>,</span> <span class=n>CA_cert_path</span><span class=o>=</span><span class=n>CA_cert_path</span><span class=p>,</span> <span class=n>CA_key_path</span><span class=o>=</span><span class=n>CA_key_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>register_ca_certificate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=n>caCertificate</span><span class=o>=</span><span class=nb>open</span><span class=p>(</span><span class=n>CA_cert_path</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>		<span class=n>verificationCertificate</span><span class=o>=</span><span class=n>verification_cert</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=n>setAsActive</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=n>allowAutoRegistration</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>register_CA_AWS</span><span class=p>(</span><span class=n>CA_cert_path</span><span class=o>=</span><span class=s1>&#39;CA_files/zk_ca.crt&#39;</span><span class=p>,</span> <span class=n>CA_key_path</span><span class=o>=</span><span class=s1>&#39;CA_files/zk_ca.key&#39;</span><span class=p>)</span>	
</span></span></code></pre></div><p><strong>Copy the above lines into a file called activate_aws_ca.py and run with the following command:</strong></p><pre><code>python activate_aws_ca.py
</code></pre></details><hr><h2 id=generate-zymkey-certificate>Generate Zymkey Certificate</h2><p>The first thing we will do is generate a device certificate using Zymkey&rsquo;s private key. We will watch as this certificate gets activated on your AWS IoT console automatically on first connect. Make sure that you do not already have a Zymkey certificate registered on your AWS IoT console.</p><p><strong>Generate a Certificate Signing Request with Zymkey&rsquo;s private key using the following command</strong>:</p><pre><code>openssl req -key nonzymkey.key -new -out zymkey.csr -engine zymkey_ssl -keyform e -subj &quot;/C=US/ST=California/L=Santa Barbara/O=Zymbit/OU=Zymkey/CN=rpi.edge.zymbit.com&quot;
</code></pre><p>Note that the <strong>-subj</strong> line can be omitted or modified with your own information. If it is omitted, you will be prompted to enter your information on the command line.</p><p><strong>Signing the CSR to get a valid Zymkey certificate:</strong></p><p>Next we&rsquo;ll sign this CSR with your Certificate Authority. Save the following script in a file called <strong>sign_csr.sh</strong>. Make sure to change the <strong>-CA</strong> and <strong>-CAkey</strong> paths to point to the private key and certificate file for your certificate authority:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>set</span> -e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SCRIPT_NAME</span><span class=o>=</span><span class=k>$(</span>basename <span class=nv>$0</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span> -z <span class=nv>$2</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>SCRIPT_NAME</span><span class=si>}</span><span class=s2> &lt;csr filename&gt; &lt;crt filename&gt;&#34;</span> 1&gt;<span class=p>&amp;</span><span class=m>2</span> <span class=o>&amp;&amp;</span> <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>csr</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>crt</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl>openssl x509 -req -SHA256 -days <span class=m>3650</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -CA CA_files/zk_ca.crt -CAkey CA_files/zk_ca.key -CAcreateserial <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -in <span class=si>${</span><span class=nv>csr</span><span class=si>}</span> -out <span class=si>${</span><span class=nv>crt</span><span class=si>}</span>
</span></span></code></pre></div><p>Now run the script with the following command, where the first argument is the path to your CSR and the second argument the name you wish to give the signed Zymkey Certificate file.</p><pre><code>bash sign_csr.sh zymkey.csr zymkey.crt
</code></pre><hr><h2 id=creating-the-lambda-function>Creating the Lambda function</h2><p>Now we need to create and register the lambda function that will activate new certificates on your AWS account. This can be done either manually or programatically in Python. We&rsquo;ll start with the Manual method as it is simpler and more straightforward.</p><details><summary>Details</summary><br><p><strong>Manually:</strong></p><ol><li>From your <strong>AWS console</strong>, sign in <a href=https://aws.amazon.com/console/>here</a>, choose the <strong>Lambda</strong> service.</li><li>From the <strong>Lambda console</strong>, click on the orange <strong>Create Function</strong> button.</li><li>Click the <strong>Author from Scratch</strong> button.</li><li>Choose an appropriate <strong>function name</strong> and <strong>description</strong>. We will be using <strong>Node.js 12.x</strong> for the runtime environment.</li><li>Click <strong>Create function</strong>.</li><li>Copy the default JITR code from AWS located <a href=https://github.com/awslabs/aws-iot-examples/blob/master/justInTimeRegistration/deviceActivation.js>here</a> into <strong>index.js</strong> under Function code (If pasting doesn&rsquo;t work in their IDE, try Shift+Insert). Make sure that you <strong>change the region defined in the code</strong> to the appropriate value.</li><li>Now scroll to the top and click the <strong>Permissions</strong> tab.</li><li>Under <strong>Execution role</strong>, click <strong>Edit</strong>.</li><li>There should be an existing role listed under Existing role. Click the blue title <strong>View the role on the IAM console.</strong></li><li>This should take you to the IAM console. Click <strong>Attach policies</strong></li><li>Click <strong>Create policy</strong>, then the <strong>JSON</strong> tab.</li><li>Input the following policy</li></ol><pre tabindex=0><code>{ 
   &#34;Version&#34;:&#34;2012-10-17&#34;,
   &#34;Statement&#34;:[ 
      { 
         &#34;Effect&#34;:&#34;Allow&#34;,
         &#34;Action&#34;:[  
            &#34;logs:CreateLogGroup&#34;,
            &#34;logs:CreateLogStream&#34;,
            &#34;logs:PutLogEvents&#34;
         ],
         &#34;Resource&#34;:&#34;arn:aws:logs:*:*:*&#34;
      },
      { 
         &#34;Effect&#34;:&#34;Allow&#34;,
         &#34;Action&#34;:[  
            &#34;iot:UpdateCertificate&#34;,
            &#34;iot:CreatePolicy&#34;,
            &#34;iot:AttachPrincipalPolicy&#34;
         ],
         &#34;Resource&#34;:&#34;*&#34;
      }
   ]
}
</code></pre><ol start=13><li>Click <strong>Review policy</strong>.</li><li>Give the policy an appropriate name (maybe JITR) and click <strong>Create policy</strong>.</li><li>On the left hand bar, click <strong>Roles</strong>.</li><li>Click on your lambda role name. It should start with the function name you defined in step 4, followed by role, then some random characters.</li><li>Click <strong>Attach policies</strong>.</li><li>Click the box next to the policy we just created in step 14.</li><li>Click <strong>Attach policy</strong>.</li><li>Click the X to the right of the old policy titled <strong>AWSLambdaBasicExecutionRole</strong>, and click <strong>Detach</strong>.</li></ol><p><strong>Programatically:</strong>
The creation of an AWS lambda function through python scripts is a little more intricate than the manual proccess and will need to be divided into numerous parts. The creation of the lambda function will be divided into these steps:</p><ol><li>Creating a new IAM role for the lambda function.</li><li>Creating a new Policy for this IAM role.</li><li>Attaching the Policy to the IAM role.</li><li>Create the lambda function, attaching the IAM role to this function.</li></ol><p>&lt;details=&ldquo;Details&rdquo;></p><h4 id=creating-iam-role-for-the-lambda-function>Creating IAM Role for the Lambda function</h4><p>The first thing we need to do is create an IAM Role. This role gives the Lambda function permission to execute and perform its registration of new certificates.</p><p><strong>Creating this IAM role furthermore requires you to specify 2 things</strong>:</p><p><strong>IAM Trust Document</strong>: This is a document that details what AWS resources are allowed to assume this IAM role. Below is an example IAM trust document we will use that allows lambda services to assume this JITR role. Save the document in a file called <strong>trust_document.txt</strong>.</p><pre tabindex=0><code>{
  &#34;Version&#34;: &#34;2012-10-17&#34;,
  &#34;Statement&#34;: [
    {
      &#34;Effect&#34;: &#34;Allow&#34;,
      &#34;Principal&#34;: {
        &#34;Service&#34;: &#34;lambda.amazonaws.com&#34;
      },
      &#34;Action&#34;: &#34;sts:AssumeRole&#34;
    }
  ]
}
</code></pre><p><strong>Role Policy</strong>: This is a document describing what actions an IAM role may take. This policy is created and then attached to whatever role you wish. The following policy will allow the JITR role to create AWS logs as well as register/activate new certificates and attach policies to them. Save the document in a file called <strong>policy_document.txt</strong>.</p><pre tabindex=0><code>{ 
   &#34;Version&#34;:&#34;2012-10-17&#34;,
   &#34;Statement&#34;:[ 
      { 
         &#34;Effect&#34;:&#34;Allow&#34;,
         &#34;Action&#34;:[  
            &#34;logs:CreateLogGroup&#34;,
            &#34;logs:CreateLogStream&#34;,
            &#34;logs:PutLogEvents&#34;
         ],
         &#34;Resource&#34;:&#34;arn:aws:logs:*:*:*&#34;
      },
      { 
         &#34;Effect&#34;:&#34;Allow&#34;,
         &#34;Action&#34;:[  
            &#34;iot:UpdateCertificate&#34;,
            &#34;iot:CreatePolicy&#34;,
            &#34;iot:AttachPrincipalPolicy&#34;
         ],
         &#34;Resource&#34;:&#34;*&#34;
      }
   ]
}
</code></pre><p>Finally, this is the python code that will take care of the creation of the IAM role. The first thing it does is create an IAM role with the specified Trust settings. Then it creates an IAM policy with the aforementioned policy settings. Finally it will attach the policy to the role. This role will be used by the JITR lambda. <strong>By default it&rsquo;ll read the two documents trust_document.txt and policy_document.txt from the same directory that the code is executed in. So save the python script in a file called create_jitr_lambda.py in the same directory as these files, or modify the path to these files in the code. They can be either relative or absolute</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=n>iam_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;IAM&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;trust_document.txt&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>trust_role</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>trust_document</span> <span class=o>=</span> <span class=n>trust_role</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;policy_document.txt&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>policy</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>policy_document</span> <span class=o>=</span> <span class=n>policy</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Creating the IAM role with the specified Trust </span>
</span></span><span class=line><span class=cl><span class=n>create_role_response</span> <span class=o>=</span> <span class=n>iam_client</span><span class=o>.</span><span class=n>create_role</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>RoleName</span><span class=o>=</span><span class=s1>&#39;jitr_role&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>AssumeRolePolicyDocument</span><span class=o>=</span><span class=n>trust_document</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>Description</span><span class=o>=</span><span class=s1>&#39;AWS Role given to the JITR lambda&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Creating the IAM policy with the specified P</span>
</span></span><span class=line><span class=cl><span class=n>create_policy_resopnse</span> <span class=o>=</span> <span class=n>iam_client</span><span class=o>.</span><span class=n>create_policy</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>PolicyName</span><span class=o>=</span><span class=n>policy_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>PolicyDocument</span><span class=o>=</span><span class=n>policy_document</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>Description</span><span class=s1>&#39;Policy that allows JITR lambda to execute actions.&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>	
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=c1># Attaching the IAM policy to the IAM role	</span>
</span></span><span class=line><span class=cl><span class=n>attach_response</span> <span class=o>=</span> <span class=n>iam_client</span><span class=o>.</span><span class=n>attach_role_policy</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>RoleName</span><span class=o>=</span><span class=n>role_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>PolicyArn</span><span class=o>=</span><span class=n>create_policy_response</span><span class=p>[</span><span class=s1>&#39;Policy&#39;</span><span class=p>][</span><span class=s1>&#39;Arn&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p><strong>After saving the code in a file called create_jitr_lambda.py, you can execute by running the following command:</strong></p><pre><code>python create_jitr_lambda.py
</code></pre><h5 id=creating-lambda-function>Creating Lambda function</h5><p>The lambda function will then be created with the following script. The code for the lambda function will be in a zipped file named <strong>jitr_lambda.zip</strong>. Download the lambda code <a href=https://github.com/awslabs/aws-iot-examples/blob/master/justInTimeRegistration/deviceActivation.js>here</a> <strong>and make sure to modify the region-name in the code to your approrpiate region</strong>.</p><p>Next, zip up the code in a file called <strong>jitr_lambda.zip</strong> and keep it in the same directory as the following python script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Download the zip file with the lambda code and save it in the same directory as this script.</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;jitr_lambda.zip&#39;</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>   
</span></span><span class=line><span class=cl>	<span class=n>filecontent</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lambda_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;lambda&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>create_lambda_response</span> <span class=o>=</span> <span class=n>lambda_client</span><span class=o>.</span><span class=n>create_function</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>FunctionName</span><span class=o>=</span><span class=s1>&#39;jitr-lambda&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>Runtime</span><span class=o>=</span><span class=s1>&#39;nodejs4.3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=c1>#By appending this script unto create_jitr_lambda.py you do not need to find the role_ARN, as it will already be stored in this object.</span>
</span></span><span class=line><span class=cl>	<span class=n>Role</span><span class=o>=</span><span class=n>attach_response</span><span class=p>[</span><span class=s1>&#39;Arn&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>Handler</span><span class=o>=</span><span class=s1>&#39;index.handler	&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>Code</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;ZipFile&#39;</span><span class=p>:</span> <span class=n>filecontent</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>Description</span><span class=o>=</span><span class=s1>&#39;Lambda function for Just-in-time-Registration&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>	
</span></span></code></pre></div><p><strong>Note that this script requires the Role ARN for the IAM role you just created. If you append this script to the file create_jitr_lambda.py, it will already be included in the response from attaching the policy to the jitr_role, and you won&rsquo;t have to do anything.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Do not copy and run these lines, this is just showing where the role_ARN was taken from</span>
</span></span><span class=line><span class=cl><span class=n>attach_response</span> <span class=o>=</span> <span class=n>iam_client</span><span class=o>.</span><span class=n>attach_role_policy</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>RoleName</span><span class=o>=</span><span class=n>role_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>PolicyArn</span><span class=o>=</span><span class=n>create_policy_response</span><span class=p>[</span><span class=s1>&#39;Policy&#39;</span><span class=p>][</span><span class=s1>&#39;Arn&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>role_ARN</span> <span class=o>=</span> <span class=n>attach_response</span><span class=p>[</span><span class=s1>&#39;Arn&#39;</span><span class=p>]</span>
</span></span></code></pre></div><p><strong>Otherwise, if you don&rsquo;t wish to append the following script to the create_jitr_lambda.py, here is how you can find the appropriate role_arn</strong>:</p><ol><li>From your <strong>AWS Console</strong> choose the <strong>IAM service</strong>.</li><li>On the <strong>left hand bar</strong>, click on <strong>Roles</strong></li><li>Select the role titled <strong>jitr_role</strong>.</li><li>Copy the section following <strong>Role ARN</strong></li><li>In the following python script, replace: <strong>Role=attach_resopnse[&lsquo;Arn&rsquo;]</strong> with <strong>Role=the_correct_role_arn</strong></li></ol><p>Save the script in an appropriate location, and run it.</p></details></details><hr><h2 id=creating-the-aws-iot-rule>Creating the AWS IoT Rule</h2><p>Finally we will be setting up an AWS IoT Rule to forward all requests with an unregistered certificate to the lambda function that will activate the certificate.</p><p>First we need our caCertificateID</p><ol><li>Under <strong>Secure</strong> click <strong>CAs</strong>.</li><li>Click on the CA Certificate you created earlier.</li><li>Under the CA Certificate ARN, copy the last section of characters possesing your CA Certificate ID.</li></ol><pre tabindex=0><code>arn:aws:iot:us-east-2:302973482904:cacert/&lt;caCertificateID&gt;
</code></pre><p>Now to create the rule</p><ol><li>From your <strong>AWS Console</strong>, click on the <strong>AWS IoT</strong> service.</li><li>On the left hand side, select <strong>Act</strong> and then click <strong>Rules</strong>.</li><li>Click <strong>Create</strong> then give an appropriate Name and Description.</li><li>Using <strong>SQL version 2016-03-23</strong> use the following Rule query statement:</li></ol><pre tabindex=0><code>SELECT * FROM &#39;$aws/events/certificates/registered/&lt;caCertificateID&gt;&#39; 
</code></pre><ol start=5><li>Click <strong>Add action</strong>.</li><li>Click <strong>Send a message to a Lambda function</strong> and <strong>Configure Action</strong>.</li><li>Select your lambda function and click <strong>Add action</strong>.</li><li>Finally click <strong>Create rule</strong>.</li></ol><hr><h2 id=testing-jitr-with-tls-connection>Testing JITR with TLS Connection</h2><p>You can now test your JITR setup by doing a TLS connection with your AWS IoT endpoint and presenting your Zymkey device certificate.</p><details><summary>Details</summary><br><p><strong>The first thing to do is to look for your AWS endpoint.</strong></p><ol><li><p>From the <strong>AWS IoT console screen</strong>, click on the gear that says <strong>Settings</strong> on the left hand bar.</p></li><li><p>Copy the link in the <strong>Custom Endpoint</strong> box.</p></li><li><p>Now on the <strong>left hand bar</strong>, click on the <strong>Test</strong> option.</p></li><li><p>Under <strong>Subscribe</strong> and <strong>Subscription Topic</strong>, type in <strong>hello/world</strong>.</p></li><li><p>Test your TLS connection with the following <strong>CURL</strong> command pointing to your <strong>CA file</strong> and your <strong>Zymkey certificate</strong>:</p></li><li><p>Use <strong>CURL</strong> to test your TLS connection, <strong>pointing to your CA file</strong>:</p><pre><code>	curl --tlsv1.2 --cacert zk_ca.pem --cert zymkey.crt --key nonzymkey.key --engine zymkey_ssl --key-type ENG -v -X POST -d &quot;{ \&quot;hello\&quot;: \&quot;world\&quot;}&quot; &quot;https://endpoint.iot.region.amazonaws.com:8443/topics/hello/world&quot;
</code></pre></li></ol><p>The TLS connection should go through, and you should see something like this in your command line:</p><p><img src=jitr-curl.png alt=curl|690x122></p><p>On first connection TLS connection, the TLS handshake should finish, but you should receive empty response from server:</p><p><img src=jitr-empty.png alt=response_empty></p><p>On second TLS connection, you will see that the certifiacte is registered and you will get a correct response:</p><p><img src=jitr-forbidden.png alt=response_forbidden></p><p>You can also check under your certifiactes in your AWS IoT console to see that the new certifciacte is indeed registered. Getting a non-empty response indicates that the certificate is indeed registerd on you AWS account. However, even though the certificate is activated, it does not have a valid policy granting it permission to publish data to your AWS IoT account, which results in the <strong>forbidden</strong> response. Fortunately you can always <strong>modify the jitr lambda function</strong> to attach an <strong>appropriate policy to the certificate upon registration/activation</strong> if you wish to do so.</p></details></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@8.11.2/dist/mermaid.min.js integrity=sha384-m8Pdaep6Qk8sW3J6XhPOiwUww3maU9HxZTLvEfSEB4e1UVvTdHyfJsYmEfYqvwLC crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script><script src=/js/main.min.02544d8a35777f648f6dd431ca9785fc5c1877392035fcd33a35b212950bc741.js integrity="sha256-AlRNijV3f2SPbdQxypeF/FwYdzkgNfzTOjWyEpULx0E=" crossorigin=anonymous></script></body></html>