<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Encrypting Root File System with Zymbit Security Modules |</title><meta name=description content="
Prerequisites
Raspberry Pi:

Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit)

Nvidia Jetson:

Jetson Xavier NX or Nano
Jetpack 4.4 …"><meta property="og:title" content="Encrypting Root File System with Zymbit Security Modules"><meta property="og:description" content="Prerequisites Raspberry Pi:
Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit) Nvidia Jetson:
Jetson Xavier NX or Nano Jetpack 4.4 or earlier BACKGROUND To skip the background information and start encrypting your RFS, click here.
WHY ENCRYPT? There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.zymbit.com/tutorials/encrypt-rfs/"><meta property="og:image" content="https://docs.zymbit.com/doks.png"><meta property="article:section" content="tutorials"><meta property="article:modified_time" content="2022-06-02T12:27:47-07:00"><meta property="og:site_name" content="Zymbit Documentation"><meta itemprop=name content="Encrypting Root File System with Zymbit Security Modules"><meta itemprop=description content="Prerequisites Raspberry Pi:
Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit) Nvidia Jetson:
Jetson Xavier NX or Nano Jetpack 4.4 or earlier BACKGROUND To skip the background information and start encrypting your RFS, click here.
WHY ENCRYPT? There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned."><meta itemprop=dateModified content="2022-06-02T12:27:47-07:00"><meta itemprop=wordCount content="2159"><meta itemprop=image content="https://docs.zymbit.com/doks.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://docs.zymbit.com/doks.png"><meta name=twitter:title content="Encrypting Root File System with Zymbit Security Modules"><meta name=twitter:description content="Prerequisites Raspberry Pi:
Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit) Nvidia Jetson:
Jetson Xavier NX or Nano Jetpack 4.4 or earlier BACKGROUND To skip the background information and start encrypting your RFS, click here.
WHY ENCRYPT? There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned."><link rel=preload href=/scss/main.min.67b6b00bca6864cf5153909b7a58e2b18e24ec0397ca97400cf95bacffb3572c.css as=style><link href=/scss/main.min.67b6b00bca6864cf5153909b7a58e2b18e24ec0397ca97400cf95bacffb3572c.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><img class=navbar-logo src=https://docs.zymbit.com/Zymbit-Logo.gif></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://community.zymbit.com/ target=_blank><i class="fab fa-discourse"></i><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://zymbit.com target=_blank><i class="fa fa-home"></i><span>zymbit.com</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9573050f4889277d6b5c448f00f1e0d7.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9573050f4889277d6b5c448f00f1e0d7.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0 fa-ul"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span class=fa-li><i class=nav-open-tree></i></span><span>Zymbit Documentation</span></a><ul class="pr-md-3 ul-1"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><input type=checkbox id=m-getting-started-check checked>
<label for=m-getting-started-check><a href=/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span class=td-sidebar-link__section>Getting Started</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedscm-li><input type=checkbox id=m-getting-startedscm-check>
<label for=m-getting-startedscm-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedscm><span class=td-sidebar-link__section>Secure Compute Module - SCM</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscmquickstart-li><input type=checkbox id=m-getting-startedscmquickstart-check>
<label for=m-getting-startedscmquickstart-check><a href=/getting-started/scm/quickstart/ title="SCM - Getting Started" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscmquickstart><span class=td-sidebar-link__page>Getting Started</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscmproduction-mode-li><input type=checkbox id=m-getting-startedscmproduction-mode-check>
<label for=m-getting-startedscmproduction-mode-check><a href=/getting-started/scm/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscmproduction-mode><span class=td-sidebar-link__page>Enabling Production Mode - SCM</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedzymkey4-li><input type=checkbox id=m-getting-startedzymkey4-check>
<label for=m-getting-startedzymkey4-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedzymkey4><span class=td-sidebar-link__section>ZYMKEY4</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedzymkey4quickstart-li><input type=checkbox id=m-getting-startedzymkey4quickstart-check>
<label for=m-getting-startedzymkey4quickstart-check><a href=/getting-started/zymkey4/quickstart/ title="Zymkey4 Quickstart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedzymkey4quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedzymkey4production-mode-li><input type=checkbox id=m-getting-startedzymkey4production-mode-check>
<label for=m-getting-startedzymkey4production-mode-check><a href=/getting-started/zymkey4/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedzymkey4production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedhsm4-li><input type=checkbox id=m-getting-startedhsm4-check>
<label for=m-getting-startedhsm4-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedhsm4><span class=td-sidebar-link__section>HSM4</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm4quickstart-li><input type=checkbox id=m-getting-startedhsm4quickstart-check>
<label for=m-getting-startedhsm4quickstart-check><a href=/getting-started/hsm4/quickstart/ title="HSM4 Quickstart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm4quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm4production-mode-li><input type=checkbox id=m-getting-startedhsm4production-mode-check>
<label for=m-getting-startedhsm4production-mode-check><a href=/getting-started/hsm4/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm4production-mode><span class=td-sidebar-link__page>Enabling Production Mode - HSM4</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedhsm6-li><input type=checkbox id=m-getting-startedhsm6-check>
<label for=m-getting-startedhsm6-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedhsm6><span class=td-sidebar-link__section>HSM6</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm6quickstart-li><input type=checkbox id=m-getting-startedhsm6quickstart-check>
<label for=m-getting-startedhsm6quickstart-check><a href=/getting-started/hsm6/quickstart/ title="HSM6 Quickstart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm6quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm6production-mode-li><input type=checkbox id=m-getting-startedhsm6production-mode-check>
<label for=m-getting-startedhsm6production-mode-check><a href=/getting-started/hsm6/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm6production-mode><span class=td-sidebar-link__page>Enabling Production Mode - HSM6</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscn-li><input type=checkbox id=m-getting-startedscn-check>
<label for=m-getting-startedscn-check><a href=https://www.zymbit.com/secure-compute-node/ title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscn><span class=td-sidebar-link__page>Secure Compute Node</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-api-li><input type=checkbox id=m-api-check checked>
<label for=m-api-check><a href=/api/ title="API Documentation" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-api><span class=td-sidebar-link__section>API</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apiapi_docs_intro-li><input type=checkbox id=m-apiapi_docs_intro-check>
<label for=m-apiapi_docs_intro-check><a href=/api/api_docs_intro/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apiapi_docs_intro><span class=td-sidebar-link__page>Intro to Zymkey Application Utilities</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apic_api-li><input type=checkbox id=m-apic_api-check>
<label for=m-apic_api-check><a href=/api/c_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apic_api><span class=td-sidebar-link__page>C API Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apicpp_api-li><input type=checkbox id=m-apicpp_api-check>
<label for=m-apicpp_api-check><a href=/api/cpp_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apicpp_api><span class=td-sidebar-link__page>C++ API Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apipython_api-li><input type=checkbox id=m-apipython_api-check>
<label for=m-apipython_api-check><a href=/api/python_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apipython_api><span class=td-sidebar-link__page>Python API Documentation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-troubleshooting-li><input type=checkbox id=m-troubleshooting-check checked>
<label for=m-troubleshooting-check><a href=/troubleshooting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-troubleshooting><span class=td-sidebar-link__section>FAQ and Troubleshooting</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinggeneral-li><input type=checkbox id=m-troubleshootinggeneral-check>
<label for=m-troubleshootinggeneral-check><a href=/troubleshooting/general/ title="General FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinggeneral><span class=td-sidebar-link__page>General</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingscm-li><input type=checkbox id=m-troubleshootingscm-check>
<label for=m-troubleshootingscm-check><a href=/troubleshooting/scm/ title="SCM Troubleshooting/FAQ" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingscm><span class=td-sidebar-link__page>SCM</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingzymkey4-li><input type=checkbox id=m-troubleshootingzymkey4-check>
<label for=m-troubleshootingzymkey4-check><a href=/troubleshooting/zymkey4/ title="ZYMKEY4 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinghsm4-li><input type=checkbox id=m-troubleshootinghsm4-check>
<label for=m-troubleshootinghsm4-check><a href=/troubleshooting/hsm4/ title="HSM4 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinghsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinghsm6-li><input type=checkbox id=m-troubleshootinghsm6-check>
<label for=m-troubleshootinghsm6-check><a href=/troubleshooting/hsm6/ title="HSM6 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinghsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><input type=checkbox id=m-reference-check checked>
<label for=m-reference-check><a href=/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span class=td-sidebar-link__section>Reference</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceproduct-briefs-li><input type=checkbox id=m-referenceproduct-briefs-check>
<label for=m-referenceproduct-briefs-check><a href=/reference/product-briefs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceproduct-briefs><span class=td-sidebar-link__section>Product Briefs</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefszymkey4-li><input type=checkbox id=m-referenceproduct-briefszymkey4-check>
<label for=m-referenceproduct-briefszymkey4-check><a href=https://www.zymbit.com/datasheets/zymkey-4i title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefszymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefshsm4-li><input type=checkbox id=m-referenceproduct-briefshsm4-check>
<label for=m-referenceproduct-briefshsm4-check><a href=https://www.zymbit.com/datasheets/hsm4 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefshsm6-li><input type=checkbox id=m-referenceproduct-briefshsm6-check>
<label for=m-referenceproduct-briefshsm6-check><a href=https://www.zymbit.com/datasheets/hsm6 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefsmfg-app-li><input type=checkbox id=m-referenceproduct-briefsmfg-app-check>
<label for=m-referenceproduct-briefsmfg-app-check><a href=https://www.zymbit.com/datasheets/manufacturing-appliance-1 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefsmfg-app><span class=td-sidebar-link__page>Manufacturing Appliance</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencedatasheets-li><input type=checkbox id=m-referencedatasheets-check>
<label for=m-referencedatasheets-check><a href=/reference/datasheets/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referencedatasheets><span class=td-sidebar-link__section>Datasheets</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedatasheetshsm4-li><input type=checkbox id=m-referencedatasheetshsm4-check>
<label for=m-referencedatasheetshsm4-check><a href=/reference/datasheets/hsm4/ title="HSM4 Datasheets" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencedatasheetshsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecad-li><input type=checkbox id=m-referencecad-check>
<label for=m-referencecad-check><a href=/reference/cad/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referencecad><span class=td-sidebar-link__section>CAD Files</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadzymkey4-li><input type=checkbox id=m-referencecadzymkey4-check>
<label for=m-referencecadzymkey4-check><a href=/reference/cad/zymkey4/ title="Zymkey4 CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadhsm4-li><input type=checkbox id=m-referencecadhsm4-check>
<label for=m-referencecadhsm4-check><a href=/reference/cad/hsm4/ title="HSM4 CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadhsm6-li><input type=checkbox id=m-referencecadhsm6-check>
<label for=m-referencecadhsm6-check><a href=/reference/cad/hsm6/ title="HSM6 CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceconformity-li><input type=checkbox id=m-referenceconformity-check>
<label for=m-referenceconformity-check><a href=/reference/conformity/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceconformity><span class=td-sidebar-link__section>Conformity Documents</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityzymkey4-li><input type=checkbox id=m-referenceconformityzymkey4-check>
<label for=m-referenceconformityzymkey4-check><a href=/reference/conformity/zymkey4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityzymkey4><span class=td-sidebar-link__page>Zymkey4 Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityhsm4-li><input type=checkbox id=m-referenceconformityhsm4-check>
<label for=m-referenceconformityhsm4-check><a href=/reference/conformity/hsm4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm4><span class=td-sidebar-link__page>HSM4 Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityhsm6-li><input type=checkbox id=m-referenceconformityhsm6-check>
<label for=m-referenceconformityhsm6-check><a href=/reference/conformity/hsm6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm6><span class=td-sidebar-link__page>HSM6 Conformity Documents</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepower-quality-li><input type=checkbox id=m-referencepower-quality-check>
<label for=m-referencepower-quality-check><a href=/reference/power-quality/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencepower-quality><span class=td-sidebar-link__page>Power Quality Considerations</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencebinding-li><input type=checkbox id=m-referencebinding-check>
<label for=m-referencebinding-check><a href=/reference/binding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencebinding><span class=td-sidebar-link__page>Binding, Device ID, and Authentication</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereserved-pins-li><input type=checkbox id=m-referencereserved-pins-check>
<label for=m-referencereserved-pins-check><a href=/reference/reserved-pins/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencereserved-pins><span class=td-sidebar-link__page>SCM Reserved Pins</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpu-scaling-li><input type=checkbox id=m-referencecpu-scaling-check>
<label for=m-referencecpu-scaling-check><a href=/reference/cpu-scaling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpu-scaling><span class=td-sidebar-link__page>CPU Scaling Governor</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereal-time-clock-li><input type=checkbox id=m-referencereal-time-clock-check>
<label for=m-referencereal-time-clock-check><a href=/reference/real-time-clock/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencereal-time-clock><span class=td-sidebar-link__page>Real Time Clock Operation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><input type=checkbox id=m-tutorials-check checked>
<label for=m-tutorials-check><a href=/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorials><span class=td-sidebar-link__section>Tutorials</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssupervised-boot-li><input type=checkbox id=m-tutorialssupervised-boot-check>
<label for=m-tutorialssupervised-boot-check><a href=/tutorials/supervised-boot/ title="Working with SCM Supervised Boot" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssupervised-boot><span class=td-sidebar-link__page>Supervised Boot (SCM)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsalternative-gpio-li><input type=checkbox id=m-tutorialsalternative-gpio-check>
<label for=m-tutorialsalternative-gpio-check><a href=/tutorials/alternative-gpio/ title="Using an Alternative GPIO Pin" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsalternative-gpio><span class=td-sidebar-link__page>Alternative GPIO Pin</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsdigital-wallet-li><input type=checkbox id=m-tutorialsdigital-wallet-check>
<label for=m-tutorialsdigital-wallet-check><a href=/tutorials/digital-wallet/ title="Zymbit Embedded Hardware Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdigital-wallet><span class=td-sidebar-link__section>Embedded Hardware Wallet</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletwallet-example-li><input type=checkbox id=m-tutorialsdigital-walletwallet-example-check>
<label for=m-tutorialsdigital-walletwallet-example-check><a href=/tutorials/digital-wallet/wallet-example/ title="Working with the Zymbit Hardware Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletwallet-example><span class=td-sidebar-link__page>Zymbit Hardware Wallet</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletethereum-signing-example-li><input type=checkbox id=m-tutorialsdigital-walletethereum-signing-example-check>
<label for=m-tutorialsdigital-walletethereum-signing-example-check><a href=/tutorials/digital-wallet/ethereum-signing-example/ title="Sending a Web3 Ethereum Transaction" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletethereum-signing-example><span class=td-sidebar-link__page>Ethereum Transaction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletslip39-example-li><input type=checkbox id=m-tutorialsdigital-walletslip39-example-check>
<label for=m-tutorialsdigital-walletslip39-example-check><a href=/tutorials/digital-wallet/slip39-example/ title="SLIP39 and Shamir's Wallet Recovery Example" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletslip39-example><span class=td-sidebar-link__page>SLIP39 and Shamir's</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletoversight-example-li><input type=checkbox id=m-tutorialsdigital-walletoversight-example-check>
<label for=m-tutorialsdigital-walletoversight-example-check><a href=/tutorials/digital-wallet/oversight-example/ title="Creating an Oversight (Read Only) Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletoversight-example><span class=td-sidebar-link__page>Oversight Wallet</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsencrypt-rfs-li><input type=checkbox id=m-tutorialsencrypt-rfs-check>
<label for=m-tutorialsencrypt-rfs-check><a href=/tutorials/encrypt-rfs/ title="Encrypting Root File System with Zymbit Security Modules" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfs><span class="td-sidebar-nav-active-item td-sidebar-link__page">Encrypt Root File System</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssensor-data-li><input type=checkbox id=m-tutorialssensor-data-check>
<label for=m-tutorialssensor-data-check><a href=/tutorials/sensor-data/ title="Encrypting & Decrypting Sensor Data on Disk" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssensor-data><span class=td-sidebar-link__page>Encrypt Sensor Data</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsaws-iot-li><input type=checkbox id=m-tutorialsaws-iot-check>
<label for=m-tutorialsaws-iot-check><a href=/tutorials/aws-iot/ title="AWS IoT Integrations & Client Certificates" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsaws-iot><span class=td-sidebar-link__section>Integrate Zymbit with AWS</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotverify-sigs-li><input type=checkbox id=m-tutorialsaws-iotverify-sigs-check>
<label for=m-tutorialsaws-iotverify-sigs-check><a href=/tutorials/aws-iot/verify-sigs/ title="How to Verify Signatures against Public Key on AWS and Other Devices" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotverify-sigs><span class=td-sidebar-link__page>Verify Signatures</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iottls-li><input type=checkbox id=m-tutorialsaws-iottls-check>
<label for=m-tutorialsaws-iottls-check><a href=/tutorials/aws-iot/tls/ title="AWS IoT - TLS Client Certificate Authentication" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iottls><span class=td-sidebar-link__page>Transport Level Security</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotintegrate-li><input type=checkbox id=m-tutorialsaws-iotintegrate-check>
<label for=m-tutorialsaws-iotintegrate-check><a href=/tutorials/aws-iot/integrate/ title="How to Integrate Zymbit with AWS Credentials Provider" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotintegrate><span class=td-sidebar-link__page>Integrate with AWS Credentials Provider</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotjitr-li><input type=checkbox id=m-tutorialsaws-iotjitr-check>
<label for=m-tutorialsaws-iotjitr-check><a href=/tutorials/aws-iot/jitr/ title="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotjitr><span class=td-sidebar-link__page>Just In Time Registration</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsperimeter-detect-li><input type=checkbox id=m-tutorialsperimeter-detect-check>
<label for=m-tutorialsperimeter-detect-check><a href=/tutorials/perimeter-detect/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsperimeter-detect><span class=td-sidebar-link__section>Perimeter Detect</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectzymkey4-li><input type=checkbox id=m-tutorialsperimeter-detectzymkey4-check>
<label for=m-tutorialsperimeter-detectzymkey4-check><a href=/tutorials/perimeter-detect/zymkey4/ title="Perimeter Detect: ZYMKEY4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detecthsm4-li><input type=checkbox id=m-tutorialsperimeter-detecthsm4-check>
<label for=m-tutorialsperimeter-detecthsm4-check><a href=/tutorials/perimeter-detect/hsm4/ title="Perimeter Detect: HSM4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detecthsm6-li><input type=checkbox id=m-tutorialsperimeter-detecthsm6-check>
<label for=m-tutorialsperimeter-detecthsm6-check><a href=/tutorials/perimeter-detect/hsm6/ title="Perimeter Detect: HSM6" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectscm-li><input type=checkbox id=m-tutorialsperimeter-detectscm-check>
<label for=m-tutorialsperimeter-detectscm-check><a href=/tutorials/perimeter-detect/scm/ title="Perimeter Detect: SCM" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectscm><span class=td-sidebar-link__page>SCM</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectexamples-li><input type=checkbox id=m-tutorialsperimeter-detectexamples-check>
<label for=m-tutorialsperimeter-detectexamples-check><a href=/tutorials/perimeter-detect/examples/ title="Perimeter Detect Circuit Examples" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectexamples><span class=td-sidebar-link__page>CIRCUIT EXAMPLES</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsprotokit-li><input type=checkbox id=m-tutorialsprotokit-check>
<label for=m-tutorialsprotokit-check><a href=/tutorials/protokit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsprotokit><span class=td-sidebar-link__page>ProtoKit5</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#prerequisites>Prerequisites</a></li></ul></li></ul></li><li><a href=#background><strong>BACKGROUND</strong></a><ul><li><a href=#why-encrypt>WHY ENCRYPT?</a></li><li><a href=#introducing-luks>INTRODUCING LUKS</a><ul><li><a href=#weaknesses-of-single-master-key>Weaknesses of single Master key</a></li><li><a href=#hierarchical-key-management>Hierarchical key management</a></li></ul></li><li><a href=#secure-storage-of-luks-user-keys>SECURE STORAGE OF LUKS USER KEYS</a><ul><li><a href=#the-sd-card-is-not-a-secure-storage-location>The SD Card is NOT a secure storage location</a></li></ul></li><li><a href=#securing-luks-user-key-with-zymbit-security-module>Securing LUKS User Key with Zymbit Security Module.</a></li><li><a href=#where-to-store-your-luks-encrypted-rfs>WHERE TO STORE YOUR LUKS ENCRYPTED RFS</a><ul><li><a href=#option-1---convert-existing-sd-card-to-luks>Option 1 - Convert existing SD Card to LUKS</a></li><li><a href=#option-2---migrate-existing-sd-card-to-external-luks-storage-device>Option 2 - Migrate existing SD card to external LUKS storage device.</a></li></ul></li></ul></li><li><a href=#how-to-encrypt><strong>HOW TO ENCRYPT</strong></a><ul><li><a href=#building-your-luks-encrypted-rfs>BUILDING YOUR LUKS ENCRYPTED RFS</a><ul><li><a href=#prerequisites-1>Prerequisites</a></li><li><a href=#option-1---convert-existing-sd-card-to-luks-1>Option 1 - Convert existing SD Card to LUKS</a></li><li><a href=#option-2---migrate-existing-sd-card-to-external-luks-storage-device-1>Option 2 - Migrate existing SD card to external LUKS storage device.</a></li></ul></li><li><a href=#integrating-luks-into-volume-manufacturing-workflow>INTEGRATING LUKS INTO VOLUME MANUFACTURING WORKFLOW</a></li><li><a href=#references>REFERENCES</a></li></ul></li><li><a href=#troubleshooting>Troubleshooting</a></li></ul></nav></div></aside><main class="col-12 col-md-8 col-xl-7 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/>Tutorials</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.zymbit.com/tutorials/encrypt-rfs/>Encrypt Root File System</a></li></ol></nav><div class=td-content><h1>Encrypting Root File System with Zymbit Security Modules</h1><header class=article-meta></header><p><img src=erfs1.png alt=image1></p><h4 id=prerequisites>Prerequisites</h4><p>Raspberry Pi:</p><ul><li>Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit)</li></ul><p>Nvidia Jetson:</p><ul><li>Jetson Xavier NX or Nano</li><li>Jetpack 4.4 or earlier</li></ul><h2 id=background><strong>BACKGROUND</strong></h2><p>To skip the background information and start encrypting your RFS, click <a href=#how-to-encrypt>here</a>.</p><h3 id=why-encrypt>WHY ENCRYPT?</h3><p>There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned.</p><p>For many Raspberry Pi configurations, only two partitions exist:</p><ul><li>/boot <nbsp>on /dev/mmcblk0p1</li><li>/ on /dev/mmcblk0p2</li></ul><p>For Jetson configurations, many small partitions are created but the / file system including the /boot area is located here:</p><ul><li>/dev/mmcblk0p1</li></ul><p>So it makes sense to encrypt the root partition as a way of encrypting everything.</p><hr><h3 id=introducing-luks>INTRODUCING LUKS</h3><p>LUKS (<strong>L</strong>inux <strong>U</strong>nified <strong>K</strong>ey <strong>S</strong>etup) is the popular key management setup for dm-crypt, the de-facto standard for block device encryption with Linux.</p><p>LUKS provides a robust and flexible mechanism for multiple users (and services) to interface to and access Linux&rsquo;s &lsquo;<a href=https://wiki.archlinux.org/index.php/dm-crypt>dm-crypt</a>&rsquo; infrastructure.</p><p><em>dm-crypt</em> is a transparent disk encryption subsystem in Linux kernel versions 2.6 and later and is part of the device mapper infrastructure, and uses cryptographic routines from the kernel&rsquo;s Crypto API. Both are widely used and understood in the IT community.</p><h4 id=weaknesses-of-single-master-key>Weaknesses of single Master key</h4><p>dm-crypt has a single Master Key that is used to encrypt / decrypt data in/out of the block. To ensure long term security and deal with changing authorized users/services, it would be necessary to change the Master Key frequently, and potentially share it with multiple users/services on a regular basis. Every new iteration of Master Key would require the underlying data block to be re-encrypted everytime. In real systems, touched by different users/services, this is impractical.</p><h4 id=hierarchical-key-management>Hierarchical key management</h4><p>A more practical solution is to have a hierarchical key management setup in which users/services are given User Keys that are used to release the MasterKey. User Keys can be easily changed and revoked, without having to re-encrypt the underlying data block.
The management of such a hirearchical key managers is the role of LUKS.</p><p>In this post we show how to use Zymbit Security Module to lock a User Key, that is subsequently used to unlock the Master Key and provide access to the Root File System. If you&rsquo;d like to learn more about LUKS see the References at the bottom of this post.</p><p><img src=erfs2.png alt=image2></p><hr><h3 id=secure-storage-of-luks-user-keys>SECURE STORAGE OF LUKS USER KEYS</h3><p>The security efficacy of your LUKS encrypted RFS is highly dependent upon how the User Keys are generated and where they are stored.</p><h4 id=the-sd-card-is-not-a-secure-storage-location>The SD Card is NOT a secure storage location</h4><p>The growing single board computer family is awesome, and we love it! It is inexpensive, has an incredible amount of computing power for an embedded device and has a very robust software development ecosystem.</p><p>However, these devices have an Achilles heel: the SD card is the primary software deployment media, and it can be very easily removed and manipulated.</p><p>The natural inclination would be to encrypt the file system using LUKS on dm-crypt, but for unattended use across many deployed units the obvious question is: where is the LUKS key stored? Of course, it&rsquo;s the file system. Even if you try to obfuscate it through various programmatic means, the key is still very vulnerable to attack.</p><h3 id=securing-luks-user-key-with-zymbit-security-module>Securing LUKS User Key with Zymbit Security Module.</h3><p><img src=erfs1.png alt=image1></p><p>The Zymbit Security Module provides a general &ldquo;locking&rdquo; service whereby a block of plaintext data is encrypted and signed.</p><p>When used with LUKS, the User Key is sent to the Zymbit Security Module to be locked (encrypted and signed) when the file system is created. When the system boots and needs to decrypt the root file system, the locked LUKS key is &ldquo;unlocked&rdquo; (signature verified and contents decrypted) and presented to dm-crypt. If the key was unlocked successfully, the boot process continues normally. Here is the boot sequence with a LUKS/dm-crypt filesystem where the key is protected by Zymbit Security Module:</p><ol><li>The kernel initializes initramfs</li><li>initramfs presents the locked LUKS key to Zymbit Security Module</li><li>Zymbit Security Module validates the signature and decrypts the key*</li><li>The decrypted key is presented to LUKS and the root file system is then decrypted</li></ol><p>*requires that Zymbit Security Module operational status is &ldquo;secure&rdquo;</p><hr><p><em>ZYMKEY4 fitted to Raspberry Pi and Jetson</em></p><p><img src=erfs3.png alt=rpi width=50%><img src=jetson3.png alt=jetson width=50%></p><p><strong>Zymbit Security Module Authenticates Host System Before Unlocking LUKS Key</strong></p><p>One of the key features of Zymbit Security Module is to generate a unique Identity (ID) for the host system, based upon a fingerprint that measures specific system components. This fingerprinting process is used to &ldquo;bind&rdquo; together a specific Zymbit Security Module (root of trust, key store, crypto services), a specific host computer and a specific SD card. Once bound, these components form a permanent and immutable ID of the host system.</p><p>Each time the host device boots, and at random intervals thereafter, the Zymbit Security Module rechecks the ID fingerprint. If any of the system components have changed the fingerprint changes and the system is deemed to have been compromised, authentication fails and all security services are shut down.</p><p>Using this ID / Authentication feature, the Zymbit Security Module can be used to protect LUKS User Keys in unattended applications, where it might be easy to remove and copy SD card content. (The Zymbit Security Module also has other physical security features which are also used to lock/enable security services)</p><p><img src=erfs4.png alt=image4></p><hr><h3 id=where-to-store-your-luks-encrypted-rfs>WHERE TO STORE YOUR LUKS ENCRYPTED RFS</h3><p>LUKS is very versatile and can be applied to both SD Card and external storage media. Lets review the pros and cons of each option:</p><div class="callout callout-warning"><div class=callout-heading><i class="callout-icon fas fa-exclamation-triangle"></i>
<span class=callout-title>Warning</span></div><div class=callout-body><p>When encrypting your rootfs, we highly recommend turning off unattended-upgrades prior to the encryption process. In some cases primarily with Ubuntu 20.04, during an update/upgrade after encryption, the update-initramfs process may fail and leave the system unable to boot.</p><p>To mitigate this issue, remove the service unattended-upgrades:</p><p><code>systemctl stop unattended-upgrades</code></p><p><code>systemctl disable unattended-upgrade</code></p></div></div><h4 id=option-1---convert-existing-sd-card-to-luks>Option 1 - Convert existing SD Card to LUKS</h4><p>Converting the existing root file system on the SD card still requires an external device (e.g. USB flash drive) that is used as a temporary boot root file system: this provide an easier and lower risk means to convert and copy the original contents. The external devices needs to be a little larger than the existing root file system in order to store the old file system.</p><p><strong>Pros:</strong></p><ol><li>Less physical space requirements.</li><li>Much less power required.</li></ol><p><strong>Cons:</strong></p><ol><li>Conversion is more complex and time consuming than migrating to an external drive.</li><li>Data space constraints.</li><li>Write cycle constraints.</li><li>Access speed constraints.</li></ol><p><strong>Process Steps:</strong></p><ol><li>Make a tarball of the original root file system and store it on the external device</li><li>Copy the original root file system files to the external device to form a temporary file system</li><li>Boot to the temporary file system. Once booted, the temporary file system will:</li></ol><ul><li>Create a LUKS key</li><li>Lock the LUKS key with Zymbit Security Module</li><li>Create a LUKS volume on the original root partition. The standard Jetson installation creates up to 14 partitions. In most cases, the new partition will be mmcblk0p13 or mmcblk0p15.</li><li>Create an ext4 partition on the LUKS volume on the original root partition</li><li>Untar the root file system tarball into the converted partition</li><li>For Jetson users: Untar the /boot area into the original SD card partition, mmcblk0p1</li></ul><h4 id=option-2---migrate-existing-sd-card-to-external-luks-storage-device>Option 2 - Migrate existing SD card to external LUKS storage device.</h4><p>The existing root file system can be migrated to an external LUKS encrypted USB flash, hard drive or SSD.</p><p><strong>Pros:</strong></p><ol><li>External devices can hold much more data.</li><li>Migration is easier and quicker than SD card conversion method.</li><li>Some external devices have much faster data access than SD cards.</li><li>Some external devices (e.g. HDD) can tolerate many more write cycles than an SD card.</li></ol><p><strong>Cons:</strong></p><ol><li>For HDD and SSD and non-compact USB flash devices, there are additional power requirements.</li><li>Except for compact USB flash devices, physical space requirements also increase. This may be especially important for the Raspberry Pi Zero family.</li></ol><p><strong>Process Steps:</strong></p><ol><li>Create the LUKS key</li><li>Lock the LUKS key</li><li>Create a LUKS volume on an external USB device</li><li>Create an ext4 partition on the LUKS volume</li><li>Move the existing root file system to the LUKS volume on the external device</li><li>For RPi users: Boot to the new root file system and erase the previous root volume</li></ol><ul><li>For Jetson users: Copy the /boot area into the original SD card partition mmcblk0p1</li></ul><ol start=7><li>Boot to the new root file system</li></ol><hr><h2 id=how-to-encrypt><strong>HOW TO ENCRYPT</strong></h2><h3 id=building-your-luks-encrypted-rfs>BUILDING YOUR LUKS ENCRYPTED RFS</h3><h4 id=prerequisites-1>Prerequisites</h4><p>Make sure you have the Zymbit Security Module software suite already running and operational as well as bound. Instructions <a href=https://docs.zymbit.com/getting-started>here</a>.</p><h5 id=note-for-rpi-users-for-the-cm4io-module-with-emmc-additional-steps-are-needed-due-to-the-fact-that-the-usb-20-ports-are-disabled-by-default>NOTE for RPi users: For the CM4/IO Module with eMMC, additional steps are needed due to the fact that the USB 2.0 ports are disabled by default:</h5><ol><li>Upgrade the bootloader version: Jan. 16 2021</li><li>Set the boot order to allow booting off USB: 0xf15</li><li>Modify /boot/config.txt and add the line &ldquo;otg_mode=1&rdquo; under [all]. This replaces the line, &ldquo;dtoverlay=dwc2,dr_mode=host&rdquo; if added.</li></ol><h4 id=option-1---convert-existing-sd-card-to-luks-1>Option 1 - Convert existing SD Card to LUKS</h4><p>To convert your root file system to LUKS/dm-crypt, you will need to connect an external USB disk (as temporary storage). As mentioned previously, this is necessary because it is not possible to encrypt the partition in place, so the external disk is needed as temporary storage and a temporary root file system while the conversion takes place. The external disk needs to be at least twice as big as the root partition. Next, run the following script:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_sd_rfs.sh | sudo bash</code></p><p>For RPi users: This script is parameterized, so if you have special requirements (e.g. root file system lives on /dev/mmcblk0p4), you can invoke it in the following fashion:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_sd_rfs.sh | sudo bash -s -- -x &lt;path to external storage device (e.g. /dev/sdX> -m &lt;source partition number></code></p><p>In the above invocation with no parameters, the defaults are:</p><ol><li>Original root file system located on /dev/mmcblk0p2</li><li>Temporary root file system/storage for original root tarball located on /dev/sda</li><li>Temporary root file system takes up entirety of new device</li></ol><p><strong>The very first run of this script on a new temporary external USB disk could take a long time. Also, two reboots are required before the script is complete.</strong></p><p>One thing to note is that, if the external storage device has an ext4 formatted partition with the original root file system partition (e.g. /dev/mmcblk0p2) on it, this script will use what is already on the external storage device to convert the SD card. This cuts down time for converting lots of device root file systems and allows the script to be used in a mass production deployment.</p><p>On a Pi3 with an attached USB SSD as the external device on a bare Jessie &ldquo;full&rdquo; version (~4GB), the first run of this script requires about an hour to complete the first phase. The second phase takes around 15 minutes.</p><p>The same platform with a Jessie &ldquo;lite&rdquo; version (~1.6GB) takes around 20 minutes for phase 1 and 5 minutes for phase 2.</p><p>For Jetson, the first run of this script can take upwards of 30 minutes to an hour to complete the first phase. The second phase takes around 15 minutes.</p><p>Based on the above, using the formatted external device to convert subsequent units should only take 15 minutes.</p><h4 id=option-2---migrate-existing-sd-card-to-external-luks-storage-device-1>Option 2 - Migrate existing SD card to external LUKS storage device.</h4><p>To migrate your root file system to an external USB device, you can run the following script:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_ext_rfs.sh | sudo bash</code></p><p>This script is parameterized, so if you have special requirements, you can invoke in the following fashion:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_ext_rfs.sh | sudo bash -s -- -x &lt;path to external storage device (e.g. /dev/sdX> -p &lt;destination partition number -s &lt;max size of new root partition> -m &lt;source partition number></code></p><p>In the above invocation with no parameters, the defaults for RPi are:</p><ol><li>Original root file system located on /dev/mmcblk0p2</li><li>New root file system located on /dev/sda1</li><li>New root file system takes up entirety of new device
The defaults for Jetson are:</li><li>Original root file system located on /dev/mmcblk0p1</li><li>Temporary root file system/storage for original root tarball located on /dev/sda</li><li>Temporary root file system takes up entirety of new device</li></ol><p>Please note that the new root file system should be at least a little larger in size than the original root partition</p><p>Running this script takes around 30-40 minutes. The Zymbit Security Module&rsquo;s LED flashes rapidly until the process has completed.</p><hr><h3 id=integrating-luks-into-volume-manufacturing-workflow>INTEGRATING LUKS INTO VOLUME MANUFACTURING WORKFLOW</h3><p>The examples above are designed to help you get up and running with single and low volume applications.</p><p>If you require support in developing a high volume manufacturing encryption workflow then please <a href=https://www.zymbit.com/contact-us/>contact us</a> to discuss our OEM engineering services.</p><hr><h3 id=references>REFERENCES</h3><ul><li><p><a href=https://wiki.archlinux.org/index.php/disk_encryption#Comparison_table>LUKS features - the de-facto standard in Linux Kernel.</a></p></li><li><p><a href=https://en.wikipedia.org/wiki/Dm-crypt>Wiki overview to dm-crypt</a></p></li><li><p><a href=https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption#Adding_LUKS_keys>ArchLinux - adding LUKS keys to dm-crypt device encryption</a></p></li><li><p><a href=https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions>GitLab - LUKS and Cryptsetup - FAQ</a></p></li><li><p><a href=https://gitlab.com/cryptsetup/cryptsetup>GitLab - LUKS and Cryptsetup - open-source disk encryption</a></p></li></ul><h2 id=troubleshooting>Troubleshooting</h2><p><a href=https://docs.zymbit.com/troubleshooting/>Troubleshooting</a><br><a href=https://community.zymbit.com/>Community</a></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3c76e570b8edcc8e0588f2a12ba768dcc4855763404089be6365637d90bdb8ef.js integrity="sha256-PHblcLjtzI4FiPKhK6do3MSFV2NAQIm+Y2VjfZC9uO8=" crossorigin=anonymous></script></body></html>