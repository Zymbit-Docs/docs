<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.79.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Encrypting Root File System with HSM6 |</title><meta name=description content><meta property="og:title" content="Encrypting Root File System with HSM6"><meta property="og:description" content="Prerequisites Raspberry Pi:
 Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit)  Nvidia Jetson:
 Jetson Xavier NX or Nano Jetpack 4.4 or earlier  BACKGROUND To skip the background information and start encrypting your RFS, click here.
WHY ENCRYPT? There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.zymbit.com/tutorials/encrypt-rfs/hsm6/"><meta property="og:image" content="https://docs.zymbit.com/doks.png"><meta property="article:modified_time" content="2021-08-17T10:02:18-07:00"><meta property="og:site_name" content="Zymbit Documentation"><meta itemprop=name content="Encrypting Root File System with HSM6"><meta itemprop=description content="Prerequisites Raspberry Pi:
 Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit)  Nvidia Jetson:
 Jetson Xavier NX or Nano Jetpack 4.4 or earlier  BACKGROUND To skip the background information and start encrypting your RFS, click here.
WHY ENCRYPT? There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned."><meta itemprop=dateModified content="2021-08-17T10:02:18-07:00"><meta itemprop=wordCount content="2078"><meta itemprop=image content="https://docs.zymbit.com/doks.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://docs.zymbit.com/doks.png"><meta name=twitter:title content="Encrypting Root File System with HSM6"><meta name=twitter:description content="Prerequisites Raspberry Pi:
 Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit)  Nvidia Jetson:
 Jetson Xavier NX or Nano Jetpack 4.4 or earlier  BACKGROUND To skip the background information and start encrypting your RFS, click here.
WHY ENCRYPT? There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned."><link rel=preload href=/scss/main.min.ce0d576b050c303c3365576158e2ded601d798b4493d903e7d9d7c9748c0a182.css as=style><link href=/scss/main.min.ce0d576b050c303c3365576158e2ded601d798b4493d903e7d9d7c9748c0a182.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><img class=navbar-logo src=https://docs.zymbit.com/Zymbit-Logo.gif></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/><span>Docs</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-4 col-xl-3 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Welcome to Zymbit Documentation</span></a><ul class="pr-md-3 ul-1"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstart-li><span class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section"><span>QUICKSTART</span></span><ul class="pr-md-3 ul-2"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstartgetting-started-li><a href=/quickstart/getting-started/ title="Getting Started with Zymbit Products" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-quickstartgetting-started><i class="fas fa-caret-right"></i><span>Getting Started</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartgetting-startedzymkey4-li><a href=/quickstart/getting-started/zymkey4/ title="Getting Started with Zymkey4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartgetting-startedzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartgetting-startedhsm4-li><a href=/quickstart/getting-started/hsm4/ title="Getting Started with HSM4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartgetting-startedhsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartgetting-startedhsm6-li><a href=/quickstart/getting-started/hsm6/ title="Getting Started with HSM6" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartgetting-startedhsm6><span>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstartapi-li><a href=/quickstart/api/ title="API Documentation" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-quickstartapi><i class="fas fa-caret-right"></i><span>API</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartapic_api-li><a href=/quickstart/api/c_api/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartapic_api><span>C API Documentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartapicpp_api-li><a href=/quickstart/api/cpp_api/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartapicpp_api><span>C++ API Documentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartapipython_api-li><a href=/quickstart/api/python_api/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartapipython_api><span>Python API Documentation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-quickstartfaq-li><a href=/quickstart/faq/ title="FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-quickstartfaq><i class="fas fa-caret-right"></i><span>FAQ</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqzymkey4-li><a href=/quickstart/faq/zymkey4/ title="Zymkey4 FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqhsm4-li><a href=/quickstart/faq/hsm4/ title="HSM4 FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqhsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqhsm6-li><a href=/quickstart/faq/hsm6/ title="HSM6 FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqhsm6><span>HSM6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-quickstartfaqgeneral-li><a href=/quickstart/faq/general/ title="FAQ & Troubleshooting" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-quickstartfaqgeneral><span>GENERAL</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><span class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section"><span>REFERENCE</span></span><ul class="pr-md-3 ul-2"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecad-li><a href=/reference/cad/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referencecad><i class="fas fa-genderless"></i><span>CAD</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceconformity-li><a href=/reference/conformity/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referenceconformity><i class="fas fa-caret-right"></i><span>Conformity Documents</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityeu-li><a href=https://www.zymbit.com/wp-content/uploads/2019/12/Zymbit_EU-Declaration-of-Conformity_ZYMKEY4i_2018.08.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityeu><span>EU</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityfcc-li><a href=https://www.zymbit.com/wp-content/uploads/2019/12/Zymbit_FCC-Declaration-of-Conformity_ZYMKEY4i_2018.08.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityfcc><span>FCC</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityrohs-reach-li><a href=https://www.zymbit.com/wp-content/uploads/2019/10/Zymbit-RoHS-REACH-Compliance-Notice-2018.10.27.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityrohs-reach><span>RoHS/Reach</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceconformityprop65-li><a href=https://www.zymbit.com/wp-content/uploads/2020/05/Zymbit-CA-Prop65-Compliance-Notice-2020.01.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityprop65><span>CA Prop 65</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceknown-issues-li><a href=/reference/known-issues/ title="Dev Team: Known Issues" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referenceknown-issues><i class="fas fa-caret-right"></i><span>Known Issues</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceknown-issuescpu-scaling-li><a href=/reference/known-issues/cpu-scaling/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceknown-issuescpu-scaling><span>CPU Scaling Governor</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepower-quality-li><a href=/reference/power-quality/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referencepower-quality><i class="fas fa-genderless"></i><span>Power Quality Considerations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceproduct-briefs-li><a href=/reference/product-briefs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referenceproduct-briefs><i class="fas fa-caret-right"></i><span>Product Briefs</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefszymkey4-li><a href=https://www.zymbit.com/wp-content/uploads/2018/12/Zymbit-Data-Sheet-Zymkey-4i-DATA-SHEET-04100910A2.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefszymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefshsm4-li><a href=https://www.zymbit.com/wp-content/uploads/2021/05/Zymbit-DataSheet_HSM4_24000910_20210513_D1.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefshsm6-li><a href=https://www.zymbit.com/wp-content/uploads/2021/05/Zymbit-DataSheet_HSM6_24000911_20210513_D1.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm6><span>HSM6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-referenceproduct-briefsmfg-app-li><a href=https://www.zymbit.com/wp-content/uploads/2020/05/Zymbit-Data-Sheet_Manufacturing-Appliance_-2020_02_V1.1.pdf target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefsmfg-app><span>Manufacturing Appliance</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereal-time-clock-li><a href=/reference/real-time-clock/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-referencereal-time-clock><i class="fas fa-genderless"></i><span>Real Time Clock Operation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><span class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section"><span>TUTORIALS</span></span><ul class="pr-md-3 ul-2"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsalternative-gpio-li><a href=/tutorials/alternative-gpio/ title="Using an Alternative GPIO Pin" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsalternative-gpio><i class="fas fa-genderless"></i><span>Alternative GPIO Pin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-wallet-li><a href=/tutorials/digital-wallet/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdigital-wallet><i class="fas fa-genderless"></i><span>Digital Wallet</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsencrypt-rfs-li><a href=/tutorials/encrypt-rfs/ title="Encrypting your Root File System with dm-crypt and LUKS" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsencrypt-rfs><i class="fas fa-caret-right"></i><span>Encrypt Root File System</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsencrypt-rfszymkey4-li><a href=/tutorials/encrypt-rfs/zymkey4/ title="Encrypting Root File System with Zymkey4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfszymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsencrypt-rfshsm4-li><a href=/tutorials/encrypt-rfs/hsm4/ title="Encrypting Root File System with HSM4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfshsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-tutorialsencrypt-rfshsm6-li><a href=/tutorials/encrypt-rfs/hsm6/ title="Encrypting Root File System with HSM6" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfshsm6><span class=td-sidebar-nav-active-item>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssensor-data-li><a href=/tutorials/sensor-data/ title="Encrypting & Decrypting Sensor Data on Disk" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialssensor-data><i class="fas fa-genderless"></i><span>Encrypt Sensor Data</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsaws-iot-li><a href=/tutorials/aws-iot/ title="AWS IoT Integrations & Client Certificates" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsaws-iot><i class="fas fa-caret-right"></i><span>Integrate Zymbit with AWS</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsaws-iotintegrate-li><a href=/tutorials/aws-iot/integrate/ title="How to Integrate Zymbit with AWS Credentials Provider" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotintegrate><span>Integrate with AWS Credentials Provider</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsaws-iotjitr-li><a href=/tutorials/aws-iot/jitr/ title="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotjitr><span>Just In Time Registration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsaws-iottls-li><a href=/tutorials/aws-iot/tls/ title="AWS IoT - TLS Client Certificate Authentication" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iottls><span>Transport Level Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsaws-iotverify-sigs-li><a href=/tutorials/aws-iot/verify-sigs/ title="How to Verify Signatures against Public Key on AWS and Other Devices" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotverify-sigs><span>Verify Signatures</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsperimeter-detect-li><a href=/tutorials/perimeter-detect/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsperimeter-detect><i class="fas fa-caret-right"></i><span>Perimeter Detect</span></a><ul class="pr-md-3 ul-3"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detectzymkey4-li><a href=/tutorials/perimeter-detect/zymkey4/ title="Perimeter Detect: ZYMKEY4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectzymkey4><span>ZYMKEY4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detecthsm4-li><a href=/tutorials/perimeter-detect/hsm4/ title="Perimeter Detect: HSM4" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm4><span>HSM4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsperimeter-detecthsm6-li><a href=/tutorials/perimeter-detect/hsm6/ title="Perimeter Detect: HSM6" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm6><span>HSM6</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsprotokit-li><a href=/tutorials/protokit/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-tutorialsprotokit><i class="fas fa-genderless"></i><span>ProtoKit5</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-forum-li><a href=https://community.zymbit.com/ target=_blank rel=noopener class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section" id=m-forum><span>FORUM</span></a></li></ul></li></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#prerequisites>Prerequisites</a></li></ul></li></ul></li><li><a href=#background><strong>BACKGROUND</strong></a><ul><li><a href=#why-encrypt>WHY ENCRYPT?</a></li><li><a href=#introducing-luks>INTRODUCING LUKS</a><ul><li><a href=#weaknesses-of-single-master-key>Weaknesses of single Master key</a></li><li><a href=#hierarchical-key-management>Hierarchical key management</a></li></ul></li><li><a href=#secure-storage-of-luks-user-keys>SECURE STORAGE OF LUKS USER KEYS</a><ul><li><a href=#the-sd-card-is-not-a-secure-storage-location>The SD Card is NOT a secure storage location</a></li></ul></li><li><a href=#securing-luks-user-key-with-hsm6-security-module>Securing LUKS User Key with HSM6 Security Module.</a></li><li><a href=#where-to-store-your-luks-encrypted-rfs>WHERE TO STORE YOUR LUKS ENCRYPTED RFS</a><ul><li><a href=#option-1---convert-existing-sd-card-to-luks>Option 1 - Convert existing SD Card to LUKS</a></li><li><a href=#option-2---migrate-existing-sd-card-to-external-luks-storage-device>Option 2 - Migrate existing SD card to external LUKS storage device.</a></li></ul></li></ul></li><li><a href=#how-to-encrypt><strong>HOW TO ENCRYPT</strong></a><ul><li><a href=#building-your-luks-encrypted-rfs>BUILDING YOUR LUKS ENCRYPTED RFS</a><ul><li><a href=#prerequisites-1>Prerequisites</a></li><li><a href=#note-for-rpi-users-for-the-cm4io-module-with-emmc-additional-steps-are-needed-due-to-the-fact-that-the-usb-20-ports-are-disabled-by-default>NOTE for RPi users: For the CM4/IO Module with eMMC, additional steps are needed due to the fact that the USB 2.0 ports are disabled by default:</a></li><li><a href=#option-1---convert-existing-sd-card-to-luks-1>Option 1 - Convert existing SD Card to LUKS</a></li><li><a href=#option-2---migrate-existing-sd-card-to-external-luks-storage-device-1>Option 2 - Migrate existing SD card to external LUKS storage device.</a></li></ul></li><li><a href=#integrating-luks-into-volume-manufacturing-workflow>INTEGRATING LUKS INTO VOLUME MANUFACTURING WORKFLOW</a></li><li><a href=#references>REFERENCES</a></li></ul></li></ul></nav></div><main class="col-12 col-md-8 col-xl-7 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/>TUTORIALS</a></li><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/encrypt-rfs/>Encrypt Root File System</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.zymbit.com/tutorials/encrypt-rfs/hsm6/>HSM6</a></li></ol></nav><div class=td-content><h1>Encrypting Root File System with HSM6</h1><p><img src=../erfs-hsm-1.jpeg alt=image1></p><h4 id=prerequisites>Prerequisites</h4><p>Raspberry Pi:</p><ul><li>Raspbian: Buster (32 or 64 bit); or Ubuntu 18 or 20 (32 or 64 bit)</li></ul><p>Nvidia Jetson:</p><ul><li>Jetson Xavier NX or Nano</li><li>Jetpack 4.4 or earlier</li></ul><h2 id=background><strong>BACKGROUND</strong></h2><p>To skip the background information and start encrypting your RFS, click <a href=https://docs.zymbit.com/tutorials/encrypt-rfs/zymkey4/#how-to-encrypt>here</a>.</p><h3 id=why-encrypt>WHY ENCRYPT?</h3><p>There are many reasons to encrypt the Root File System (RFS), from keeping WiFi credentials immutable to keeping proprietary software and sensitive data from being cloned.</p><p>For many Raspberry Pi configurations, only two partitions exist:</p><ul><li>/boot <nbsp>on /dev/mmcblk0p1</li><li>/ on /dev/mmcblk0p2</li></ul><p>For Jetson configurations, many small partitions are created but the / file system including the /boot area is located here:</p><ul><li>/dev/mmcblk0p1</li></ul><p>So it makes sense to encrypt the root partition as a way of encrypting everything.</p><hr><h3 id=introducing-luks>INTRODUCING LUKS</h3><p>LUKS (<strong>L</strong>inux <strong>U</strong>nified <strong>K</strong>ey <strong>S</strong>etup) is the popular key management setup for dm-crypt, the de-facto standard for block device encryption with Linux.</p><p>LUKS provides a robust and flexible mechanism for multiple users (and services) to interface to and access Linux&rsquo;s &lsquo;<a href=https://wiki.archlinux.org/index.php/dm-crypt>dm-crypt</a>&rsquo; infrastructure.</p><p><em>dm-crypt</em> is a transparent disk encryption subsystem in Linux kernel versions 2.6 and later and is part of the device mapper infrastructure, and uses cryptographic routines from the kernel&rsquo;s Crypto API. Both are widely used and understood in the IT community.</p><h4 id=weaknesses-of-single-master-key>Weaknesses of single Master key</h4><p>dm-crypt has a single Master Key that is used to encrypt / decrypt data in/out of the block. To ensure long term security and deal with changing authorized users/services, it would be necessary to change the Master Key frequently, and potentially share it with multiple users/services on a regular basis. Every new iteration of Master Key would require the underlying data block to be re-encrypted everytime. In real systems, touched by different users/services, this is impractical.</p><h4 id=hierarchical-key-management>Hierarchical key management</h4><p>A more practical solution is to have a hierarchical key management setup in which users/services are given User Keys that are used to release the MasterKey. User Keys can be easily changed and revoked, without having to re-encrypt the underlying data block.
The management of such a hirearchical key managers is the role of LUKS.</p><p>In this post we show how to use HSM6 to lock a User Key, that is subsequently used to unlock the Master Key and provide access to the Root File System. If you&rsquo;d like to learn more about LUKS see the References at the bottom of this post.</p><p><img src=../erfs2.png alt=image2></p><hr><h3 id=secure-storage-of-luks-user-keys>SECURE STORAGE OF LUKS USER KEYS</h3><p>The security efficacy of your LUKS encrypted RFS is highly dependent upon how the User Keys are generated and where they are stored.</p><h4 id=the-sd-card-is-not-a-secure-storage-location>The SD Card is NOT a secure storage location</h4><p>The growing single board computer family is awesome, and we love it! It is inexpensive, has an incredible amount of computing power for an embedded device and has a very robust software development ecosystem.</p><p>However, these devices have an Achilles heel: the SD card is the primary software deployment media, and it can be very easily removed and manipulated.</p><p>The natural inclination would be to encrypt the file system using LUKS on dm-crypt, but for unattended use across many deployed units the obvious question is: where is the LUKS key stored? Of course, it&rsquo;s the file system. Even if you try to obfuscate it through various programmatic means, the key is still very vulnerable to attack.</p><h3 id=securing-luks-user-key-with-hsm6-security-module>Securing LUKS User Key with HSM6 Security Module.</h3><p><img src=../erfs-hsm-1.jpeg alt=image1></p><p>HSM6 provides a general &ldquo;locking&rdquo; service whereby a block of plaintext data is encrypted and signed.</p><p>When used with LUKS, the User Key is sent to the HSM6 to be locked (encrypted and signed) when the file system is created. When the system boots and needs to decrypt the root file system, the locked LUKS key is &ldquo;unlocked&rdquo; (signature verified and contents decrypted) and presented to dm-crypt. If the key was unlocked successfully, the boot process continues normally. Here is the boot sequence with a LUKS/dm-crypt filesystem where the key is protected by HSM6:</p><ol><li>The kernel initializes initramfs</li><li>initramfs presents the locked LUKS key to HSM6</li><li>HSM6 validates the signature and decrypts the key*</li><li>The decrypted key is presented to LUKS and the root file system is then decrypted</li></ol><p>*requires that HSM6 operational status is &ldquo;secure&rdquo;</p><hr><p><em>HSM6 fitted to Raspberry Pi and Jetson</em></p><p><img src=../erfs3.png alt=rpi width=50%><img src=../jetson3.png alt=jetson width=50%></p><p><strong>HSM6 Authenticates Host System Before Unlocking LUKS Key</strong></p><p>One of the key features of HSM6 is to generate a unique Identity (ID) for the host system, based upon a fingerprint that measures specific system components. This fingerprinting process is used to &ldquo;bind&rdquo; together a specific HSM6 (root of trust, key store, crypto services), a specific host computer and a specific SD card. Once bound, these components form a permanent and immutable ID of the host system.</p><p>Each time the host device boots, and at random intervals thereafter, the HSM6 rechecks the ID fingerprint. If any of the system components have changed the fingerprint changes and the system is deemed to have been compromised, authentication fails and all security services are shut down.</p><p>Using this ID / Authentication feature, HSM6 can be used to protect LUKS User Keys in unattended applications, where it might be easy to remove and copy SD card content. (HSM6 also has other physical security features which are also used to lock/enable security services)</p><p><img src=../erfs-hsm-3.jpeg alt=image4></p><hr><h3 id=where-to-store-your-luks-encrypted-rfs>WHERE TO STORE YOUR LUKS ENCRYPTED RFS</h3><p>LUKS is very versatile and can be applied to both SD Card and external storage media. Lets review the pros and cons of each option:</p><h4 id=option-1---convert-existing-sd-card-to-luks>Option 1 - Convert existing SD Card to LUKS</h4><p>Converting the existing root file system on the SD card still requires an external device (e.g. USB flash drive) that is used as a temporary boot root file system: this provide an easier and lower risk means to convert and copy the original contents. The external devices needs to be a little larger than the existing root file system in order to store the old file system.</p><p><strong>Pros:</strong></p><ol><li>Less physical space requirements.</li><li>Much less power required.</li></ol><p><strong>Cons:</strong></p><ol><li>Conversion is more complex and time consuming than migrating to an external drive.</li><li>Data space constraints.</li><li>Write cycle constraints.</li><li>Access speed constraints.</li></ol><p><strong>Process Steps:</strong></p><ol><li>Make a tarball of the original root file system and store it on the external device</li><li>Copy the original root file system files to the external device to form a temporary file system</li><li>Boot to the temporary file system. Once booted, the temporary file system will:</li></ol><ul><li>Create a LUKS key</li><li>Lock the LUKS key with HSM6</li><li>Create a LUKS volume on the original root partition. The standard Jetson installation creates up to 14 partitions. In most cases, the new partition will be mmcblk0p13 or mmcblk0p15.</li><li>Create an ext4 partition on the LUKS volume on the original root partition</li><li>Untar the root file system tarball into the converted partition</li><li>For Jetson users: Untar the /boot area into the original SD card partition, mmcblk0p1</li></ul><h4 id=option-2---migrate-existing-sd-card-to-external-luks-storage-device>Option 2 - Migrate existing SD card to external LUKS storage device.</h4><p>The existing root file system can be migrated to an external LUKS encrypted USB flash, hard drive or SSD.</p><p><strong>Pros:</strong></p><ol><li>External devices can hold much more data.</li><li>Migration is easier and quicker than SD card conversion method.</li><li>Some external devices have much faster data access than SD cards.</li><li>Some external devices (e.g. HDD) can tolerate many more write cycles than an SD card.</li></ol><p><strong>Cons:</strong></p><ol><li>For HDD and SSD and non-compact USB flash devices, there are additional power requirements.</li><li>Except for compact USB flash devices, physical space requirements also increase. This may be especially important for the Raspberry Pi Zero family.</li></ol><p><strong>Process Steps:</strong></p><ol><li>Create the LUKS key</li><li>Lock the LUKS key</li><li>Create a LUKS volume on an external USB device</li><li>Create an ext4 partition on the LUKS volume</li><li>Move the existing root file system to the LUKS volume on the external device</li><li>For RPi users: Boot to the new root file system and erase the previous root volume</li></ol><ul><li>For Jetson users: Copy the /boot area into the original SD card partition mmcblk0p1</li></ul><ol start=7><li>Boot to the new root file system</li></ol><hr><h2 id=how-to-encrypt><strong>HOW TO ENCRYPT</strong></h2><h3 id=building-your-luks-encrypted-rfs>BUILDING YOUR LUKS ENCRYPTED RFS</h3><h4 id=prerequisites-1>Prerequisites</h4><p>Make sure you have the HSM6 software suite already running and operational as well as insuring that your HSM6 is bound. Instructions <a href=https://docs.zymbit.com/quickstart/getting-started/HSM6>here</a>.</p><h4 id=note-for-rpi-users-for-the-cm4io-module-with-emmc-additional-steps-are-needed-due-to-the-fact-that-the-usb-20-ports-are-disabled-by-default>NOTE for RPi users: For the CM4/IO Module with eMMC, additional steps are needed due to the fact that the USB 2.0 ports are disabled by default:</h4><ol><li>Upgrade the bootloader version: Jan. 16 2021</li><li>Set the boot order to allow booting off USB: 0xf15</li><li>Modify /boot/config.txt and add the line &ldquo;otg_mode=1&rdquo; under [all]. This replaces the line, &ldquo;dtoverlay=dwc2,dr_mode=host&rdquo; if added.</li></ol><h4 id=option-1---convert-existing-sd-card-to-luks-1>Option 1 - Convert existing SD Card to LUKS</h4><p>To convert your root file system to LUKS/dm-crypt, you will need to connect an external USB disk (as temporary storage). As mentioned previously, this is necessary because it is not possible to encrypt the partition in place, so the external disk is needed as temporary storage and a temporary root file system while the conversion takes place. The external disk needs to be at least twice as big as the root partition. Next, run the following script:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_sd_rfs.sh | sudo bash</code></p><p>For RPi users: This script is parameterized, so if you have special requirements (e.g. root file system lives on /dev/mmcblk0p4), you can invoke it in the following fashion:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_sd_rfs.sh | sudo bash -s -- -x &lt;path to external storage device (e.g. /dev/sdX> -m &lt;source partition number></code></p><p>In the above invocation with no parameters, the defaults are:</p><ol><li>Original root file system located on /dev/mmcblk0p2</li><li>Temporary root file system/storage for original root tarball located on /dev/sda</li><li>Temporary root file system takes up entirety of new device</li></ol><p><strong>The very first run of this script on a new temporary external USB disk could take a long time. Also, two reboots are required before the script is complete.</strong></p><p>One thing to note is that, if the external storage device has an ext4 formatted partition with the original root file system partition (e.g. /dev/mmcblk0p2) on it, this script will use what is already on the external storage device to convert the SD card. This cuts down time for converting lots of device root file systems and allows the script to be used in a mass production deployment.</p><p>On a Pi3 with an attached USB SSD as the external device on a bare Jessie &ldquo;full&rdquo; version (~4GB), the first run of this script requires about an hour to complete the first phase. The second phase takes around 15 minutes.</p><p>The same platform with a Jessie &ldquo;lite&rdquo; version (~1.6GB) takes around 20 minutes for phase 1 and 5 minutes for phase 2.</p><p>For Jetson, the first run of this script can take upwards of 30 minutes to an hour to complete the first phase. The second phase takes around 15 minutes.</p><p>Based on the above, using the formatted external device to convert subsequent units should only take 15 minutes.</p><h4 id=option-2---migrate-existing-sd-card-to-external-luks-storage-device-1>Option 2 - Migrate existing SD card to external LUKS storage device.</h4><p>To migrate your root file system to an external USB device, you can run the following script:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_ext_rfs.sh | sudo bash</code></p><p>This script is parameterized, so if you have special requirements, you can invoke in the following fashion:</p><p><code>curl -G https://s3.amazonaws.com/zk-sw-repo/mk_encr_ext_rfs.sh | sudo bash -s -- -x &lt;path to external storage device (e.g. /dev/sdX> -p &lt;destination partition number -s &lt;max size of new root partition> -m &lt;source partition number></code></p><p>In the above invocation with no parameters, the defaults for RPi are:</p><ol><li>Original root file system located on /dev/mmcblk0p2</li><li>New root file system located on /dev/sda1</li><li>New root file system takes up entirety of new device
The defaults for Jetson are:</li><li>Original root file system located on /dev/mmcblk0p1</li><li>Temporary root file system/storage for original root tarball located on /dev/sda</li><li>Temporary root file system takes up entirety of new device</li></ol><p>Please note that the new root file system should be at least a little larger in size than the original root partition</p><p>Running this script takes around 30-40 minutes. The HSM6&rsquo;s LED flashes rapidly until the process has completed.</p><hr><h3 id=integrating-luks-into-volume-manufacturing-workflow>INTEGRATING LUKS INTO VOLUME MANUFACTURING WORKFLOW</h3><p>The examples above are designed to help you get up and running with single and low volume applications.</p><p>If you require support in developing a high volume manufacturing encryption workflow then please <a href=https://www.zymbit.com/contact-form/>contact us</a> to discuss our OEM engineering services.</p><hr><h3 id=references>REFERENCES</h3><ul><li><p><a href=https://wiki.archlinux.org/index.php/disk_encryption#Comparison_table>LUKS features - the de-facto standard in Linux Kernel.</a></p></li><li><p><a href=https://en.wikipedia.org/wiki/Dm-crypt>Wiki overview to dm-crypt</a></p></li><li><p><a href=https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption#Adding_LUKS_keys>ArchLinux - adding LUKS keys to dm-crypt device encryption</a></p></li><li><p><a href=https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions>GitLab - LUKS and Cryptsetup - FAQ</a></p></li><li><p><a href=https://gitlab.com/cryptsetup/cryptsetup>GitLab - LUKS and Cryptsetup - open-source disk encryption</a></p></li></ul><h2 id=troubleshooting>TROUBLESHOOTING</h2><ul><li><a href=https://docs.zymbit.com/quickstart/faq/hsm6/#troubleshooting>HSM6 Troubleshooting FAQ</a></li><li><a href=https://community.zymbit.com/>Community Forum</a></li></ul><div class="text-muted mt-5 pt-3 border-top"></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.2ba2da7d2fe4be755f96e1f7760bcc4a769c4b9369d2356a8872050735635419.js integrity="sha256-K6LafS/kvnVfluH3dgvMSnacS5Np0jVqiHIFBzVjVBk=" crossorigin=anonymous></script></body></html>