<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Sending a Web3 Ethereum Transaction |</title><meta name=description content="Updated: 2022-09-30
What is a Cryptographic ECDSA Signature?
An ECDSA (Elliptic Curve Digital Signature Algorithm) signature is generated by a private …"><meta property="og:title" content="Sending a Web3 Ethereum Transaction"><meta property="og:description" content="Updated: 2022-09-30
What is a Cryptographic ECDSA Signature? An ECDSA (Elliptic Curve Digital Signature Algorithm) signature is generated by a private key in the elliptic curve family. We use these signatures as proof of identity (private key owner) and proof that the message has not been tampered with during the journey.
Signatures are effectively a user&rsquo;s wax seal on an envelope. Signatures play a huge role at the low level in blockchain."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.zymbit.com/tutorials/digital-wallet/ethereum-signing-example/"><meta property="og:image" content="https://docs.zymbit.com/doks.png"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2022-01-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-22T20:56:02-08:00"><meta property="og:site_name" content="Zymbit Documentation"><meta itemprop=name content="Sending a Web3 Ethereum Transaction"><meta itemprop=description content="Updated: 2022-09-30
What is a Cryptographic ECDSA Signature? An ECDSA (Elliptic Curve Digital Signature Algorithm) signature is generated by a private key in the elliptic curve family. We use these signatures as proof of identity (private key owner) and proof that the message has not been tampered with during the journey.
Signatures are effectively a user&rsquo;s wax seal on an envelope. Signatures play a huge role at the low level in blockchain."><meta itemprop=datePublished content="2022-01-03T00:00:00+00:00"><meta itemprop=dateModified content="2023-01-22T20:56:02-08:00"><meta itemprop=wordCount content="2997"><meta itemprop=image content="https://docs.zymbit.com/doks.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://docs.zymbit.com/doks.png"><meta name=twitter:title content="Sending a Web3 Ethereum Transaction"><meta name=twitter:description content="Updated: 2022-09-30
What is a Cryptographic ECDSA Signature? An ECDSA (Elliptic Curve Digital Signature Algorithm) signature is generated by a private key in the elliptic curve family. We use these signatures as proof of identity (private key owner) and proof that the message has not been tampered with during the journey.
Signatures are effectively a user&rsquo;s wax seal on an envelope. Signatures play a huge role at the low level in blockchain."><link rel=preload href=/scss/main.min.67b6b00bca6864cf5153909b7a58e2b18e24ec0397ca97400cf95bacffb3572c.css as=style><link href=/scss/main.min.67b6b00bca6864cf5153909b7a58e2b18e24ec0397ca97400cf95bacffb3572c.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><img class=navbar-logo src=https://docs.zymbit.com/Zymbit-Logo.gif></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://community.zymbit.com/ target=_blank><i class="fab fa-discourse"></i><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://zymbit.com target=_blank><i class="fa fa-home"></i><span>zymbit.com</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a08b3e329d97cab0f6d51c506ef017dd.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a08b3e329d97cab0f6d51c506ef017dd.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0 fa-ul"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span class=fa-li><i class=nav-open-tree></i></span><span>Zymbit Documentation</span></a><ul class="pr-md-3 ul-1"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><input type=checkbox id=m-getting-started-check checked>
<label for=m-getting-started-check><a href=/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span class=td-sidebar-link__section>Getting Started</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedscm-li><input type=checkbox id=m-getting-startedscm-check>
<label for=m-getting-startedscm-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedscm><span class=td-sidebar-link__section>Secure Compute Module - SCM</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscmquickstart-li><input type=checkbox id=m-getting-startedscmquickstart-check>
<label for=m-getting-startedscmquickstart-check><a href=/getting-started/scm/quickstart/ title="SCM - Getting Started" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscmquickstart><span class=td-sidebar-link__page>Getting Started</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscmproduction-mode-li><input type=checkbox id=m-getting-startedscmproduction-mode-check>
<label for=m-getting-startedscmproduction-mode-check><a href=/getting-started/scm/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscmproduction-mode><span class=td-sidebar-link__page>Enabling Production Mode - SCM</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedzymkey4-li><input type=checkbox id=m-getting-startedzymkey4-check>
<label for=m-getting-startedzymkey4-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedzymkey4><span class=td-sidebar-link__section>ZYMKEY4</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedzymkey4quickstart-li><input type=checkbox id=m-getting-startedzymkey4quickstart-check>
<label for=m-getting-startedzymkey4quickstart-check><a href=/getting-started/zymkey4/quickstart/ title="Zymkey4 Quickstart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedzymkey4quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedzymkey4production-mode-li><input type=checkbox id=m-getting-startedzymkey4production-mode-check>
<label for=m-getting-startedzymkey4production-mode-check><a href=/getting-started/zymkey4/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedzymkey4production-mode><span class=td-sidebar-link__page>Enabling Production Mode</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedhsm4-li><input type=checkbox id=m-getting-startedhsm4-check>
<label for=m-getting-startedhsm4-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedhsm4><span class=td-sidebar-link__section>HSM4</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm4quickstart-li><input type=checkbox id=m-getting-startedhsm4quickstart-check>
<label for=m-getting-startedhsm4quickstart-check><a href=/getting-started/hsm4/quickstart/ title="HSM4 Quickstart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm4quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm4production-mode-li><input type=checkbox id=m-getting-startedhsm4production-mode-check>
<label for=m-getting-startedhsm4production-mode-check><a href=/getting-started/hsm4/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm4production-mode><span class=td-sidebar-link__page>Enabling Production Mode - HSM4</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-startedhsm6-li><input type=checkbox id=m-getting-startedhsm6-check>
<label for=m-getting-startedhsm6-check><span class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-getting-startedhsm6><span class=td-sidebar-link__section>HSM6</span></span></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm6quickstart-li><input type=checkbox id=m-getting-startedhsm6quickstart-check>
<label for=m-getting-startedhsm6quickstart-check><a href=/getting-started/hsm6/quickstart/ title="HSM6 Quickstart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm6quickstart><span class=td-sidebar-link__page>Quickstart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedhsm6production-mode-li><input type=checkbox id=m-getting-startedhsm6production-mode-check>
<label for=m-getting-startedhsm6production-mode-check><a href=/getting-started/hsm6/production-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedhsm6production-mode><span class=td-sidebar-link__page>Enabling Production Mode - HSM6</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedscn-li><input type=checkbox id=m-getting-startedscn-check>
<label for=m-getting-startedscn-check><a href=https://www.zymbit.com/secure-compute-node/ title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedscn><span class=td-sidebar-link__page>Secure Compute Node</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-api-li><input type=checkbox id=m-api-check checked>
<label for=m-api-check><a href=/api/ title="API Documentation" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-api><span class=td-sidebar-link__section>API</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apiapi_docs_intro-li><input type=checkbox id=m-apiapi_docs_intro-check>
<label for=m-apiapi_docs_intro-check><a href=/api/api_docs_intro/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apiapi_docs_intro><span class=td-sidebar-link__page>Intro to Zymkey Application Utilities</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apic_api-li><input type=checkbox id=m-apic_api-check>
<label for=m-apic_api-check><a href=/api/c_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apic_api><span class=td-sidebar-link__page>C API Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apicpp_api-li><input type=checkbox id=m-apicpp_api-check>
<label for=m-apicpp_api-check><a href=/api/cpp_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apicpp_api><span class=td-sidebar-link__page>C++ API Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-apipython_api-li><input type=checkbox id=m-apipython_api-check>
<label for=m-apipython_api-check><a href=/api/python_api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-apipython_api><span class=td-sidebar-link__page>Python API Documentation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-troubleshooting-li><input type=checkbox id=m-troubleshooting-check checked>
<label for=m-troubleshooting-check><a href=/troubleshooting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-troubleshooting><span class=td-sidebar-link__section>FAQ and Troubleshooting</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinggeneral-li><input type=checkbox id=m-troubleshootinggeneral-check>
<label for=m-troubleshootinggeneral-check><a href=/troubleshooting/general/ title="General FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinggeneral><span class=td-sidebar-link__page>General</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingscm-li><input type=checkbox id=m-troubleshootingscm-check>
<label for=m-troubleshootingscm-check><a href=/troubleshooting/scm/ title="SCM Troubleshooting/FAQ" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingscm><span class=td-sidebar-link__page>SCM</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootingzymkey4-li><input type=checkbox id=m-troubleshootingzymkey4-check>
<label for=m-troubleshootingzymkey4-check><a href=/troubleshooting/zymkey4/ title="ZYMKEY4 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootingzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinghsm4-li><input type=checkbox id=m-troubleshootinghsm4-check>
<label for=m-troubleshootinghsm4-check><a href=/troubleshooting/hsm4/ title="HSM4 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinghsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-troubleshootinghsm6-li><input type=checkbox id=m-troubleshootinghsm6-check>
<label for=m-troubleshootinghsm6-check><a href=/troubleshooting/hsm6/ title="HSM6 FAQ & Troubleshooting" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-troubleshootinghsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><input type=checkbox id=m-reference-check checked>
<label for=m-reference-check><a href=/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span class=td-sidebar-link__section>Reference</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceproduct-briefs-li><input type=checkbox id=m-referenceproduct-briefs-check>
<label for=m-referenceproduct-briefs-check><a href=/reference/product-briefs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceproduct-briefs><span class=td-sidebar-link__section>Product Briefs</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefszymkey4-li><input type=checkbox id=m-referenceproduct-briefszymkey4-check>
<label for=m-referenceproduct-briefszymkey4-check><a href=https://www.zymbit.com/datasheets/zymkey-4i title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefszymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefshsm4-li><input type=checkbox id=m-referenceproduct-briefshsm4-check>
<label for=m-referenceproduct-briefshsm4-check><a href=https://www.zymbit.com/datasheets/hsm4 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefshsm6-li><input type=checkbox id=m-referenceproduct-briefshsm6-check>
<label for=m-referenceproduct-briefshsm6-check><a href=https://www.zymbit.com/datasheets/hsm6 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefshsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceproduct-briefsmfg-app-li><input type=checkbox id=m-referenceproduct-briefsmfg-app-check>
<label for=m-referenceproduct-briefsmfg-app-check><a href=https://www.zymbit.com/datasheets/manufacturing-appliance-1 title target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceproduct-briefsmfg-app><span class=td-sidebar-link__page>Manufacturing Appliance</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencedatasheets-li><input type=checkbox id=m-referencedatasheets-check>
<label for=m-referencedatasheets-check><a href=/reference/datasheets/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referencedatasheets><span class=td-sidebar-link__section>Datasheets</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedatasheetshsm4-li><input type=checkbox id=m-referencedatasheetshsm4-check>
<label for=m-referencedatasheetshsm4-check><a href=/reference/datasheets/hsm4/ title="HSM4 Datasheets" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencedatasheetshsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecad-li><input type=checkbox id=m-referencecad-check>
<label for=m-referencecad-check><a href=/reference/cad/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referencecad><span class=td-sidebar-link__section>CAD Files</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadzymkey4-li><input type=checkbox id=m-referencecadzymkey4-check>
<label for=m-referencecadzymkey4-check><a href=/reference/cad/zymkey4/ title="Zymkey4 CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadhsm4-li><input type=checkbox id=m-referencecadhsm4-check>
<label for=m-referencecadhsm4-check><a href=/reference/cad/hsm4/ title="HSM4 CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadhsm6-li><input type=checkbox id=m-referencecadhsm6-check>
<label for=m-referencecadhsm6-check><a href=/reference/cad/hsm6/ title="HSM6 CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadhsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecadscm-li><input type=checkbox id=m-referencecadscm-check>
<label for=m-referencecadscm-check><a href=/reference/cad/scm/ title="SCM CAD Files" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecadscm><span class=td-sidebar-link__page>Secure Compute Module (SCM)</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceconformity-li><input type=checkbox id=m-referenceconformity-check>
<label for=m-referenceconformity-check><a href=/reference/conformity/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-referenceconformity><span class=td-sidebar-link__section>Conformity Documents</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityzymkey4-li><input type=checkbox id=m-referenceconformityzymkey4-check>
<label for=m-referenceconformityzymkey4-check><a href=/reference/conformity/zymkey4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityzymkey4><span class=td-sidebar-link__page>Zymkey4 Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityhsm4-li><input type=checkbox id=m-referenceconformityhsm4-check>
<label for=m-referenceconformityhsm4-check><a href=/reference/conformity/hsm4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm4><span class=td-sidebar-link__page>HSM4 Conformity Documents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceconformityhsm6-li><input type=checkbox id=m-referenceconformityhsm6-check>
<label for=m-referenceconformityhsm6-check><a href=/reference/conformity/hsm6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referenceconformityhsm6><span class=td-sidebar-link__page>HSM6 Conformity Documents</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepower-quality-li><input type=checkbox id=m-referencepower-quality-check>
<label for=m-referencepower-quality-check><a href=/reference/power-quality/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencepower-quality><span class=td-sidebar-link__page>Power Quality Considerations</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencebinding-li><input type=checkbox id=m-referencebinding-check>
<label for=m-referencebinding-check><a href=/reference/binding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencebinding><span class=td-sidebar-link__page>Binding, Device ID, and Authentication</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereserved-pins-li><input type=checkbox id=m-referencereserved-pins-check>
<label for=m-referencereserved-pins-check><a href=/reference/reserved-pins/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencereserved-pins><span class=td-sidebar-link__page>SCM Reserved Pins</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpu-scaling-li><input type=checkbox id=m-referencecpu-scaling-check>
<label for=m-referencecpu-scaling-check><a href=/reference/cpu-scaling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpu-scaling><span class=td-sidebar-link__page>CPU Scaling Governor</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencereal-time-clock-li><input type=checkbox id=m-referencereal-time-clock-check>
<label for=m-referencereal-time-clock-check><a href=/reference/real-time-clock/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-referencereal-time-clock><span class=td-sidebar-link__page>Real Time Clock Operation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><input type=checkbox id=m-tutorials-check checked>
<label for=m-tutorials-check><a href=/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorials><span class=td-sidebar-link__section>Tutorials</span></a></label><ul class="pr-md-3 ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssupervised-boot-li><input type=checkbox id=m-tutorialssupervised-boot-check>
<label for=m-tutorialssupervised-boot-check><a href=/tutorials/supervised-boot/ title="Working with SCM Supervised Boot" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssupervised-boot><span class=td-sidebar-link__page>Supervised Boot (SCM)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsalternative-gpio-li><input type=checkbox id=m-tutorialsalternative-gpio-check>
<label for=m-tutorialsalternative-gpio-check><a href=/tutorials/alternative-gpio/ title="Using an Alternative GPIO Pin" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsalternative-gpio><span class=td-sidebar-link__page>Alternative GPIO Pin</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsdigital-wallet-li><input type=checkbox id=m-tutorialsdigital-wallet-check checked>
<label for=m-tutorialsdigital-wallet-check><a href=/tutorials/digital-wallet/ title="Zymbit Embedded Hardware Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdigital-wallet><span class=td-sidebar-link__section>Embedded Hardware Wallet</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletwallet-example-li><input type=checkbox id=m-tutorialsdigital-walletwallet-example-check>
<label for=m-tutorialsdigital-walletwallet-example-check><a href=/tutorials/digital-wallet/wallet-example/ title="Working with the Zymbit Hardware Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletwallet-example><span class=td-sidebar-link__page>Zymbit Hardware Wallet</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletethereum-signing-example-li><input type=checkbox id=m-tutorialsdigital-walletethereum-signing-example-check>
<label for=m-tutorialsdigital-walletethereum-signing-example-check><a href=/tutorials/digital-wallet/ethereum-signing-example/ title="Sending a Web3 Ethereum Transaction" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletethereum-signing-example><span class="td-sidebar-nav-active-item td-sidebar-link__page">Ethereum Transaction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletslip39-example-li><input type=checkbox id=m-tutorialsdigital-walletslip39-example-check>
<label for=m-tutorialsdigital-walletslip39-example-check><a href=/tutorials/digital-wallet/slip39-example/ title="SLIP39 and Shamir's Wallet Recovery Example" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletslip39-example><span class=td-sidebar-link__page>SLIP39 and Shamir's</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdigital-walletoversight-example-li><input type=checkbox id=m-tutorialsdigital-walletoversight-example-check>
<label for=m-tutorialsdigital-walletoversight-example-check><a href=/tutorials/digital-wallet/oversight-example/ title="Creating an Oversight (Read Only) Wallet" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdigital-walletoversight-example><span class=td-sidebar-link__page>Oversight Wallet</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsencrypt-rfs-li><input type=checkbox id=m-tutorialsencrypt-rfs-check>
<label for=m-tutorialsencrypt-rfs-check><a href=/tutorials/encrypt-rfs/ title="Encrypting Root File System with Zymbit Security Modules" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsencrypt-rfs><span class=td-sidebar-link__page>Encrypt Root File System</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssensor-data-li><input type=checkbox id=m-tutorialssensor-data-check>
<label for=m-tutorialssensor-data-check><a href=/tutorials/sensor-data/ title="Encrypting & Decrypting Sensor Data on Disk" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssensor-data><span class=td-sidebar-link__page>Encrypt Sensor Data</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsaws-iot-li><input type=checkbox id=m-tutorialsaws-iot-check>
<label for=m-tutorialsaws-iot-check><a href=/tutorials/aws-iot/ title="AWS IoT Integrations & Client Certificates" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsaws-iot><span class=td-sidebar-link__section>Integrate Zymbit with AWS</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotverify-sigs-li><input type=checkbox id=m-tutorialsaws-iotverify-sigs-check>
<label for=m-tutorialsaws-iotverify-sigs-check><a href=/tutorials/aws-iot/verify-sigs/ title="How to Verify Signatures against Public Key on AWS and Other Devices" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotverify-sigs><span class=td-sidebar-link__page>Verify Signatures</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iottls-li><input type=checkbox id=m-tutorialsaws-iottls-check>
<label for=m-tutorialsaws-iottls-check><a href=/tutorials/aws-iot/tls/ title="AWS IoT - TLS Client Certificate Authentication" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iottls><span class=td-sidebar-link__page>Transport Level Security</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotintegrate-li><input type=checkbox id=m-tutorialsaws-iotintegrate-check>
<label for=m-tutorialsaws-iotintegrate-check><a href=/tutorials/aws-iot/integrate/ title="How to Integrate Zymbit with AWS Credentials Provider" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotintegrate><span class=td-sidebar-link__page>Integrate with AWS Credentials Provider</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsaws-iotjitr-li><input type=checkbox id=m-tutorialsaws-iotjitr-check>
<label for=m-tutorialsaws-iotjitr-check><a href=/tutorials/aws-iot/jitr/ title="AWS IoT - Just in Time Registration of Client Certificates using Lambda functions" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsaws-iotjitr><span class=td-sidebar-link__page>Just In Time Registration</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsperimeter-detect-li><input type=checkbox id=m-tutorialsperimeter-detect-check>
<label for=m-tutorialsperimeter-detect-check><a href=/tutorials/perimeter-detect/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsperimeter-detect><span class=td-sidebar-link__section>Perimeter Detect</span></a></label><ul class="pr-md-3 ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectzymkey4-li><input type=checkbox id=m-tutorialsperimeter-detectzymkey4-check>
<label for=m-tutorialsperimeter-detectzymkey4-check><a href=/tutorials/perimeter-detect/zymkey4/ title="Perimeter Detect: ZYMKEY4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectzymkey4><span class=td-sidebar-link__page>ZYMKEY4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detecthsm4-li><input type=checkbox id=m-tutorialsperimeter-detecthsm4-check>
<label for=m-tutorialsperimeter-detecthsm4-check><a href=/tutorials/perimeter-detect/hsm4/ title="Perimeter Detect: HSM4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm4><span class=td-sidebar-link__page>HSM4</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detecthsm6-li><input type=checkbox id=m-tutorialsperimeter-detecthsm6-check>
<label for=m-tutorialsperimeter-detecthsm6-check><a href=/tutorials/perimeter-detect/hsm6/ title="Perimeter Detect: HSM6" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detecthsm6><span class=td-sidebar-link__page>HSM6</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectscm-li><input type=checkbox id=m-tutorialsperimeter-detectscm-check>
<label for=m-tutorialsperimeter-detectscm-check><a href=/tutorials/perimeter-detect/scm/ title="Perimeter Detect: SCM" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectscm><span class=td-sidebar-link__page>SCM</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsperimeter-detectexamples-li><input type=checkbox id=m-tutorialsperimeter-detectexamples-check>
<label for=m-tutorialsperimeter-detectexamples-check><a href=/tutorials/perimeter-detect/examples/ title="Perimeter Detect Circuit Examples" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsperimeter-detectexamples><span class=td-sidebar-link__page>CIRCUIT EXAMPLES</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsprotokit-li><input type=checkbox id=m-tutorialsprotokit-check>
<label for=m-tutorialsprotokit-check><a href=/tutorials/protokit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsprotokit><span class=td-sidebar-link__page>ProtoKit5</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#what-is-a-cryptographic-ecdsa-signature>What is a Cryptographic ECDSA Signature?</a></li><li><a href=#why-use-hardware-wallets-like-our-zymbit-modules>Why use hardware wallets like our Zymbit modules?</a><ul><li><ul><li><a href=#useful-resources>Useful Resources:</a></li></ul></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#setting-up-infura-project>Setting up Infura project</a></li></ul></li><li><a href=#web3-example>Web3 Example</a><ul><li><ul><li><a href=#import-the-python-libs-we-need>Import the python libs we need:</a></li><li><a href=#open-a-web3-instance>Open a Web3 instance:</a></li><li><a href=#generating-a-secp256k1-key-pair-to-be-the-sender>Generating a secp256k1 key pair to be the sender:</a></li><li><a href=#generate-the-ethereum-public-addressaccount-from-the-secp256k1-public-key>Generate the Ethereum public address/account from the secp256k1 public key</a></li><li><a href=#creating-the-transaction-classes-and-making-them-rlpserializable>Creating the transaction classes and making them rlp.serializable()</a></li><li><a href=#create-the-example-transaction-to-send>Create the example transaction to send</a></li><li><a href=#preparing-our-transaction-to-be-signed-by-the-zymbit-hardware>Preparing our transaction to be signed by the Zymbit hardware</a></li><li><a href=#signing-the-transaction-data-with-a-private-key-stored-on-the-zymbit-module>Signing the transaction data with a private key stored on the Zymbit module.</a></li><li><a href=#adding-our-signature-to-our-transaction-class>Adding our signature to our transaction class</a></li><li><a href=#one-last-step-before-send-off-rlp-encode-the-signed-transaction>One Last Step before send off. RLP encode the signed transaction.</a></li><li><a href=#send-your-transaction>Send your transaction</a></li></ul></li><li><a href=#full-example-code>Full Example Code</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-8 col-xl-7 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/>Tutorials</a></li><li class=breadcrumb-item><a href=https://docs.zymbit.com/tutorials/digital-wallet/>Embedded Hardware Wallet</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.zymbit.com/tutorials/digital-wallet/ethereum-signing-example/>Ethereum Transaction</a></li></ol></nav><div class=td-content><h1>Sending a Web3 Ethereum Transaction</h1><header class=article-meta></header><p>Updated: 2022-09-30</p><h2 id=what-is-a-cryptographic-ecdsa-signature>What is a Cryptographic ECDSA Signature?</h2><p>An ECDSA (Elliptic Curve Digital Signature Algorithm) signature is generated by a private key in the elliptic curve family. We use these signatures as proof of identity (private key owner) and proof that the message has not been tampered with during the journey.</p><p>Signatures are effectively a user&rsquo;s wax seal on an envelope. Signatures play a huge role at the low level in blockchain. All data must be signed before being transmitted to the blockchain.</p><p><img src=eth_flow.png alt=Flowchart></p><h2 id=why-use-hardware-wallets-like-our-zymbit-modules>Why use hardware wallets like our Zymbit modules?</h2><p>Hardware wallets are built to securely store private keys on their hardware. Hardware wallets are more secure and harder to penetrate than locally saved private keys on computers, as computers have a lot more attack vectors through user access, malware, network, etc.</p><p>The private keys stored in our modules are never exportable and are always hidden even from the user.</p><h4 id=useful-resources>Useful Resources:</h4><ul><li><a href=https://ethereum.github.io/yellowpaper/paper.pdf>Ethereum Yellow Paper</a></li><li><a href=https://eth.wiki/en/fundamentals/rlp>RLP (Recursive Length Prefix) Wiki</a></li></ul><h3 id=prerequisites>Prerequisites</h3><ul><li><p>Zymbit Modules that support this feature:</p><ul><li><a href=https://www.zymbit.com/hsm6/>HSM6</a></li><li><a href=https://www.zymbit.com/secure-compute-platform/>SCM</a></li></ul></li><li><p>Follow the <a href=../../../getting-started/>Getting Started guide</a> first, installing all baseline software.</p></li><li><p>All code snippets written in this article are written using python3. For more Zymbit API documentation (Python/C/C++) visit: <a href=../../../api/>API Documentation</a></p></li><li><p>Python libraries used in this example:</p><ul><li>This library is used for rlp encoding</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>apt install pandoc
</span></span></code></pre></div><ul><li>This library is used for Crypto.Hash() functions. In this example we will be using keccak hashes.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>pip3 install pycryptodome
</span></span></code></pre></div><ul><li>Web3 for easy-to-use blockchain development.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>pip3 install web3
</span></span></code></pre></div></li></ul><h3 id=setting-up-infura-project>Setting up Infura project</h3><p>The quickest way to interact with the ethereum blockchain network is to use remote providers like: <a href=https://infura.io/><strong>Infura</strong></a>, <a href=https://www.alchemy.com/><strong>Alchemy</strong></a>, or <a href=https://www.quicknode.com/><strong>QuickNode.</strong></a> For this example, we will use Infura to interact with our web3 code.</p><ol><li><a href=https://infura.io/>Create an Infura Account</a> and log in.</li><li>Create a new project this can be named anything you want.</li></ol><p><img src=infura_login.png alt="Infura Login"></p><ol start=3><li>Go to project settings and change the endpoints dropdown from Mainnet->Ropsten. Ropsten is the test network we will be testing our transaction on. Write down the web link to our test project for web3 to communicate with.</li></ol><div class="callout callout-warning"><div class=callout-heading><i class="callout-icon fas fa-exclamation-triangle"></i>
<span class=callout-title>Warning</span></div><div class=callout-body>If you are developing in Infura moving forward, make sure to not give out the project secret and project ID!</div></div><p><img src=infura_project.png alt="Infura Project"></p><h2 id=web3-example>Web3 Example</h2><h4 id=import-the-python-libs-we-need>Import the python libs we need:</h4><ul><li>Import zymkey to open up a zymkey instance, so we can communicate to our zymbit products for key generation and ecdsa signatures.</li><li>Import binascii for simple hexlify() and unhexlify() functions.</li><li>Per Ethereum standards, import RLP for data compression and Keccak for hashing.</li><li>Import Web3 for simple communication to Ethereum nodes.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>zymkey</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>rlp</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>rlp.sedes</span> <span class=kn>import</span> <span class=n>binary</span><span class=p>,</span> <span class=n>Binary</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>,</span> <span class=n>BigEndianInt</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>CountableList</span><span class=p>,</span> <span class=n>boolean</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Hash</span> <span class=kn>import</span> <span class=n>keccak</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>web3</span> <span class=kn>import</span> <span class=n>Web3</span>
</span></span></code></pre></div><h4 id=open-a-web3-instance>Open a Web3 instance:</h4><p>Using the endpoint link from our Infura project, open a Web3 instance object.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Create web3 instance, from infura project (node) connecting to Ropsten test network</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>w3</span> <span class=o>=</span> <span class=n>Web3</span><span class=p>(</span><span class=n>Web3</span><span class=o>.</span><span class=n>HTTPProvider</span><span class=p>(</span><span class=s1>&#39;https://ropsten.infura.io/v3/9f06183d0529494792242beb59be4ad3&#39;</span><span class=p>))</span>
</span></span></code></pre></div><h4 id=generating-a-secp256k1-key-pair-to-be-the-sender>Generating a secp256k1 key pair to be the sender:</h4><p>Ethereum network is based off the Koblitz curve &ldquo;secp256k1&rdquo;, so individual accounts are generated from secp256k1 public/private key pairs. The private key in the key pair is used to sign/encrypt data to be sent to the network or other users.</p><p>The public key in the key pair is used to verify the data owner&rsquo;s identity and decrypt the data received. The public key can not be reverse engineered to get the private key. It is safe to send out the public key to other users.</p><div class="callout callout-warning"><div class=callout-heading><i class="callout-icon fas fa-exclamation-triangle"></i>
<span class=callout-title>Warning</span></div><div class=callout-body><strong>Never send another user a private key!</strong> The Zymbit hardware wallet never exposes the private key.</div></div><p>Generate a secp256k1 key pair and export the public key from the slot to use later.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Ethereum is based on secp256k1 (Koblitz curve). Generate a &#34;secp256k1&#34; key pair using Zymbit API functions.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>zymkey_pub_key_slot</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>gen_key_pair</span><span class=p>(</span><span class=s2>&#34;secp256k1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pub_key</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get_public_key</span><span class=p>(</span><span class=n>zymkey_pub_key_slot</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;zymkey secp256k1 public key:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>pub_key</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=generate-the-ethereum-public-addressaccount-from-the-secp256k1-public-key>Generate the Ethereum public address/account from the secp256k1 public key</h4><p>The next step covers generating an Ethereum public address. An Ethereum address is akin to a user&rsquo;s account number on the Ethereum network and will be used to identify your transactions. Ethereum addresses look like this: <code>0x15C25E6EB5dE729d7e310d059e59659cCB86E6f6</code>.</p><p>Details on how the Ethereum standard formulates a checksum address (public address) from a secp256k1 public key.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Get ECDSA secp256k1 public key from zymkey and generate our Ethereum sender&#39;s checksum address</span>
</span></span><span class=line><span class=cl><span class=c1># Keccak Hash the public key and save only the last 20 bytes of the hash. This is to prevent reverse-engineering</span>
</span></span><span class=line><span class=cl><span class=c1># of the public address back to the original public key.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span> <span class=o>=</span> <span class=n>keccak</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>digest_bits</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>pub_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_digest</span> <span class=o>=</span> <span class=n>keccak_hash</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># Take the last 20 bytes</span>
</span></span><span class=line><span class=cl><span class=n>wallet_len</span> <span class=o>=</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl><span class=n>wallet_addr</span> <span class=o>=</span> <span class=s2>&#34;0x&#34;</span> <span class=o>+</span> <span class=n>keccak_digest</span><span class=p>[</span><span class=o>-</span><span class=n>wallet_len</span><span class=p>:]</span>
</span></span></code></pre></div><p>We then need to randomize the capitalization of these values via <a href=https://eips.ethereum.org/EIPS/eip-55><strong>EIP-55 standard</strong>.</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># A built-in EIP-55 easy one-liner from Web3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>checksum</span> <span class=o>=</span> <span class=n>Web3</span><span class=o>.</span><span class=n>toChecksumAddress</span><span class=p>(</span><span class=n>wallet_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Eth Checksum:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>checksum</span><span class=p>)</span>
</span></span></code></pre></div><p>--<strong>OR</strong>&ndash;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Performing EIP-55 ourselves</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>checksum</span> <span class=o>=</span> <span class=s2>&#34;0x&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Remove &#39;0x&#39; from the address</span>
</span></span><span class=line><span class=cl><span class=n>address</span> <span class=o>=</span> <span class=n>wallet_addr</span><span class=p>[</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=n>address_byte_array</span> <span class=o>=</span> <span class=n>address</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span> <span class=o>=</span> <span class=n>keccak</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>digest_bits</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>address_byte_array</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_digest</span> <span class=o>=</span> <span class=n>keccak_hash</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>address</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>address_char</span> <span class=o>=</span> <span class=n>address</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>keccak_char</span> <span class=o>=</span> <span class=n>keccak_digest</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>keccak_char</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>checksum</span> <span class=o>+=</span> <span class=n>address_char</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>checksum</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>address_char</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Eth Checksum:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>checksum</span><span class=p>)</span>
</span></span></code></pre></div><p>Verify this is a valid ethereum public address using web3:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Valid checksum:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>Web3</span><span class=o>.</span><span class=n>isAddress</span><span class=p>(</span><span class=n>checksum</span><span class=p>))</span>
</span></span></code></pre></div><p>This is the ethereum public address of our sender. The sender signs the transaction and sends it out. Once the receiver gets the transaction they will see it was from this sender&rsquo;s address.</p><div class="callout callout-notice"><div class=callout-heading><i class="callout-icon fas fa-flag"></i>
<span class=callout-title>Notice</span></div><div class=callout-body><p>To properly send out transaction to the Ropsten test network with this sender&rsquo;s address. We need funds in this address to pay for the fees required to send out this transaction.</p><p>Because Ropsten is a test network for development, we can fund ethereum addresses for free with test ether. (Note: There is only one address per day limit).</p><p>You can do this here: <a href=https://faucet.egorfine.com/><strong>Ropsten Faucet</strong></a></p></div></div><h4 id=creating-the-transaction-classes-and-making-them-rlpserializable>Creating the transaction classes and making them rlp.serializable()</h4><p>RLP (Recursive Length Prefix) is a encoding method to compress binary and arrays of data. RLP is the official encoding method used on the ethereum network. So to abide by the standard we need to create a transaction class object, which have attributes that are rlp serializable. Thankfully the rlp library(pandoc) we installed earlier, lets us do this easily by subclassing rlp.serializable.</p><p>As of the london hard fork in august 2021, Ethereum Mainnet accepts multiple transaction types. There are currently three transaction types:</p><ul><li>Transaction Legacy [Type 0]</li><li>Transaction <a href=https://eips.ethereum.org/EIPS/eip-2930><strong>EIP-2930</strong></a> [Type 1]</li><li>Transaction <a href=https://eips.ethereum.org/EIPS/eip-1559><strong>EIP-1559</strong></a> [Type 2]</li></ul><p>All transactions are accepted by Mainnet and there will be more transaction types in the future. For this example, we will show generating and signing Transaction Legacy (it was used for a long period of time) and Transaction EIP-1559 (the current default transaction on Mainnet).</p><p>Create our rlp.serializable transaction classes (Order of attributes matter!):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#------------------------------------Abstract Type Declaractions------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># This is a rlp serializable type for accessList param in Transaction EIP-2930 and EIP-1559</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>access_list_sede_type</span> <span class=o>=</span> <span class=n>CountableList</span><span class=p>(</span><span class=n>List</span><span class=p>([</span><span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span> <span class=n>CountableList</span><span class=p>(</span><span class=n>BigEndianInt</span><span class=p>(</span><span class=mi>32</span><span class=p>)),]),)</span>
</span></span><span class=line><span class=cl><span class=c1>#------------------------------------Class Definitions----------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># Transaction Legacy</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TransactionLegacy</span><span class=p>(</span><span class=n>rlp</span><span class=o>.</span><span class=n>Serializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;nonce&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gasPrice&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gasLimit&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;to&#34;</span><span class=p>,</span> <span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=n>binary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;v&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transaction EIP-1559 </span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RawTransactionType1559</span><span class=p>(</span><span class=n>rlp</span><span class=o>.</span><span class=n>Serializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>transaction_type</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;chainId&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;nonce&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxPriorityFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;to&#34;</span><span class=p>,</span> <span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=n>binary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;accessList&#34;</span><span class=p>,</span> <span class=n>access_list_sede_type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SignedTransactionType1559</span><span class=p>(</span><span class=n>rlp</span><span class=o>.</span><span class=n>Serializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>transaction_type</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;chainId&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;nonce&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxPriorityFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;to&#34;</span><span class=p>,</span> <span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=n>binary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;accessList&#34;</span><span class=p>,</span> <span class=n>access_list_sede_type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;yParity&#34;</span><span class=p>,</span> <span class=n>boolean</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span></code></pre></div><h4 id=create-the-example-transaction-to-send>Create the example transaction to send</h4><p>Create an example transaction to send out on the Ropsten test network:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># grab nonce value of sender&#39;s account. nonce = number of transactions</span>
</span></span><span class=line><span class=cl><span class=n>nonce</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>getTransactionCount</span><span class=p>(</span><span class=n>checksum</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Nonce value:</span><span class=se>\n</span><span class=s2> </span><span class=si>%i</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>nonce</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Example receiver&#39;s address</span>
</span></span><span class=line><span class=cl><span class=n>receiver_addr</span> <span class=o>=</span> <span class=s1>&#39;0x15C25E6EB5dE729d7e310d059e59659cCB86E6f6&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ropsten chain ID is 3</span>
</span></span><span class=line><span class=cl><span class=n>chain_id</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># prepare the transaction, chainID 3 is ropsten</span>
</span></span><span class=line><span class=cl><span class=n>transaction_legacy</span> <span class=o>=</span> <span class=n>TransactionLegacy</span><span class=p>(</span><span class=n>nonce</span> <span class=o>=</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>gasPrice</span> <span class=o>=</span> <span class=mi>500000</span><span class=p>,</span> <span class=n>gasLimit</span> <span class=o>=</span> <span class=mi>800000</span><span class=p>,</span> <span class=n>to</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>receiver_addr</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;0x&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)),</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=n>v</span> <span class=o>=</span> <span class=n>chain_id</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>transaction_1559</span> <span class=o>=</span> <span class=n>RawTransactionType1559</span><span class=p>(</span><span class=n>chainId</span> <span class=o>=</span> <span class=n>chain_id</span><span class=p>,</span> <span class=n>nonce</span> <span class=o>=</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>maxPriorityFeePerGas</span> <span class=o>=</span> <span class=mi>150000</span><span class=p>,</span> <span class=n>maxFeePerGas</span> <span class=o>=</span> <span class=mi>150000</span><span class=p>,</span> <span class=n>gas</span> <span class=o>=</span> <span class=mi>210000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                          <span class=n>to</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>receiver_addr</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;0x&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)),</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;world&#39;</span><span class=p>,</span> <span class=n>accessList</span> <span class=o>=</span> <span class=p>[])</span>
</span></span></code></pre></div><h4 id=preparing-our-transaction-to-be-signed-by-the-zymbit-hardware>Preparing our transaction to be signed by the Zymbit hardware</h4><p>So the two steps to prepare our transaction for signing:</p><ol><li>RLP encode the transaction</li><li>Keccak Hash the RLP encoded transaction</li></ol><p>Per Ethereum standard the signature elements are generated for these transaction types via:</p><ul><li>Transaction Legacy<ul><li><span>The </span><code>signature_r, signature_s</code><span> elements of this transaction represent a secp256k1 signature over </span><code>keccak256(rlp([nonce, gasPrice, gasLimit, to, value, data, v, r, s]))</code></li><li>r,s are defaulted to 0</li><li>v will be the chain_id of the network</li><li>signature_v follows <a href=https://eips.ethereum.org/EIPS/eip-155><strong>EIP-155</strong></a></li></ul></li><li>Transaction EIP-1559<ul><li><span>The </span><code>signature_y_parity, signature_r, signature_s</code><span> elements of this transaction represent a secp256k1 signature over </span><code>keccak256(0x02 || rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, destination, amount, data, access_list]))</code></li><li>chain_id and y_parity are now seperate params.</li></ul></li></ul><p>And because our transaction classes subclass rlp.serializable, we can simply rlp encode these class objects via:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RLP encode the transaction</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encoded_transaction_legacy</span> <span class=o>=</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>transaction_legacy</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_transaction_legacy</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transaction type is now a byte added to the front of the rlp encoded object</span>
</span></span><span class=line><span class=cl><span class=n>encoded_transaction_1559</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>transaction_1559</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_transaction_1559</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span> 
</span></span></code></pre></div><p>Next, step 2 is to keccak hash the rlp encoded transaction</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>#Per Ethereum standards, Keccak hash rlp encoded transaction
</span></span><span class=line><span class=cl>keccak_hash=keccak.new(digest_bits=256)
</span></span><span class=line><span class=cl>keccak_hash.update(encoded_transaction)
</span></span><span class=line><span class=cl>print(&#34;keccak_hash:\n%s&#34; % keccak_hash.hexdigest())
</span></span></code></pre></div><h4 id=signing-the-transaction-data-with-a-private-key-stored-on-the-zymbit-module>Signing the transaction data with a private key stored on the Zymbit module.</h4><p>Sign this keccak hashed transaction with the private secp256k1 key we generated. This ECDSA signature we get will give us <code>signature_r</code>, <code>signature_s</code>, <code>signature_v</code>, and the <code>y-parity</code>.</p><p><code>signature_V</code> is only required by TransactionLegacy and follow <a href=https://eips.ethereum.org/EIPS/eip-155><strong>EIP-155</strong></a>.</p><ul><li>The other transaction types split up chain ID and Y parity as separate parameters.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl># sign the transaction hash and calculate v, r, s values
</span></span><span class=line><span class=cl>signature, y_parity = zymkey.client.sign_digest(keccak_hash, zymkey_pub_key_slot, return_recid=True)
</span></span><span class=line><span class=cl>print (&#34;ECDSA Signature:\n%s&#34; % signature)
</span></span><span class=line><span class=cl>print(&#34;ECDSA Sig Length:\n%s&#34; % len(signature))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Verify the ECDSA signature. Make sure our public key can decrypt this signature.
</span></span><span class=line><span class=cl>verify_sig = zymkey.client.verify_digest(keccak_hash, signature, True, zymkey_pub_key_slot, False)
</span></span><span class=line><span class=cl>print(&#34;Verify sig:\n%s&#34; % verify_sig)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Signature consists of a R, S, V
</span></span><span class=line><span class=cl># R is the first half of the signature converted to int
</span></span><span class=line><span class=cl># S is the second half of the signature converted to int
</span></span><span class=line><span class=cl># From EIP 155, V = chainId * 2 + 35 + recovery_id of public key
</span></span><span class=line><span class=cl># Per Ethereum yellow paper, if S * 2 &gt;= N, then S becomes N - S and Y-parity is flipped
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>N = 115792089237316195423570985008687907852837564279074904382605163141518161494337
</span></span><span class=line><span class=cl>r = int.from_bytes(signature[:32], &#34;big&#34;)
</span></span><span class=line><span class=cl>s = int.from_bytes(signature[-32:], &#34;big&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>y_parity = bool(y_parity.value)
</span></span><span class=line><span class=cl>if((s*2) &gt;= N):
</span></span><span class=line><span class=cl>   y_parity = not y_parity
</span></span><span class=line><span class=cl>   s = N - s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># EIP-155 V is only required in TransactionLegacy, as other transaction types split up chain_id and y_parity.
</span></span><span class=line><span class=cl>v = chain_id * 2 + 35 + int(y_parity)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>print (&#34;R:\n%s&#34; % r)
</span></span><span class=line><span class=cl>print (&#34;S:\n%s&#34; % s)
</span></span><span class=line><span class=cl>print (&#34;V:\n%s&#34; % v)
</span></span><span class=line><span class=cl>print (&#34;Y Parity:\n%s&#34; % y_parity)
</span></span></code></pre></div><h4 id=adding-our-signature-to-our-transaction-class>Adding our signature to our transaction class</h4><p>Transaction Legacy&rsquo;s signature elements are:</p><ul><li>Signature_R</li><li>Signature_S</li><li>Signature_V</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl># We create our TransactionLegacy again, except we fill our v, r, s fields with the appropriate values.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>signed_transaction_legacy = TransactionLegacy(transaction_legacy.nonce, transaction_legacy.gasPrice, transaction_legacy.gasLimit, transaction_legacy.to, transaction_legacy.value, transaction_legacy.data, v, r, s)
</span></span></code></pre></div><p>Transaction EIP-1559&rsquo;s signature elements are:</p><ul><li>Signature_R</li><li>Signature_S</li><li>Y-Parity of the Signature</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># We create our SignedTransactionType1559 from RawTransactionType1559, except we fill our yParity, r, s fields with the appropriate values.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>signed_transaction_1559</span> <span class=o>=</span> <span class=n>SignedTransactionType1559</span><span class=p>(</span><span class=n>transaction_1559</span><span class=o>.</span><span class=n>chainId</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>nonce</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>maxPriorityFeePerGas</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>maxFeePerGas</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>gas</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=n>transaction_1559</span><span class=o>.</span><span class=n>to</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>accessList</span><span class=p>,</span> <span class=n>y_parity</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=one-last-step-before-send-off-rlp-encode-the-signed-transaction>One Last Step before send off. RLP encode the signed transaction.</h4><p>Same as the rlp encoding step before.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RLP encode the transaction</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encoded_transaction_legacy</span> <span class=o>=</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>signed_transaction_legacy</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_transaction_legacy</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transaction type is now a byte added to the front of the rlp encoded object</span>
</span></span><span class=line><span class=cl><span class=n>encoded_transaction_1559</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>signed_transaction_1559</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_transaction_1559</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span> 
</span></span></code></pre></div><p>We can also validate that this transaction can be broadcasted, by pasting that encoded transaction in the <a href=https://app.mycrypto.com/broadcast-transaction><strong>myCrypto broadcast tool</strong></a>.</p><p><img src=bcast_transaction.png alt=image></p><h4 id=send-your-transaction>Send your transaction</h4><p>Broadcast the transaction through our web3 instance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># send raw transaction</span>
</span></span><span class=line><span class=cl><span class=n>transaction_result_hash</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>sendRawTransaction</span><span class=p>(</span><span class=n>encoded_signed_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Transaction broadcast hash:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>transaction_result_hash</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>If successfully broadcasted, you should get a broadcast hash receipt back. You can view your transaction&rsquo;s validation progress on the network by pasting that hash receipt here: <a href=https://ropsten.etherscan.io/>https://ropsten.etherscan.io/</a></p><p><img src=transaction_receipt.png alt=image></p><div class="callout callout-warning"><div class=callout-heading><i class="callout-icon fas fa-exclamation-triangle"></i>
<span class=callout-title>Warning</span></div><div class=callout-body><p>If you get Error: &ldquo;Not enough funds or gas&rdquo;</p><p>To properly send out transaction to the Ropsten test network with this sender&rsquo;s address, there must be adequate funds in this address to pay for the fees required to send out this transaction. Because Ropsten is a test network for development, we can fund ethereum addresses for free with test ether. There is a one IP address per day limit).</p><p>You can do this here: <a href=https://faucet.egorfine.com/><strong>Ropsten Faucet</strong></a></p></div></div><h3 id=full-example-code>Full Example Code</h3><p>Below is the entire code used in the above examples.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>zymkey</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>rlp</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>rlp.sedes</span> <span class=kn>import</span> <span class=n>binary</span><span class=p>,</span> <span class=n>Binary</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>,</span> <span class=n>BigEndianInt</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>CountableList</span><span class=p>,</span> <span class=n>boolean</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Hash</span> <span class=kn>import</span> <span class=n>keccak</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>web3</span> <span class=kn>import</span> <span class=n>Web3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#------------------------------------Abstract Type Declaractions------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># This is a rlp serializable type for accessList param</span>
</span></span><span class=line><span class=cl><span class=n>access_list_sede_type</span> <span class=o>=</span> <span class=n>CountableList</span><span class=p>(</span><span class=n>List</span><span class=p>([</span><span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span> <span class=n>CountableList</span><span class=p>(</span><span class=n>BigEndianInt</span><span class=p>(</span><span class=mi>32</span><span class=p>)),]),)</span>
</span></span><span class=line><span class=cl><span class=c1>#------------------------------------Class Definitions----------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TransactionLegacy</span><span class=p>(</span><span class=n>rlp</span><span class=o>.</span><span class=n>Serializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;nonce&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gasPrice&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gasLimit&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;to&#34;</span><span class=p>,</span> <span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=n>binary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;v&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RawTransactionType1559</span><span class=p>(</span><span class=n>rlp</span><span class=o>.</span><span class=n>Serializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>transaction_type</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;chainId&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;nonce&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxPriorityFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;to&#34;</span><span class=p>,</span> <span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=n>binary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;accessList&#34;</span><span class=p>,</span> <span class=n>access_list_sede_type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SignedTransactionType1559</span><span class=p>(</span><span class=n>rlp</span><span class=o>.</span><span class=n>Serializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>transaction_type</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;chainId&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;nonce&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxPriorityFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;maxFeePerGas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;gas&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;to&#34;</span><span class=p>,</span> <span class=n>Binary</span><span class=o>.</span><span class=n>fixed_length</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=n>binary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;accessList&#34;</span><span class=p>,</span> <span class=n>access_list_sede_type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;yParity&#34;</span><span class=p>,</span> <span class=n>boolean</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=n>big_endian_int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1>#------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># create web3 instance, from infura project (node) connecting to ropsten test network</span>
</span></span><span class=line><span class=cl><span class=n>w3</span> <span class=o>=</span> <span class=n>Web3</span><span class=p>(</span><span class=n>Web3</span><span class=o>.</span><span class=n>HTTPProvider</span><span class=p>(</span><span class=s1>&#39;https://ropsten.infura.io/v3/9f06183d0529494792242beb59be4ad3&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Example receiver&#39;s address</span>
</span></span><span class=line><span class=cl><span class=n>receiver_addr</span> <span class=o>=</span> <span class=s1>&#39;0x15C25E6EB5dE729d7e310d059e59659cCB86E6f6&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ethereum is based on secp256k1, so we generate a &#34;secp256k1&#34; key pair using zymbit libs.</span>
</span></span><span class=line><span class=cl><span class=c1># Get ECDSA secp256k1 public key from zymkey and generate our Ethereum sender&#39;s checksum address</span>
</span></span><span class=line><span class=cl><span class=n>zymkey_pub_key_slot</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>gen_key_pair</span><span class=p>(</span><span class=s2>&#34;secp256k1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pub_key</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get_public_key</span><span class=p>(</span><span class=n>zymkey_pub_key_slot</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;zymkey secp256k1 public key:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>pub_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span> <span class=o>=</span> <span class=n>keccak</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>digest_bits</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>pub_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_digest</span> <span class=o>=</span> <span class=n>keccak_hash</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># Take the last 20 bytes</span>
</span></span><span class=line><span class=cl><span class=n>wallet_len</span> <span class=o>=</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl><span class=n>wallet_addr</span> <span class=o>=</span> <span class=s2>&#34;0x&#34;</span> <span class=o>+</span> <span class=n>keccak_digest</span><span class=p>[</span><span class=o>-</span><span class=n>wallet_len</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># checksum = Web3.toChecksumAddress(wallet_addr)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># How eip-55 calculates checksum</span>
</span></span><span class=line><span class=cl><span class=n>checksum</span> <span class=o>=</span> <span class=s2>&#34;0x&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Remove ‘0x’ from the address</span>
</span></span><span class=line><span class=cl><span class=n>address</span> <span class=o>=</span> <span class=n>wallet_addr</span><span class=p>[</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=n>address_byte_array</span> <span class=o>=</span> <span class=n>address</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span> <span class=o>=</span> <span class=n>keccak</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>digest_bits</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>address_byte_array</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_digest</span> <span class=o>=</span> <span class=n>keccak_hash</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>address</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>address_char</span> <span class=o>=</span> <span class=n>address</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>keccak_char</span> <span class=o>=</span> <span class=n>keccak_digest</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>keccak_char</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>checksum</span> <span class=o>+=</span> <span class=n>address_char</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>checksum</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>address_char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Eth Checksum:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>checksum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Valid checksum:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>Web3</span><span class=o>.</span><span class=n>isAddress</span><span class=p>(</span><span class=n>checksum</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># grab nonce value of sender&#39;s account. nonce = number of transactions</span>
</span></span><span class=line><span class=cl><span class=n>nonce</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>getTransactionCount</span><span class=p>(</span><span class=n>checksum</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Nonce value:</span><span class=se>\n</span><span class=s2> </span><span class=si>%i</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>nonce</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ropsten chain ID is 3</span>
</span></span><span class=line><span class=cl><span class=n>chain_id</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># prepare the transaction, chainID 3 is ropsten</span>
</span></span><span class=line><span class=cl><span class=n>transaction_legacy</span> <span class=o>=</span> <span class=n>TransactionLegacy</span><span class=p>(</span><span class=n>nonce</span> <span class=o>=</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>gasPrice</span> <span class=o>=</span> <span class=mi>500000</span><span class=p>,</span> <span class=n>gasLimit</span> <span class=o>=</span> <span class=mi>800000</span><span class=p>,</span> <span class=n>to</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>receiver_addr</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;0x&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)),</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=n>v</span> <span class=o>=</span> <span class=n>chain_id</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>transaction_1559</span> <span class=o>=</span> <span class=n>RawTransactionType1559</span><span class=p>(</span><span class=n>chainId</span> <span class=o>=</span> <span class=n>chain_id</span><span class=p>,</span> <span class=n>nonce</span> <span class=o>=</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>maxPriorityFeePerGas</span> <span class=o>=</span> <span class=mi>150000</span><span class=p>,</span> <span class=n>maxFeePerGas</span> <span class=o>=</span> <span class=mi>150000</span><span class=p>,</span> <span class=n>gas</span> <span class=o>=</span> <span class=mi>210000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                          <span class=n>to</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>receiver_addr</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;0x&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)),</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;world&#39;</span><span class=p>,</span> <span class=n>accessList</span> <span class=o>=</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#----------------------------------------Send Transaction Legacy with zymkey signature-----------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># Sign a transaction with a signature generated by hsm6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RLP encode the transaction</span>
</span></span><span class=line><span class=cl><span class=n>encoded_transaction</span> <span class=o>=</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>transaction_legacy</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_transaction</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Per Ethereum standards, Keccak hash rlp encoded transaction</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>=</span><span class=n>keccak</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>digest_bits</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>encoded_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;keccak_hash:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>keccak_hash</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sign the transaction hash and calculate v, r, s values</span>
</span></span><span class=line><span class=cl><span class=n>signature</span><span class=p>,</span> <span class=n>y_parity</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sign_digest</span><span class=p>(</span><span class=n>keccak_hash</span><span class=p>,</span> <span class=n>zymkey_pub_key_slot</span><span class=p>,</span> <span class=n>return_recid</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;ECDSA Signature:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>signature</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ECDSA Sig Length:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>signature</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ECDSA Sig Y Parity:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>y_parity</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verify the ECDSA signature.</span>
</span></span><span class=line><span class=cl><span class=n>verify_sig</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>verify_digest</span><span class=p>(</span><span class=n>keccak_hash</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>zymkey_pub_key_slot</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Verify sig:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>verify_sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Signature consists of a R, S, V</span>
</span></span><span class=line><span class=cl><span class=c1># R is the first half of the signature converted to int</span>
</span></span><span class=line><span class=cl><span class=c1># S is the second half of the signature converted to int</span>
</span></span><span class=line><span class=cl><span class=c1># From EIP 155, V = chainId * 2 + 35 + recovery_id of public key</span>
</span></span><span class=line><span class=cl><span class=c1># Per Ethereum yellow paper, if S * 2 &gt;= N, then S becomes N - S and Y-parity is flipped</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>115792089237316195423570985008687907852837564279074904382605163141518161494337</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>signature</span><span class=p>[:</span><span class=mi>32</span><span class=p>],</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>signature</span><span class=p>[</span><span class=o>-</span><span class=mi>32</span><span class=p>:],</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y_parity</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>y_parity</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>((</span><span class=n>s</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>   <span class=n>y_parity</span> <span class=o>=</span> <span class=ow>not</span> <span class=n>y_parity</span>
</span></span><span class=line><span class=cl>   <span class=n>s</span> <span class=o>=</span> <span class=n>N</span> <span class=o>-</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>v</span> <span class=o>=</span> <span class=n>chain_id</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>35</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=n>y_parity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;R:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;S:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;V:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RLP encode the transaction along with the full signature</span>
</span></span><span class=line><span class=cl><span class=n>signed_transaction</span> <span class=o>=</span> <span class=n>TransactionLegacy</span><span class=p>(</span><span class=n>transaction_legacy</span><span class=o>.</span><span class=n>nonce</span><span class=p>,</span> <span class=n>transaction_legacy</span><span class=o>.</span><span class=n>gasPrice</span><span class=p>,</span> <span class=n>transaction_legacy</span><span class=o>.</span><span class=n>gasLimit</span><span class=p>,</span> <span class=n>transaction_legacy</span><span class=o>.</span><span class=n>to</span><span class=p>,</span> <span class=n>transaction_legacy</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>transaction_legacy</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>encoded_signed_transaction</span> <span class=o>=</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>signed_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded signed transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_signed_transaction</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># send raw transaction</span>
</span></span><span class=line><span class=cl><span class=n>transaction_result_hash</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>sendRawTransaction</span><span class=p>(</span><span class=n>encoded_signed_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Transaction broadcast hash:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>transaction_result_hash</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>#-----------------------------------------------------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#------------------------------Send Transaction Type EIP-1559 with zymkey signature-------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># Sign a transaction with a signature generated by hsm6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RLP encode the transaction. Eip-1559 transaction is assigned type_id &#34;2&#34;.</span>
</span></span><span class=line><span class=cl><span class=c1># So the payload is 0x02 || rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, destination, amount, data, access_list, signature_y_parity, signature_r, signature_s])</span>
</span></span><span class=line><span class=cl><span class=n>encoded_transaction</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>transaction_1559</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span>  <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_transaction</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Per Ethereum standards, Keccak hash rlp encoded transaction</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>=</span><span class=n>keccak</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>digest_bits</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>keccak_hash</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>encoded_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;keccak_hash:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>keccak_hash</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sign the transaction hash and calculate y-parity, r, s values</span>
</span></span><span class=line><span class=cl><span class=n>signature</span><span class=p>,</span> <span class=n>y_parity</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sign_digest</span><span class=p>(</span><span class=n>keccak_hash</span><span class=p>,</span> <span class=n>zymkey_pub_key_slot</span><span class=p>,</span> <span class=n>return_recid</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;ECDSA Signature:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>signature</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ECDSA Sig Length:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>signature</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ECDSA Sig Y Parity:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>y_parity</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verify the ECDSA signature.</span>
</span></span><span class=line><span class=cl><span class=n>verify_sig</span> <span class=o>=</span> <span class=n>zymkey</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>verify_digest</span><span class=p>(</span><span class=n>keccak_hash</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>zymkey_pub_key_slot</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Verify sig:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>verify_sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Signature consists of a R, S, Y-parity</span>
</span></span><span class=line><span class=cl><span class=c1># R is the first half of the signature converted to int</span>
</span></span><span class=line><span class=cl><span class=c1># S is the second half of the signature converted to int</span>
</span></span><span class=line><span class=cl><span class=c1># Per Ethereum yellow paper, if S * 2 &gt;= N, then S becomes N - S and Y-parity is flipped</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>115792089237316195423570985008687907852837564279074904382605163141518161494337</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>signature</span><span class=p>[:</span><span class=mi>32</span><span class=p>],</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>signature</span><span class=p>[</span><span class=o>-</span><span class=mi>32</span><span class=p>:],</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y_parity</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>y_parity</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>((</span><span class=n>s</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>   <span class=n>y_parity</span> <span class=o>=</span> <span class=ow>not</span> <span class=n>y_parity</span>
</span></span><span class=line><span class=cl>   <span class=n>s</span> <span class=o>=</span> <span class=n>N</span> <span class=o>-</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;R:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;S:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;y_parity:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>y_parity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RLP encode the transaction along with the full signature</span>
</span></span><span class=line><span class=cl><span class=n>signed_transaction</span> <span class=o>=</span> <span class=n>SignedTransactionType1559</span><span class=p>(</span><span class=n>transaction_1559</span><span class=o>.</span><span class=n>chainId</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>nonce</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>maxPriorityFeePerGas</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>maxFeePerGas</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>gas</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>to</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>transaction_1559</span><span class=o>.</span><span class=n>accessList</span><span class=p>,</span> <span class=n>y_parity</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tack on the same transaction type byte to the final transaction before being sent out</span>
</span></span><span class=line><span class=cl><span class=n>encoded_signed_transaction</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=n>rlp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>signed_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;encoded signed transaction:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>encoded_signed_transaction</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># send raw transaction</span>
</span></span><span class=line><span class=cl><span class=n>transaction_result_hash</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>sendRawTransaction</span><span class=p>(</span><span class=n>encoded_signed_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Transaction broadcast hash:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>transaction_result_hash</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>#---------------------------------------------------------------------------------------------------------------------------------</span>
</span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3c76e570b8edcc8e0588f2a12ba768dcc4855763404089be6365637d90bdb8ef.js integrity="sha256-PHblcLjtzI4FiPKhK6do3MSFV2NAQIm+Y2VjfZC9uO8=" crossorigin=anonymous></script></body></html>